window.bp=window.bp||{},function(r){bp.Zoom={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.bp_zoom_ajax=!1,this.bp_zoom_meeting_container_elem="#bp-zoom-meeting-container"},addListeners:function(){r("#meetings-list").scroll("scroll",this.scrollMeetings.bind(this)),r("#meetings-list").on("click",".load-more a",this.loadMoreMeetings.bind(this)),r(document).on("click","#meetings-list .meeting-item, #bp-zoom-meeting-cancel-edit",this.loadSingleMeeting.bind(this)),r(document).on("click",".bp-back-to-meeting-list",this.backToMeetingList.bind(this)),r(document).on("click",".bp-close-create-meeting-form",this.backToMeetingList.bind(this)),r(document).on("click","#bp-zoom-create-meeting-button",this.loadCreateMeeting.bind(this)),r(document).on("click","#bp-zoom-meeting-edit-button",this.loadEditMeeting.bind(this)),r(document).on("click","#bp-zoom-meeting-form-submit",this.updateMeeting.bind(this)),r(document).on("click",".bp-zoom-delete-meeting",this.deleteMeeting.bind(this)),r(document).on("click","#bp-zoom-single-meeting .toggle-password",this.togglePassword.bind(this)),r(document).on("click",".recording-list-row .toggle-password",this.toggleRecordingPassword.bind(this)),r(document).on("click","#copy-invitation-details",this.copyInvitationDetails.bind(this)),r(document).on("click","#copy-download-link",this.copyDownloadLink.bind(this)),r(document).on("click",".play_btn, .bb-shared-screen",this.openRecordingModal.bind(this)),r(document).on("click",".bb-close-model",this.closeRecordingModal.bind(this)),r(document).on("click",".meeting-actions-anchor",this.openMeetingActions.bind(this)),r(document).on("submit","#bp-zoom-meeting-container #bp_zoom_meeting_search_form",this.searchMeetingActions.bind(this)),r(document).on("change","#bp-zoom-meeting-container #bp-zoom-meeting-recorded-switch-checkbox",this.searchMeetingActions.bind(this)),r(document).on("change","#bp-zoom-meeting-auto-recording",this.toggleAutoRecording.bind(this)),r(document).on("ready",this.documentReady.bind(this)),r(document).on("bp_ajax_request",this.bp_ajax_request.bind(this)),r(document).on("click","#meetings-sync",this.syncGroupMeetings.bind(this)),document.addEventListener("keyup",this.checkPressedKey.bind(this)),r(document).on("click","body.zoom",function(e){if(r(e.target).hasClass("meeting-actions-anchor")||r(e.target).parent().hasClass("meeting-actions-anchor"))return e;r(".meeting-actions-list.open").removeClass("open")}),r(document).on("click",".bp-toggle-meeting-password",function(e){e.preventDefault();var t=r(this),n=t.next("#bp-zoom-meeting-password");t.toggleClass("bb-eye"),t.hasClass("bb-eye")?n.attr("type","text"):n.attr("type","password")}),this.mask_meeting_id()},bp_ajax_request:function(){this.triggerCountdowns(),this.triggerLibsOnForm(),this.mask_meeting_id()},documentReady:function(){this.triggerCountdowns(),this.triggerLibsOnForm(),this.triggerFetchRecordings()},triggerFetchRecordings:function(){var i=[];r(".bp-zoom-meeting-recording-fetch").each(function(e,t){var n=r(t).data("meeting-id");i.push(n)}),this.fetchRecording(i,0)},fetchRecording:function(t,n){var e,i=this;void 0!==t[n]&&(e=r(document).find("#bp-zoom-meeting-recording-"+t[n]).data("title"),r.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_recordings",meeting_id:t[n],title:e},success:function(e){e.success&&void 0!==e.data&&(r(document).find("#bp-zoom-meeting-recording-"+t[n]).replaceWith(e.data.contents),jQuery(".show-recordings").magnificPopup({type:"inline",midClick:!0}),n+=1,i.fetchRecording(t,n))}}))},triggerCountdowns:function(){var e=r(".bp_zoom_countdown");e.length&&e.each(function(){var e=r(this).data("timer"),o=r(this).data("reload"),e=1e3*parseInt(e);r(this).countdown({timestamp:e,callback:function(e,t,n,i){0===e+t+n+i&&1===o&&window.location.reload()}})})},triggerLibsOnForm:function(){r(".copy-invitation-link").magnificPopup({type:"inline",midClick:!0}),jQuery(".show-recordings").magnificPopup({type:"inline",midClick:!0}),jQuery(".show-meeting-details").magnificPopup({type:"inline",midClick:!0,callbacks:{beforeClose:function(){this.content.hasClass("copy-invitation-popup-block")&&r(".mfp-close").show()}}});var e,s=r("#bp-zoom-single-meeting-wrapper");void 0!==jQuery.fn.datetimepicker&&(s.find("#bp-zoom-meeting-start-date").datetimepicker({format:"Y-m-d",timepicker:!1,mask:!0,minDate:0,yearStart:(new Date).getFullYear(),defaultDate:new Date,scrollMonth:!1,scrollTime:!1,scrollInput:!1}),s.find("#bp-zoom-meeting-start-time").datetimepicker({format:"h:i",formatTime:"h:i",datepicker:!1,hours12:!0,step:30}),e={placeholder:"hh:mm",translation:{P:{pattern:/0|1/,optional:!1},Q:{pattern:/0|1|2/,optional:!1},X:{pattern:/0|[1-9]/,optional:!1},Y:{pattern:/[0-5]/,optional:!1},Z:{pattern:/[0-9]/,optional:!1}},onKeyPress:function(e,t,n,i){var o=["PX:YZ","PQ:YZ"],a=1<e.length&&0<e.substr(0,1)?o[1]:o[0];s.find("#bp-zoom-meeting-start-time").mask(a,i)}},s.find("#bp-zoom-meeting-start-time").mask("PX:YZ",e)),void 0!==jQuery.fn.select2&&s.find("#bp-zoom-meeting-timezone").select2({minimumInputLength:0,closeOnSelect:!0,language:"undefined"!=typeof bp_select2&&void 0!==bp_select2.lang?bp_select2.lang:"en",dropdownCssClass:"bb-select-dropdown",containerCssClass:"bb-select-container"})},toggleAutoRecording:function(e){var t=r(e.target),n=t.closest("form").find(".bp-zoom-meeting-auto-recording-options");t.is(":checked")?n.removeClass("bp-hide"):n.addClass("bp-hide")},formatDate:function(e){var t=new Date(e),n=""+(t.getMonth()+1),i=""+t.getDate(),o=t.getFullYear();return n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),[o,n,i].join("-")},loadCreateMeeting:function(e){e.preventDefault();var t=r(e.currentTarget).data("group-id");r("#bp-zoom-single-meeting-wrapper").empty(),r("#meetings-list .meeting-item").removeClass("current"),r(this.bp_zoom_meeting_container_elem).length&&(r(this.bp_zoom_meeting_container_elem).addClass("bp-create-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-past-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-future-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-edit-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-single-meeting")),this.abort_zoom_ajax.bind(this),this.bp_zoom_ajax=r.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_create_meeting",group_id:t},success:function(e){var t,n;void 0!==e.data&&e.data.contents&&(r("#bp-zoom-single-meeting-wrapper").html(e.data.contents),r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-date").datetimepicker({format:"Y-m-d",timepicker:!1,mask:!0,minDate:0,yearStart:(new Date).getFullYear(),defaultDate:new Date,scrollMonth:!1,scrollTime:!1,scrollInput:!1}),r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-time").datetimepicker({format:"h:i",formatTime:"h:i",datepicker:!1,hours12:!0,step:30}),t={placeholder:"hh:mm",translation:{P:{pattern:/0|1/,optional:!1},Q:{pattern:/0|1|2/,optional:!1},X:{pattern:/0|[1-9]/,optional:!1},Y:{pattern:/[0-5]/,optional:!1},Z:{pattern:/[0-9]/,optional:!1}},onKeyPress:function(e,t,n,i){var o=["PX:YZ","PQ:YZ"],a=1<e.length&&0<e.substr(0,1)?o[1]:o[0];r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-time").mask(a,i)}},r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-time").mask("PX:YZ",t),r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-timezone").select2({minimumInputLength:0,closeOnSelect:!0,language:"undefined"!=typeof bp_select2&&void 0!==bp_select2.lang?bp_select2.lang:"en",dropdownCssClass:"bb-select-dropdown",containerCssClass:"bb-select-container"}),""!==bp_zoom_meeting_vars.group_meetings_url&&(n=bp_zoom_meeting_vars.group_meetings_url+"create-meeting",window.history.pushState(null,null,n)))}})},loadEditMeeting:function(e){var t=r(e.currentTarget).closest(".meeting-item-container").data("id");e.preventDefault(),r("#bp-zoom-single-meeting-wrapper").empty(),r(this.bp_zoom_meeting_container_elem).length&&(r(this.bp_zoom_meeting_container_elem).addClass("bp-create-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-past-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-future-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-edit-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-single-meeting")),this.abort_zoom_ajax.bind(this),this.bp_zoom_ajax=r.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_edit_meeting",id:t},success:function(e){var t;void 0!==e.data&&e.data.contents&&(r("#bp-zoom-single-meeting-wrapper").html(e.data.contents),r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-date").datetimepicker({format:"Y-m-d",timepicker:!1,mask:!0,minDate:0,yearStart:(new Date).getFullYear(),defaultDate:new Date,scrollMonth:!1,scrollTime:!1,scrollInput:!1}),r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-time").datetimepicker({format:"h:i",formatTime:"h:i",datepicker:!1,hours12:!0,step:30}),t={placeholder:"hh:mm",translation:{P:{pattern:/0|1/,optional:!1},Q:{pattern:/0|1|2/,optional:!1},X:{pattern:/0|[1-9]/,optional:!1},Y:{pattern:/[0-5]/,optional:!1},Z:{pattern:/[0-9]/,optional:!1}},onKeyPress:function(e,t,n,i){var o=["PX:YZ","PQ:YZ"],a=1<e.length&&0<e.substr(0,1)?o[1]:o[0];r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-time").mask(a,i)}},r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-start-time").mask("PX:YZ",t),r("#bp-zoom-single-meeting-wrapper").find("#bp-zoom-meeting-timezone").select2({minimumInputLength:0,closeOnSelect:!0,language:"undefined"!=typeof bp_select2&&void 0!==bp_select2.lang?bp_select2.lang:"en",dropdownCssClass:"bb-select-dropdown",containerCssClass:"bb-select-container"}))}})},backToMeetingList:function(e){e.preventDefault(),r(this.bp_zoom_meeting_container_elem).length&&(r(this.bp_zoom_meeting_container_elem).removeClass("bp-create-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-past-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-future-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-edit-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-single-meeting"))},loadSingleMeeting:function(e){var t=r(e.target),n=t.closest(".meeting-item"),i=n.data("id");e.preventDefault();var o=this;if(r(this.bp_zoom_meeting_container_elem).length&&(r(this.bp_zoom_meeting_container_elem).removeClass("bp-create-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-past-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-future-meeting"),r(this.bp_zoom_meeting_container_elem).removeClass("bp-edit-meeting"),r(this.bp_zoom_meeting_container_elem).addClass("bp-single-meeting"),r(".bp-navs.group-subnav").find("li.bp-groups-tab.current.selected").hasClass("meetings")?r(this.bp_zoom_meeting_container_elem).addClass("bp-future-meeting"):r(".bp-navs.group-subnav").find("li.bp-groups-tab.current.selected").hasClass("past-meetings")&&r(this.bp_zoom_meeting_container_elem).addClass("bp-past-meeting")),t.hasClass("view-recordings")||t.hasClass("dashicons")||n.hasClass("current"))return!1;r("#meetings-list .meeting-item").removeClass("current"),r("#meetings-list .meeting-item[data-id="+i+"]").addClass("current"),r("#bp-zoom-single-meeting-wrapper").empty(),this.abort_zoom_ajax.bind(this),this.bp_zoom_ajax=r.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_get_single_meeting",id:i},success:function(e){var t;void 0!==e.data&&e.data.contents&&(r("#bp-zoom-single-meeting-wrapper").html(e.data.contents),""!==bp_zoom_meeting_vars.group_meetings_url&&(t=bp_zoom_meeting_vars.group_meetings_url+"meetings/"+i,window.history.pushState(null,null,t))),r("#bp-zoom-single-meeting-wrapper").find("#copy-invitation-link").magnificPopup({type:"inline",midClick:!0}),r("#bp-zoom-single-meeting-wrapper").find(".show-recordings").magnificPopup({type:"inline",midClick:!0}),o.mask_meeting_id(),o.triggerCountdowns()}})},scrollMeetings:function(e){var t,n;"meetings-list"!==e.target.id||(t=e.target).scrollTop+t.offsetHeight>=t.scrollHeight&&!t.classList.contains("loading")&&((n=r(t).find(".load-more")).length&&(t.classList.add("loading"),n.find("a").trigger("click")))},loadMoreMeetings:function(e){var t=r(e.currentTarget);e.preventDefault();var n=this;if(t.hasClass("loading"))return!1;t.addClass("loading");var i=!1;r("#bp-zoom-meeting-recorded-switch-checkbox").is(":checked")&&(i=!0),r.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_load_more",page:this.getLinkParams(t.prop("href"),"acpage"),search_terms:r("#bp-zoom-meeting-container #bp_zoom_meeting_search").val(),recorded:i,past:r("#bp-zoom-meeting-container #bp-zoom-meeting-recorded-switch-checkbox").length},success:function(e){void 0!==e.data&&e.data.contents&&t.closest(".load-more").replaceWith(e.data.contents),t.removeClass("loading"),r("#meetings-list").removeClass("loading"),n.mask_meeting_id()}})},updateMeeting:function(e){var i=r(e.currentTarget);if(e.preventDefault(),i.hasClass("loading")||i.hasClass("disabled"))return!1;var o=this;i.addClass("loading"),i.parents(".bp-meeting-fields-wrap").find(".bp-feedback.error").remove();var t=i.closest("form").serialize();this.abort_zoom_ajax.bind(this),this.bp_zoom_ajax=r.ajax({type:"POST",url:bp_zoom_meeting_vars.ajax_url,data:t,success:function(e){var t="";if(e.success){if(void 0!==e.data&&e.data.redirect_url)return window.location.href=e.data.redirect_url,!1}else{if(e.data.errors)for(var n in e.data.errors)t='<aside class="bp-feedback bp-messages error"><span class="bp-icon" aria-hidden="true"></span><p>'+e.data.errors[n].message+"</p></aside>",i.parents(".bp-meeting-fields-wrap").prepend(t);else e.data.error&&(t='<aside class="bp-feedback bp-messages error"><span class="bp-icon" aria-hidden="true"></span><p>'+e.data.error+"</p></aside>",i.parents(".bp-meeting-fields-wrap").prepend(t));i.removeClass("loading"),r("html, body").animate({scrollTop:r("#bp-zoom-single-meeting-wrapper").offset().top-100},500)}o.mask_meeting_id()}})},deleteMeeting:function(e){var t=r(e.target),n=t.parents(".meeting-item-container"),i=n.data("meeting-id"),o=n.data("id"),a=t.data("nonce");if(e.preventDefault(),!confirm(bp_zoom_meeting_vars.meeting_confirm_msg))return!1;this.abort_zoom_ajax.bind(this),this.bp_zoom_ajax=r.ajax({type:"POST",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meeting_delete",meeting_id:i,id:o,_wpnonce:a},success:function(e){if(!0===e.data.deleted){if("1"===bp_zoom_meeting_vars.is_single_meeting)return!0===e.data.is_past&&""!==bp_zoom_meeting_vars.group_meetings_past_url?window.location.href=bp_zoom_meeting_vars.group_meetings_past_url:""!==bp_zoom_meeting_vars.group_meetings_url&&(window.location.href=bp_zoom_meeting_vars.group_meetings_url),!1;r(n).remove()}}})},togglePassword:function(e){var t=r(e.currentTarget),n=t.closest(".single-meeting-item");e.preventDefault(),t.hasClass("show-pass")?(t.removeClass("on"),n.find(".toggle-password.hide-pass").addClass("on"),n.find(".hide-password").removeClass("on"),n.find(".show-password").addClass("on")):(t.removeClass("on"),n.find(".toggle-password.show-pass").addClass("on"),n.find(".show-password").removeClass("on"),n.find(".hide-password").addClass("on"))},toggleRecordingPassword:function(e){var t=r(e.currentTarget),n=t.closest(".recording-list-row");e.preventDefault(),t.hasClass("show-pass")?(n.find(".toggle-password.show-pass").addClass("bp-hide"),n.find(".show-password").removeClass("bp-hide")):(n.find(".toggle-password.show-pass").removeClass("bp-hide"),n.find(".show-password").addClass("bp-hide"))},copyInvitationDetails:function(e){var t=r(e.currentTarget);if(e.preventDefault(),t.hasClass("copied"))return!1;var n=r("#meeting-invitation"),i=t.text();n.select();try{document.execCommand("copy")&&(t.addClass("copied"),t.html(t.data("copied")),setTimeout(function(){t.removeClass("copied"),t.html(i)},3e3))}catch(e){console.log("Oops, unable to copy")}},copyDownloadLink:function(e){var t=r(e.currentTarget),n=t.html();if(e.preventDefault(),t.hasClass("copied"))return!1;var i=document.createElement("textarea");i.value=t.data("download-link"),t.closest(".bp-zoom-block-show-recordings").length?t.closest(".bp-zoom-block-show-recordings")[0].appendChild(i):document.body.appendChild(i),i.select();try{document.execCommand("copy")&&(t.addClass("copied"),t.html(t.data("copied")),setTimeout(function(){t.removeClass("copied"),t.html(n)},3e3))}catch(e){console.log("Oops, unable to copy")}t.closest(".bp-zoom-block-show-recordings").length?t.closest(".bp-zoom-block-show-recordings")[0].removeChild(i):document.body.removeChild(i)},getLinkParams:function(e,t){var n=e?-1!==e.indexOf("?")?"?"+e.split("?")[1]:"":document.location.search;if(!n)return null;var i=n.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];return t?i[t]:i},closeCreateMeetingModal:function(e){e.preventDefault(),r("#bp-meeting-create").hide()},openRecordingModal:function(e){var t=r(e.currentTarget);e.preventDefault(),t.closest(".recording-list-row").find(".bb-media-model-wrapper").show()},closeRecordingModal:function(e){e.preventDefault(),0<r(".bb-media-model-wrapper").find("video").length&&r(".bb-media-model-wrapper").find("video").get(0).pause(),0<r(".bb-media-model-wrapper").find("audio").length&&r(".bb-media-model-wrapper").find("audio").get(0).pause(),r(".bb-media-model-wrapper").hide()},checkPressedKey:function(e){switch((e=e||window.event).keyCode){case 27:this.closeRecordingModal(e)}},openMeetingActions:function(e){var t=r(e.currentTarget);e.preventDefault(),t.next(".meeting-actions-list").toggleClass("open")},searchMeetingActions:function(e){var t=r(e.currentTarget).attr("id"),n=this;"bp-zoom-meeting-recorded-switch-checkbox"!==t&&e.preventDefault();var i=!1;r("#bp-zoom-meeting-recorded-switch-checkbox").is(":checked")&&(i=!0),r("#bp-zoom-meeting-container #bp-zoom-dropdown-options-loader").show();var o={action:"zoom_meeting_search",recorded:i,page:1,search_terms:r("#bp-zoom-meeting-container #bp_zoom_meeting_search").val(),past:r("#bp-zoom-meeting-container #bp-zoom-meeting-recorded-switch-checkbox").length};r.ajax({type:"GET",url:bp_zoom_meeting_vars.ajax_url,async:!0,data:o,success:function(e){var t;void 0!==e.data&&e.data.contents&&(r("#bp-zoom-meeting-container .bp-zoom-meeting-left-inner #meetings-list").html(e.data.contents),0!=(t=r("#bp-zoom-single-meeting-wrapper").find(".meeting-item-container").data("id"))&&null!=t&&void 0!==t||r("#bp_zoom_meeting_form").length&&r("#bp_zoom_meeting_form").find("#bp-zoom-meeting-id").length&&(t=r("#bp_zoom_meeting_form").find("#bp-zoom-meeting-id").val()),t&&r("#meetings-list").find('.meeting-item[data-id="'+t+'"]').addClass("current")),r("#bp-zoom-meeting-container #bp-zoom-dropdown-options-loader").hide(),n.mask_meeting_id()}})},abort_zoom_ajax:function(){!1!==this.bp_zoom_ajax&&(this.bp_zoom_ajax.abort(),this.bp_zoom_ajax=!1)},mask_meeting_id:function(){void 0!==jQuery.fn.mask&&(r("#meetings-list").find(".meeting-id").mask("AA: 000 0000 0000"),r("#bp-zoom-single-meeting").find(".meeting-id").mask("000 0000 0000"),r(".zoom-meeting-id").mask("000 0000 0000"),r(document).find(".bb-meeting-id").mask("AA: 000 0000 0000"))},syncGroupMeetings:function(e){var t=r(e.currentTarget),n=t.data("group-id");e.preventDefault(),t.addClass("loading"),this.bp_zoom_sync_function(0,n)},bp_zoom_sync_function:function(e,t){var n=this;r.ajax({type:"POST",url:bp_zoom_meeting_vars.ajax_url,data:{action:"zoom_meetings_sync",group_id:t,offset:e},success:function(e){if(void 0!==e.success){if(!e.success||void 0===e.data)return r("#meetings-sync").removeClass("loading"),e.data.redirect_url?window.location.href=e.data.redirect_url:window.location.reload(),!1;if("running"!==e.data.status)return r("#meetings-sync").removeClass("loading"),e.data.redirect_url?window.location.href=e.data.redirect_url:window.location.reload(),!1;n.bp_zoom_sync_function(e.data.offset,t)}},error:function(){return r("#meetings-sync").removeClass("loading"),!1}})}},bp.Zoom.start()}((bp,jQuery));