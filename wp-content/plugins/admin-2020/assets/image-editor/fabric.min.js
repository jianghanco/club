/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"3.6.1"};if(typeof exports!=="undefined"){exports.fabric=fabric}else{if(typeof define==="function"&&define.amd){define([],function(){return fabric})}}if(typeof document!=="undefined"&&typeof window!=="undefined"){if(document instanceof (typeof HTMLDocument!=="undefined"?HTMLDocument:Document)){fabric.document=document}else{fabric.document=document.implementation.createHTMLDocument("")}fabric.window=window}else{var jsdom=require("jsdom");var virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;fabric.document=virtualWindow.document;fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper;fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas;fabric.window=virtualWindow;DOMParser=fabric.window.DOMParser}fabric.isTouchSupported="ontouchstart" in fabric.window||"ontouchstart" in fabric.document||(fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0);fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)";fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;fabric.reNonWord=/[ \n\.,;!\?\-]/;fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.svgNS="http://www.w3.org/2000/svg";fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.disableStyleCopyPaste=false;fabric.enableGLFiltering=true;fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.arcToSegmentsCache={};fabric.boundsOfCurveCache={};fabric.cachesBoundsOfCurve=true;fabric.forceGLPutImageData=false;fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)){console.log("max texture size: "+fabric.maxTextureSize);return(new fabric.WebglFilterBackend({tileSize:fabric.textureSize}))}else{if(fabric.Canvas2dFilterBackend){return(new fabric.Canvas2dFilterBackend())}}};if(typeof document!=="undefined"&&typeof window!=="undefined"){window.fabric=fabric}(function(){function d(f,g){if(!this.__eventListeners[f]){return}var e=this.__eventListeners[f];if(g){e[e.indexOf(g)]=false}else{fabric.util.array.fill(e,false)}}function c(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function a(e,f){if(!this.__eventListeners){return this}if(arguments.length===0){for(e in this.__eventListeners){d.call(this,e)}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return this}var f=this.__eventListeners[g];if(!f){return this}for(var j=0,e=f.length;j<e;j++){f[j]&&f[j].call(this,h||{})}this.__eventListeners[g]=f.filter(function(i){return i!==false});return this}fabric.Observable={observe:c,stopObserving:a,fire:b,on:c,off:a,trigger:b}})();fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var a=0,b=arguments.length;a<b;a++){this._onObjectAdded(arguments[a])}}this.renderOnAddRemove&&this.requestRenderAll();return this},insertAt:function(b,a,d){var c=this._objects;if(d){c[a]=b}else{c.splice(a,0,b)}this._onObjectAdded&&this._onObjectAdded(b);this.renderOnAddRemove&&this.requestRenderAll();return this},remove:function(){var e=this._objects,b,a=false;for(var c=0,d=arguments.length;c<d;c++){b=e.indexOf(arguments[c]);if(b!==-1){a=true;e.splice(b,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[c])}}this.renderOnAddRemove&&a&&this.requestRenderAll();return this},forEachObject:function(e,c){var d=this.getObjects();for(var b=0,a=d.length;b<a;b++){e.call(c,d[b],b,d)}return this},getObjects:function(a){if(typeof a==="undefined"){return this._objects.concat()}return this._objects.filter(function(b){return b.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(a){return this._objects.indexOf(a)>-1},complexity:function(){return this._objects.reduce(function(a,b){a+=b.complexity?b.complexity():0;return a},0)}};fabric.CommonMethods={_setOptions:function(a){for(var b in a){this.set(b,a[b])}},_initGradient:function(a,b){if(a&&a.colorStops&&!(a instanceof fabric.Gradient)){this.set(b,new fabric.Gradient(a))}},_initPattern:function(a,b,c){if(a&&a.source&&!(a instanceof fabric.Pattern)){this.set(b,new fabric.Pattern(a,c))}else{c&&c()}},_initClipping:function(a){if(!a.clipTo||typeof a.clipTo!=="string"){return}var b=fabric.util.getFunctionBody(a.clipTo);if(typeof b!=="undefined"){this.clipTo=new Function("ctx",b)}},_setObject:function(a){for(var b in a){this._set(b,a[b])}},set:function(a,b){if(typeof a==="object"){this._setObject(a)}else{if(typeof b==="function"&&a!=="clipTo"){this._set(a,b(this.get(a)))}else{this._set(a,b)}}return this},_set:function(a,b){this[a]=b},toggle:function(b){var a=this.get(b);if(typeof a==="boolean"){this.set(b,!a)}return this},get:function(a){return this[a]}};(function(e){var f=Math.sqrt,c=Math.atan2,d=Math.pow,a=Math.PI/180,b=Math.PI/2;fabric.util={cos:function(h){if(h===0){return 1}if(h<0){h=-h}var g=h/b;switch(g){case 1:case 3:return 0;case 2:return -1}return Math.cos(h)},sin:function(i){if(i===0){return 0}var g=i/b,h=1;if(i<0){h=-1}switch(g){case 1:return h;case 2:return 0;case 3:return -h}return Math.sin(i)},removeFromArray:function(i,h){var g=i.indexOf(h);if(g!==-1){i.splice(g,1)}return i},getRandomInt:function(h,g){return Math.floor(Math.random()*(g-h+1))+h},degreesToRadians:function(g){return g*a},radiansToDegrees:function(g){return g/a},rotatePoint:function(g,i,j){g.subtractEquals(i);var h=fabric.util.rotateVector(g,j);return new fabric.Point(h.x,h.y).addEquals(i)},rotateVector:function(g,l){var h=fabric.util.sin(l),j=fabric.util.cos(l),k=g.x*j-g.y*h,i=g.x*h+g.y*j;return{x:k,y:i}},transformPoint:function(i,h,g){if(g){return new fabric.Point(h[0]*i.x+h[2]*i.y,h[1]*i.x+h[3]*i.y)}return new fabric.Point(h[0]*i.x+h[2]*i.y+h[4],h[1]*i.x+h[3]*i.y+h[5])},makeBoundingBoxFromPoints:function(q,l){if(l){for(var o=0;o<q.length;o++){q[o]=fabric.util.transformPoint(q[o],l)}}var j=[q[0].x,q[1].x,q[2].x,q[3].x],n=fabric.util.array.min(j),h=fabric.util.array.max(j),k=h-n,p=[q[0].y,q[1].y,q[2].y,q[3].y],m=fabric.util.array.min(p),g=fabric.util.array.max(p),r=g-m;return{left:n,top:m,width:k,height:r}},invertTransform:function(h){var g=1/(h[0]*h[3]-h[1]*h[2]),i=[g*h[3],-g*h[1],-g*h[2],g*h[0]],j=fabric.util.transformPoint({x:h[4],y:h[5]},i,true);i[4]=-j.x;i[5]=-j.y;return i},toFixed:function(h,g){return parseFloat(Number(h).toFixed(g))},parseUnit:function(j,i){var h=/\D{0,2}$/.exec(j),g=parseFloat(j);if(!i){i=fabric.Text.DEFAULT_SVG_FONT_SIZE}switch(h[0]){case"mm":return g*fabric.DPI/25.4;case"cm":return g*fabric.DPI/2.54;case"in":return g*fabric.DPI;case"pt":return g*fabric.DPI/72;case"pc":return g*fabric.DPI/72*12;case"em":return g*i;default:return g}},falseFunction:function(){return false},getKlass:function(h,g){h=fabric.util.string.camelize(h.charAt(0).toUpperCase()+h.slice(1));return fabric.util.resolveNamespace(g)[h]},getSvgAttributes:function(h){var g=["instantiated_by_use","style","id","class"];switch(h){case"linearGradient":g=g.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":g=g.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":g=g.concat(["offset","stop-color","stop-opacity"]);break}return g},resolveNamespace:function(j){if(!j){return fabric}var l=j.split("."),g=l.length,h,k=e||fabric.window;for(h=0;h<g;++h){k=k[l[h]]}return k},loadImage:function(i,l,j,h){if(!i){l&&l.call(j,i);return}var g=fabric.util.createImage();var k=function(){l&&l.call(j,g);g=g.onload=g.onerror=null};g.onload=k;g.onerror=function(){fabric.log("Error loading "+g.src);l&&l.call(j,null,true);g=g.onload=g.onerror=null};if(i.indexOf("data")!==0&&h){g.crossOrigin=h}if(i.substring(0,14)==="data:image/svg"){g.onload=null;fabric.util.loadImageInDom(g,k)}g.src=i},loadImageInDom:function(g,h){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px";i.style.left=i.style.top="-100%";i.style.position="absolute";i.appendChild(g);fabric.document.querySelector("body").appendChild(i);g.onload=function(){h();i.parentNode.removeChild(i);i=null}},enlivenObjects:function(k,n,i,h){k=k||[];var l=[],m=0,g=k.length;function j(){if(++m===g){n&&n(l.filter(function(o){return o}))}}if(!g){n&&n(l);return}k.forEach(function(r,q){if(!r||!r.type){j();return}var p=fabric.util.getKlass(r.type,i);p.fromObject(r,function(s,o){o||(l[q]=s);h&&h(r,s,o);j()})})},enlivenPatterns:function(h,l){h=h||[];function j(){if(++g===k){l&&l(i)}}var i=[],g=0,k=h.length;if(!k){l&&l(i);return}h.forEach(function(n,m){if(n&&n.source){new fabric.Pattern(n,function(o){i[m]=o;j()})}else{i[m]=n;j()}})},groupSVGElements:function(i,h,j){var g;if(i&&i.length===1){return i[0]}if(h){if(h.width&&h.height){h.centerPoint={x:h.width/2,y:h.height/2}}else{delete h.width;delete h.height}}g=new fabric.Group(i,h);if(typeof j!=="undefined"){g.sourcePath=j}return g},populateWithProperties:function(l,h,k){if(k&&Object.prototype.toString.call(k)==="[object Array]"){for(var j=0,g=k.length;j<g;j++){if(k[j] in l){h[k[j]]=l[k[j]]}}}},drawDashedLine:function(p,n,k,g,l,r){var s=g-n,q=l-k,i=f(s*s+q*q),h=c(q,s),o=r.length,j=0,m=true;p.save();p.translate(n,k);p.moveTo(0,0);p.rotate(h);n=0;while(i>n){n+=r[j++%o];if(n>i){n=i}p[m?"lineTo":"moveTo"](n,0);m=!m}p.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(g){var h=fabric.util.createCanvasElement();h.width=g.width;h.height=g.height;h.getContext("2d").drawImage(g,0,0);return h},toDataURL:function(g,h,i){return g.toDataURL("image/"+h,i)},createImage:function(){return fabric.document.createElement("img")},clipContext:function(h,g){g.save();g.beginPath();h.clipTo(g);g.clip()},multiplyTransformMatrices:function(h,g,i){return[h[0]*g[0]+h[2]*g[1],h[1]*g[0]+h[3]*g[1],h[0]*g[2]+h[2]*g[3],h[1]*g[2]+h[3]*g[3],i?0:h[0]*g[4]+h[2]*g[5]+h[4],i?0:h[1]*g[4]+h[3]*g[5]+h[5]]},qrDecompose:function(g){var l=c(g[1],g[0]),i=d(g[0],2)+d(g[1],2),j=f(i),h=(g[0]*g[3]-g[2]*g[1])/j,k=c(g[0]*g[2]+g[1]*g[3],i);return{angle:l/a,scaleX:j,scaleY:h,skewX:k/a,skewY:0,translateX:g[4],translateY:g[5]}},calcRotateMatrix:function(h){if(!h.angle){return fabric.iMatrix.concat()}var i=fabric.util.degreesToRadians(h.angle),j=fabric.util.cos(i),g=fabric.util.sin(i);return[j,g,-g,j,0,0]},calcDimensionsMatrix:function(k){var j=typeof k.scaleX==="undefined"?1:k.scaleX,i=typeof k.scaleY==="undefined"?1:k.scaleY,l=[k.flipX?-j:j,0,0,k.flipY?-i:i,0,0],h=fabric.util.multiplyTransformMatrices,g=fabric.util.degreesToRadians;if(k.skewX){l=h(l,[1,0,Math.tan(g(k.skewX)),1],true)}if(k.skewY){l=h(l,[1,Math.tan(g(k.skewY)),0,1],true)}return l},composeMatrix:function(i){var h=[1,0,0,1,i.translateX||0,i.translateY||0],g=fabric.util.multiplyTransformMatrices;if(i.angle){h=g(h,fabric.util.calcRotateMatrix(i))}if(i.scaleX||i.scaleY||i.skewX||i.skewY||i.flipX||i.flipY){h=g(h,fabric.util.calcDimensionsMatrix(i))}return h},customTransformMatrix:function(h,g,i){return fabric.util.composeMatrix({scaleX:h,scaleY:g,skewX:i})},resetObjectTransform:function(g){g.scaleX=1;g.scaleY=1;g.skewX=0;g.skewY=0;g.flipX=false;g.flipY=false;g.rotate(0)},saveObjectTransform:function(g){return{scaleX:g.scaleX,scaleY:g.scaleY,skewX:g.skewX,skewY:g.skewY,angle:g.angle,left:g.left,flipX:g.flipX,flipY:g.flipY,top:g.top}},getFunctionBody:function(g){return(String(g).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(q,o,n,m){if(m>0){if(o>m){o-=m}else{o=0}if(n>m){n-=m}else{n=0}}var h=true,k,p,g=q.getImageData(o,n,(m*2)||1,(m*2)||1),j=g.data.length;for(k=3;k<j;k+=4){p=g.data[k];h=p<=0;if(h===false){break}}g=null;return h},parsePreserveAspectRatioAttribute:function(j){var k="meet",h="Mid",g="Mid",i=j.split(" "),l;if(i&&i.length){k=i.pop();if(k!=="meet"&&k!=="slice"){l=k;k="meet"}else{if(i.length){l=i.pop()}}}h=l!=="none"?l.slice(1,4):"none";g=l!=="none"?l.slice(5,8):"none";return{meetOrSlice:k,alignX:h,alignY:g}},clearFabricFontCache:function(g){g=(g||"").toLowerCase();if(!g){fabric.charWidthsCache={}}else{if(fabric.charWidthsCache[g]){delete fabric.charWidthsCache[g]}}},limitDimsByArea:function(h,i){var j=Math.sqrt(i*h),g=Math.floor(i/j);return{x:Math.floor(j),y:g}},capValue:function(h,i,g){return Math.max(h,Math.min(i,g))},findScaleToFit:function(h,g){return Math.min(g.width/h.width,g.height/h.height)},findScaleToCover:function(h,g){return Math.max(g.width/h.width,g.height/h.height)},matrixToSVG:function(g){return"matrix("+g.map(function(h){return fabric.util.toFixed(h,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}})(typeof exports!=="undefined"?exports:this);(function(){var b=Array.prototype.join;function e(j,g,o,n,f,y,t){var P=b.call(arguments);if(fabric.arcToSegmentsCache[P]){return fabric.arcToSegmentsCache[P]}var F=Math.PI,p=t*F/180,L=fabric.util.sin(p),E=fabric.util.cos(p),z=0,w=0;o=Math.abs(o);n=Math.abs(n);var D=-E*j*0.5-L*g*0.5,A=-E*g*0.5+L*j*0.5,M=o*o,m=n*n,h=A*A,I=D*D,K=M*m-M*h-m*I,H=0;if(K<0){var x=Math.sqrt(1-K/(M*m));o*=x;n*=x}else{H=(f===y?-1:1)*Math.sqrt(K/(M*h+m*I))}var l=H*o*A/n,k=-H*n*D/o,C=E*l-L*k+j*0.5,N=L*l+E*k+g*0.5,O=c(1,0,(D-l)/o,(A-k)/n),B=c((D-l)/o,(A-k)/n,(-D-l)/o,(-A-k)/n);if(y===0&&B>0){B-=2*F}else{if(y===1&&B<0){B+=2*F}}var G=Math.ceil(Math.abs(B/F*2)),r=[],v=B/G,q=8/3*Math.sin(v/4)*Math.sin(v/4)/Math.sin(v/2),u=O+v;for(var J=0;J<G;J++){r[J]=d(O,u,E,L,o,n,C,N,q,z,w);z=r[J][4];w=r[J][5];O=u;u+=v}fabric.arcToSegmentsCache[P]=r;return r}function d(p,n,t,x,k,j,s,z,l,r,q){var i=fabric.util.cos(p),v=fabric.util.sin(p),h=fabric.util.cos(n),u=fabric.util.sin(n),g=t*k*h-x*j*u+s,f=x*k*h+t*j*u+z,o=r+l*(-t*k*v-x*j*i),m=q+l*(-x*k*v+t*j*i),y=g+l*(t*k*u+x*j*h),w=f+l*(x*k*u-t*j*h);return[o,m,y,w,g,f]}function c(i,h,k,j){var g=Math.atan2(h,i),f=Math.atan2(j,k);if(f>=g){return f-g}else{return 2*Math.PI-(g-f)}}fabric.util.drawArc=function(u,m,l,r){var j=r[0],f=r[1],k=r[2],s=r[3],t=r[4],p=r[5],n=r[6],h=[[],[],[],[]],g=e(p-m,n-l,j,f,s,t,k);for(var o=0,q=g.length;o<q;o++){h[o][0]=g[o][0]+m;h[o][1]=g[o][1]+l;h[o][2]=g[o][2]+m;h[o][3]=g[o][3]+l;h[o][4]=g[o][4]+m;h[o][5]=g[o][5]+l;u.bezierCurveTo.apply(u,h[o])}};fabric.util.getBoundsOfArc=function(m,l,j,g,k,u,v,q,o){var t=0,s=0,n,f=[],h=e(q-m,o-l,j,g,u,v,k);for(var p=0,r=h.length;p<r;p++){n=a(t,s,h[p][0],h[p][1],h[p][2],h[p][3],h[p][4],h[p][5]);f.push({x:n[0].x+m,y:n[0].y+l});f.push({x:n[1].x+m,y:n[1].y+l});t=h[p][4];s=h[p][5]}return f};function a(I,l,H,h,G,g,F,f){var N;if(fabric.cachesBoundsOfCurve){N=b.call(arguments);if(fabric.boundsOfCurveCache[N]){return fabric.boundsOfCurveCache[N]}}var M=Math.sqrt,B=Math.min,E=Math.max,w=Math.abs,z=[],m=[[],[]],L,K,J,u,r,p,k,n;K=6*I-12*H+6*G;L=-3*I+9*H-9*G+3*F;J=3*H-3*I;for(var D=0;D<2;++D){if(D>0){K=6*l-12*h+6*g;L=-3*l+9*h-9*g+3*f;J=3*h-3*l}if(w(L)<1e-12){if(w(K)<1e-12){continue}u=-J/K;if(0<u&&u<1){z.push(u)}continue}k=K*K-4*J*L;if(k<0){continue}n=M(k);r=(-K+n)/(2*L);if(0<r&&r<1){z.push(r)}p=(-K-n)/(2*L);if(0<p&&p<1){z.push(p)}}var q,o,C=z.length,v=C,A;while(C--){u=z[C];A=1-u;q=(A*A*A*I)+(3*A*A*u*H)+(3*A*u*u*G)+(u*u*u*F);m[0][C]=q;o=(A*A*A*l)+(3*A*A*u*h)+(3*A*u*u*g)+(u*u*u*f);m[1][C]=o}m[0][v]=I;m[1][v]=l;m[0][v+1]=F;m[1][v+1]=f;var s=[{x:B.apply(null,m[0]),y:B.apply(null,m[1])},{x:E.apply(null,m[0]),y:E.apply(null,m[1])}];if(fabric.cachesBoundsOfCurve){fabric.boundsOfCurveCache[N]=s}return s}fabric.util.getBoundsOfCurve=a})();(function(){var f=Array.prototype.slice;function b(m,l){var j=f.call(arguments,2),h=[];for(var k=0,g=m.length;k<g;k++){h[k]=j.length?m[k][l].apply(m[k],j):m[k][l].call(m[k])}return h}function a(h,g){return e(h,g,function(j,i){return j>=i})}function c(h,g){return e(h,g,function(j,i){return j<i})}function d(i,h){var g=i.length;while(g--){i[g]=h}return i}function e(l,j,k){if(!l||l.length===0){return}var h=l.length-1,g=j?l[h][j]:l[h];if(j){while(h--){if(k(l[h][j],g)){g=l[h][j]}}}else{while(h--){if(k(l[h],g)){g=l[h]}}}return g}fabric.util.array={fill:d,invoke:b,min:c,max:a}})();(function(){function b(d,h,e){if(e){if(!fabric.isLikelyNode&&h instanceof Element){d=h}else{if(h instanceof Array){d=[];for(var f=0,c=h.length;f<c;f++){d[f]=b({},h[f],e)}}else{if(h&&typeof h==="object"){for(var g in h){if(g==="canvas"){d[g]=b({},h[g])}else{if(h.hasOwnProperty(g)){d[g]=b({},h[g],e)}}}}else{d=h}}}}else{for(var g in h){d[g]=h[g]}}return d}function a(d,c){return b({},d,c)}fabric.util.object={extend:b,clone:a};fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function b(f){return f.replace(/-+(.)?/g,function(g,h){return h?h.toUpperCase():""})}function d(f,g){return f.charAt(0).toUpperCase()+(g?f.slice(1):f.slice(1).toLowerCase())}function a(f){return f.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(h){var g=0,j,f=[];for(g=0,j;g<h.length;g++){if((j=e(h,g))===false){continue}f.push(j)}return f}function e(k,f){var j=k.charCodeAt(f);if(isNaN(j)){return""}if(j<55296||j>57343){return k.charAt(f)}if(55296<=j&&j<=56319){if(k.length<=(f+1)){throw"High surrogate without following low surrogate"}var g=k.charCodeAt(f+1);if(56320>g||g>57343){throw"High surrogate without following low surrogate"}return k.charAt(f)+k.charAt(f+1)}if(f===0){throw"Low surrogate without preceding high surrogate"}var h=k.charCodeAt(f-1);if(55296>h||h>56319){throw"Low surrogate without preceding high surrogate"}return false}fabric.util.string={camelize:b,capitalize:d,escapeXml:a,graphemeSplit:c}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=null,k=this;while(k.constructor.superclass){var j=k.constructor.superclass.prototype[h];if(k[h]!==j){i=j;break}k=k.constructor.superclass.prototype}if(!i){return console.log("tried to callSuper "+h+", method not found in prototype chain",this)}return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}fabric.util.createClass=e})();(function(){var b=!!fabric.document.createElement("div").attachEvent;fabric.util.addListener=function(e,c,f,d){e&&e.addEventListener(c,f,b?false:d)};fabric.util.removeListener=function(e,c,f,d){e&&e.removeEventListener(c,f,b?false:d)};function a(c){var d=c.changedTouches;if(d&&d[0]){return d[0]}return c}fabric.util.getPointer=function(f){var e=f.target,c=fabric.util.getScrollLeftTop(e),d=a(f);return{x:d.clientX+c.left,y:d.clientY+c.top}}})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var l=Array.prototype.slice;function k(n){return typeof n==="string"?fabric.document.getElementById(n):n}var m,d=function(n){return l.call(n,0)};try{m=d(fabric.document.childNodes) instanceof Array}catch(c){}if(!m){d=function(o){var n=new Array(o.length),p=o.length;while(p--){n[p]=o[p]}return n}}function e(o,n){var p=fabric.document.createElement(o);for(var q in n){if(q==="class"){p.className=n[q]}else{if(q==="for"){p.htmlFor=n[q]}else{p.setAttribute(q,n[q])}}}return p}function i(n,o){if(n&&(" "+n.className+" ").indexOf(" "+o+" ")===-1){n.className+=(n.className?" ":"")+o}}function h(o,p,n){if(typeof p==="string"){p=e(p,n)}if(o.parentNode){o.parentNode.replaceChild(p,o)}p.appendChild(o);return p}function a(p){var r=0,q=0,o=fabric.document.documentElement,n=fabric.document.body||{scrollLeft:0,scrollTop:0};while(p&&(p.parentNode||p.host)){p=p.parentNode||p.host;if(p===fabric.document){r=n.scrollLeft||o.scrollLeft||0;q=n.scrollTop||o.scrollTop||0}else{r+=p.scrollLeft||0;q+=p.scrollTop||0}if(p.nodeType===1&&p.style.position==="fixed"){break}}return{left:r,top:q}}function g(q){var o,t=q&&q.ownerDocument,r={left:0,top:0},u={left:0,top:0},s,p={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!t){return u}for(var n in p){u[p[n]]+=parseInt(f(q,n),10)||0}o=t.documentElement;if(typeof q.getBoundingClientRect!=="undefined"){r=q.getBoundingClientRect()}s=a(q);return{left:r.left+s.left-(o.clientLeft||0)+u.left,top:r.top+s.top-(o.clientTop||0)+u.top}}var f;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){f=function(o,n){var p=fabric.document.defaultView.getComputedStyle(o,null);return p?p[n]:undefined}}else{f=function(o,n){var p=o.style[n];if(!p&&o.currentStyle){p=o.currentStyle[n]}return p}}(function(){var o=fabric.document.documentElement.style,p="userSelect" in o?"userSelect":"MozUserSelect" in o?"MozUserSelect":"WebkitUserSelect" in o?"WebkitUserSelect":"KhtmlUserSelect" in o?"KhtmlUserSelect":"";function q(r){if(typeof r.onselectstart!=="undefined"){r.onselectstart=fabric.util.falseFunction}if(p){r.style[p]="none"}else{if(typeof r.unselectable==="string"){r.unselectable="on"}}return r}function n(r){if(typeof r.onselectstart!=="undefined"){r.onselectstart=null}if(p){r.style[p]=""}else{if(typeof r.unselectable==="string"){r.unselectable=""}}return r}fabric.util.makeElementUnselectable=q;fabric.util.makeElementSelectable=n})();(function(){function n(o,s){var q=fabric.document.getElementsByTagName("head")[0],p=fabric.document.createElement("script"),r=true;p.onload=p.onreadystatechange=function(t){if(r){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}r=false;s(t||fabric.window.event);p=p.onload=p.onreadystatechange=null}};p.src=o;q.appendChild(p)}fabric.util.getScript=n})();function j(o){var n=fabric.jsdomImplForWrapper(o);return n._canvas||n._image}function b(o){if(!fabric.isLikelyNode){return}var n=fabric.jsdomImplForWrapper(o);if(n){n._image=null;n._canvas=null;n._currentSrc=null;n._attributes=null;n._classList=null}}fabric.util.getById=k;fabric.util.toArray=d;fabric.util.makeElement=e;fabric.util.addClass=i;fabric.util.wrapElement=h;fabric.util.getScrollLeftTop=a;fabric.util.getElementOffset=g;fabric.util.getElementStyle=f;fabric.util.getNodeCanvas=j;fabric.util.cleanUpJsdomNode=b})();(function(){function c(d,e){return d+(/\?/.test(d)?"&":"?")+e}function a(){}function b(f,e){e||(e={});var i=e.method?e.method.toUpperCase():"GET",g=e.onComplete||function(){},h=new fabric.window.XMLHttpRequest(),d=e.body||e.parameters;h.onreadystatechange=function(){if(h.readyState===4){g(h);h.onreadystatechange=a}};if(i==="GET"){d=null;if(typeof e.parameters==="string"){f=c(f,e.parameters)}}h.open(i,f,true);if(i==="POST"||i==="PUT"){h.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}h.send(d);return h}fabric.util.request=b})();fabric.log=console.log;fabric.warn=console.warn;(function(){function f(){return false}function g(i,h,k,j){return -k*Math.cos(i/j*(Math.PI/2))+k+h}function b(h){c(function(p){h||(h={});var j=p||+new Date(),m=h.duration||500,t=j+m,k,q=h.onChange||f,n=h.abort||f,l=h.onComplete||f,r=h.easing||g,i="startValue" in h?h.startValue:0,s="endValue" in h?h.endValue:100,u=h.byValue||s-i;h.onStart&&h.onStart();(function o(v){k=v||+new Date();var x=k>t?m:(k-j),w=x/m,y=r(x,i,u,m),z=Math.abs((y-i)/u);if(n()){l(s,1,1);return}if(k>t){q(s,1,1);l(s,1,1);return}else{q(y,z,w);c(o)}})(j)})}var d=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(h){return fabric.window.setTimeout(h,1000/60)};var e=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function c(){return d.apply(fabric.window,arguments)}function a(){return e.apply(fabric.window,arguments)}fabric.util.animate=b;fabric.util.requestAnimFrame=c;fabric.util.cancelAnimFrame=a})();(function(){function a(e,c,f){var d="rgba("+parseInt((e[0]+f*(c[0]-e[0])),10)+","+parseInt((e[1]+f*(c[1]-e[1])),10)+","+parseInt((e[2]+f*(c[2]-e[2])),10);d+=","+(e&&c?parseFloat(e[3]+f*(c[3]-e[3])):1);d+=")";return d}function b(d,f,h,c){var g=new fabric.Color(d).getSource(),e=new fabric.Color(f).getSource();c=c||{};fabric.util.animate(fabric.util.object.extend(c,{duration:h||500,startValue:g,endValue:e,byValue:e,easing:function(j,i,l,m){var k=c.colorEasing?c.colorEasing(j,m):1-Math.cos(j/m*(Math.PI/2));return a(i,l,k)}}))}fabric.util.animateColor=b})();(function(){function y(C,F,E,D){if(C<Math.abs(F)){C=F;D=E/4}else{if(F===0&&C===0){D=E/(2*Math.PI)*Math.asin(1)}else{D=E/(2*Math.PI)*Math.asin(F/C)}}return{a:C,c:F,p:E,s:D}}function p(D,C,E){return D.a*Math.pow(2,10*(C-=1))*Math.sin((C*E-D.s)*(2*Math.PI)/D.p)}function o(D,C,F,E){return F*((D=D/E-1)*D*D+1)+C}function s(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D+C}return F/2*((D-=2)*D*D+2)+C}function r(D,C,F,E){return F*(D/=E)*D*D*D+C}function f(D,C,F,E){return -F*((D=D/E-1)*D*D*D-1)+C}function j(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D+C}return -F/2*((D-=2)*D*D*D-2)+C}function w(D,C,F,E){return F*(D/=E)*D*D*D*D+C}function i(D,C,F,E){return F*((D=D/E-1)*D*D*D*D+1)+C}function l(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D*D+C}return F/2*((D-=2)*D*D*D*D+2)+C}function e(D,C,F,E){return -F*Math.cos(D/E*(Math.PI/2))+F+C}function m(D,C,F,E){return F*Math.sin(D/E*(Math.PI/2))+C}function t(D,C,F,E){return -F/2*(Math.cos(Math.PI*D/E)-1)+C}function B(D,C,F,E){return(D===0)?C:F*Math.pow(2,10*(D/E-1))+C}function c(D,C,F,E){return(D===E)?C+F:F*(-Math.pow(2,-10*D/E)+1)+C}function h(D,C,F,E){if(D===0){return C}if(D===E){return C+F}D/=E/2;if(D<1){return F/2*Math.pow(2,10*(D-1))+C}return F/2*(-Math.pow(2,-10*--D)+2)+C}function g(D,C,F,E){return -F*(Math.sqrt(1-(D/=E)*D)-1)+C}function n(D,C,F,E){return F*Math.sqrt(1-(D=D/E-1)*D)+C}function v(D,C,F,E){D/=E/2;if(D<1){return -F/2*(Math.sqrt(1-D*D)-1)+C}return F/2*(Math.sqrt(1-(D-=2)*D)+1)+C}function q(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return -p(G,E,I)+C}function x(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return G.a*Math.pow(2,-10*E)*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)+G.c+C}function a(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I/2;if(E===2){return C+J}if(!H){H=I*(0.3*1.5)}var G=y(D,J,H,F);if(E<1){return -0.5*p(G,E,I)+C}return G.a*Math.pow(2,-10*(E-=1))*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)*0.5+G.c+C}function k(D,C,G,F,E){if(E===undefined){E=1.70158}return G*(D/=F)*D*((E+1)*D-E)+C}function u(D,C,G,F,E){if(E===undefined){E=1.70158}return G*((D=D/F-1)*D*((E+1)*D+E)+1)+C}function z(D,C,G,F,E){if(E===undefined){E=1.70158}D/=F/2;if(D<1){return G/2*(D*D*(((E*=(1.525))+1)*D-E))+C}return G/2*((D-=2)*D*(((E*=(1.525))+1)*D+E)+2)+C}function d(D,C,F,E){return F-b(E-D,0,F,E)+C}function b(D,C,F,E){if((D/=E)<(1/2.75)){return F*(7.5625*D*D)+C}else{if(D<(2/2.75)){return F*(7.5625*(D-=(1.5/2.75))*D+0.75)+C}else{if(D<(2.5/2.75)){return F*(7.5625*(D-=(2.25/2.75))*D+0.9375)+C}else{return F*(7.5625*(D-=(2.625/2.75))*D+0.984375)+C}}}}function A(D,C,F,E){if(D<E/2){return d(D*2,0,F,E)*0.5+C}return b(D*2-E,0,F,E)*0.5+F*0.5+C}fabric.util.ease={easeInQuad:function(D,C,F,E){return F*(D/=E)*D+C},easeOutQuad:function(D,C,F,E){return -F*(D/=E)*(D-2)+C},easeInOutQuad:function(D,C,F,E){D/=(E/2);if(D<1){return F/2*D*D+C}return -F/2*((--D)*(D-2)-1)+C},easeInCubic:function(D,C,F,E){return F*(D/=E)*D*D+C},easeOutCubic:o,easeInOutCubic:s,easeInQuart:r,easeOutQuart:f,easeInOutQuart:j,easeInQuint:w,easeOutQuint:i,easeInOutQuint:l,easeInSine:e,easeOutSine:m,easeInOutSine:t,easeInExpo:B,easeOutExpo:c,easeInOutExpo:h,easeInCirc:g,easeOutCirc:n,easeInOutCirc:v,easeInElastic:q,easeOutElastic:x,easeInOutElastic:a,easeInBack:k,easeOutBack:u,easeInOutBack:z,easeInBounce:d,easeOutBounce:b,easeInOutBounce:A}})();(function(v){var q=v.fabric||(v.fabric={}),C=q.util.object.extend,E=q.util.object.clone,p=q.util.toFixed,s=q.util.parseUnit,y=q.util.multiplyTransformMatrices,e=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],G=["symbol","image","marker","pattern","view","svg"],g=["pattern","defs","symbol","metadata","clipPath","mask","desc"],D=["symbol","g","a","svg","clipPath","defs"],z={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},i={stroke:"strokeOpacity",fill:"fillOpacity"},A="font-size",F="clip-path";q.svgValidTagNamesRegEx=h(e);q.svgViewBoxElementsRegEx=h(G);q.svgInvalidAncestorsRegEx=h(g);q.svgValidParentsRegEx=h(D);q.cssRules={};q.gradientDefs={};q.clipPaths={};function b(H){if(H in z){return z[H]}return H}function k(I,N,L,M){var J=Object.prototype.toString.call(N)==="[object Array]",K;if((I==="fill"||I==="stroke")&&N==="none"){N=""}else{if(I==="vector-effect"){N=N==="non-scaling-stroke"}else{if(I==="strokeDashArray"){if(N==="none"){N=null}else{N=N.replace(/,/g," ").split(/\s+/).map(parseFloat)}}else{if(I==="transformMatrix"){if(L&&L.transformMatrix){N=y(L.transformMatrix,q.parseTransformAttribute(N))}else{N=q.parseTransformAttribute(N)}}else{if(I==="visible"){N=N!=="none"&&N!=="hidden";if(L&&L.visible===false){N=false}}else{if(I==="opacity"){N=parseFloat(N);if(L&&typeof L.opacity!=="undefined"){N*=L.opacity}}else{if(I==="textAnchor"){N=N==="start"?"left":N==="end"?"right":"center"}else{if(I==="charSpacing"){K=s(N,M)/M*1000}else{if(I==="paintFirst"){var H=N.indexOf("fill");var O=N.indexOf("stroke");var N="fill";if(H>-1&&O>-1&&O<H){N="stroke"}else{if(H===-1&&O>-1){N="stroke"}}}else{if(I==="href"||I==="xlink:href"){return N}else{K=J?N.map(s):s(N,M)}}}}}}}}}}return(!J&&isNaN(K)?N:K)}function h(H){return new RegExp("^("+H.join("|")+")\\b","i")}function d(J){for(var H in i){if(typeof J[i[H]]==="undefined"||J[H]===""){continue}if(typeof J[H]==="undefined"){if(!q.Object.prototype[H]){continue}J[H]=q.Object.prototype[H]}if(J[H].indexOf("url(")===0){continue}var I=new q.Color(J[H]);J[H]=I.setAlpha(p(I.getAlpha()*J[i[H]],2)).toRgba()}return J}function u(M,K){var N,L=[],I,J,H;for(J=0,H=K.length;J<H;J++){N=K[J];I=M.getElementsByTagName(N);L=L.concat(Array.prototype.slice.call(I))}return L}q.parseTransformAttribute=(function(){function H(ab,ac){var ad=q.util.cos(ac[0]),aa=q.util.sin(ac[0]),Z=0,ae=0;if(ac.length===3){Z=ac[1];ae=ac[2]}ab[0]=ad;ab[1]=aa;ab[2]=-aa;ab[3]=ad;ab[4]=Z-(ad*Z-aa*ae);ab[5]=ae-(aa*Z+ad*ae)}function K(ab,ac){var aa=ac[0],Z=(ac.length===2)?ac[1]:ac[0];ab[0]=aa;ab[3]=Z}function X(Z,aa,ab){Z[ab]=Math.tan(q.util.degreesToRadians(aa[0]))}function S(Z,aa){Z[4]=aa[0];if(aa.length===2){Z[5]=aa[1]}}var M=q.iMatrix,I=q.reNum,U="(?:\\s+,?\\s*|,\\s*)",N="(?:(skewX)\\s*\\(\\s*("+I+")\\s*\\))",L="(?:(skewY)\\s*\\(\\s*("+I+")\\s*\\))",V="(?:(rotate)\\s*\\(\\s*("+I+")(?:"+U+"("+I+")"+U+"("+I+"))?\\s*\\))",Y="(?:(scale)\\s*\\(\\s*("+I+")(?:"+U+"("+I+"))?\\s*\\))",Q="(?:(translate)\\s*\\(\\s*("+I+")(?:"+U+"("+I+"))?\\s*\\))",T="(?:(matrix)\\s*\\(\\s*("+I+")"+U+"("+I+")"+U+"("+I+")"+U+"("+I+")"+U+"("+I+")"+U+"("+I+")\\s*\\))",R="(?:"+T+"|"+Q+"|"+Y+"|"+V+"|"+N+"|"+L+")",O="(?:"+R+"(?:"+U+"*"+R+")*)",W="^\\s*(?:"+O+"?)\\s*$",P=new RegExp(W),J=new RegExp(R,"g");return function(ac){var Z=M.concat(),aa=[];if(!ac||(ac&&!P.test(ac))){return Z}ac.replace(J,function(ag){var ad=new RegExp(R).exec(ag).filter(function(ah){return(!!ah)}),ae=ad[1],af=ad.slice(2).map(parseFloat);switch(ae){case"translate":S(Z,af);break;case"rotate":af[0]=q.util.degreesToRadians(af[0]);H(Z,af);break;case"scale":K(Z,af);break;case"skewX":X(Z,af,2);break;case"skewY":X(Z,af,1);break;case"matrix":Z=af;break}aa.push(Z.concat());Z=M.concat()});var ab=aa[0];while(aa.length>1){aa.shift();ab=q.util.multiplyTransformMatrices(ab,aa[0])}return ab}})();function r(J,I){var H,K;J.replace(/;\s*$/,"").split(";").forEach(function(L){var M=L.split(":");H=M[0].trim().toLowerCase();K=M[1].trim();I[H]=K})}function o(J,I){var H,K;for(var L in J){if(typeof J[L]==="undefined"){continue}H=L.toLowerCase();K=J[L];I[H]=K}}function B(I,H){var J={};for(var L in q.cssRules[H]){if(x(I,L.split(" "))){for(var K in q.cssRules[H][L]){J[K]=q.cssRules[H][L][K]}}}return J}function x(J,I){var H,K=true;H=m(J,I.pop());if(H&&I.length){K=n(J,I)}return H&&K&&(I.length===0)}function n(J,I){var H,K=true;while(J.parentNode&&J.parentNode.nodeType===1&&I.length){if(K){H=I.pop()}J=J.parentNode;K=m(J,H)}return I.length===0}function m(J,H){var N=J.nodeName,L=J.getAttribute("class"),M=J.getAttribute("id"),K,I;K=new RegExp("^"+N,"i");H=H.replace(K,"");if(M&&H.length){K=new RegExp("#"+M+"(?![a-zA-Z\\-]+)","i");H=H.replace(K,"")}if(L&&H.length){L=L.split(" ");for(I=L.length;I--;){K=new RegExp("\\."+L[I]+"(?![a-zA-Z\\-]+)","i");H=H.replace(K,"")}}return H.length===0}function t(M,N){var J;M.getElementById&&(J=M.getElementById(N));if(J){return J}var L,I,H,K=M.getElementsByTagName("*");for(I=0,H=K.length;I<H;I++){L=K[I];if(N===L.getAttribute("id")){return L}}}function f(V){var X=u(V,["use","svg:use"]),P=0;while(X.length&&P<X.length){var K=X[P],N=(K.getAttribute("xlink:href")||K.getAttribute("href")).substr(1),U=K.getAttribute("x")||0,T=K.getAttribute("y")||0,L=t(V,N).cloneNode(true),H=(L.getAttribute("transform")||"")+" translate("+U+", "+T+")",Q,J=X.length,S,O,W,R,M=q.svgNS;j(L);if(/^svg$/i.test(L.nodeName)){var I=L.ownerDocument.createElementNS(M,"g");for(O=0,W=L.attributes,R=W.length;O<R;O++){S=W.item(O);I.setAttributeNS(M,S.nodeName,S.nodeValue)}while(L.firstChild){I.appendChild(L.firstChild)}L=I}for(O=0,W=K.attributes,R=W.length;O<R;O++){S=W.item(O);if(S.nodeName==="x"||S.nodeName==="y"||S.nodeName==="xlink:href"||S.nodeName==="href"){continue}if(S.nodeName==="transform"){H=S.nodeValue+" "+H}else{L.setAttribute(S.nodeName,S.nodeValue)}}L.setAttribute("transform",H);L.setAttribute("instantiated_by_use","1");L.removeAttribute("id");Q=K.parentNode;Q.replaceChild(L,K);if(X.length===J){P++}}}var l=new RegExp("^\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*$");function j(I){var J=I.getAttribute("viewBox"),ab=1,Z=1,aa=0,Y=0,M,T,W,H,S=I.getAttribute("width"),U=I.getAttribute("height"),N=I.getAttribute("x")||0,L=I.getAttribute("y")||0,P=I.getAttribute("preserveAspectRatio")||"",ac=(!J||!q.svgViewBoxElementsRegEx.test(I.nodeName)||!(J=J.match(l))),R=(!S||!U||S==="100%"||U==="100%"),V=ac&&R,X={},Q="",K=0,O=0;X.width=0;X.height=0;X.toBeParsed=V;if(V){return X}if(ac){X.width=s(S);X.height=s(U);return X}aa=-parseFloat(J[1]);Y=-parseFloat(J[2]);M=parseFloat(J[3]);T=parseFloat(J[4]);X.minX=aa;X.minY=Y;X.viewBoxWidth=M;X.viewBoxHeight=T;if(!R){X.width=s(S);X.height=s(U);ab=X.width/M;Z=X.height/T}else{X.width=M;X.height=T}P=q.util.parsePreserveAspectRatioAttribute(P);if(P.alignX!=="none"){if(P.meetOrSlice==="meet"){Z=ab=(ab>Z?Z:ab)}if(P.meetOrSlice==="slice"){Z=ab=(ab>Z?ab:Z)}K=X.width-M*ab;O=X.height-T*ab;if(P.alignX==="Mid"){K/=2}if(P.alignY==="Mid"){O/=2}if(P.alignX==="Min"){K=0}if(P.alignY==="Min"){O=0}}if(ab===1&&Z===1&&aa===0&&Y===0&&N===0&&L===0){return X}if(N||L){Q=" translate("+s(N)+" "+s(L)+") "}W=Q+" matrix("+ab+" 0 0 "+Z+" "+(aa*ab+K)+" "+(Y*Z+O)+") ";X.viewboxTransform=q.parseTransformAttribute(W);if(I.nodeName==="svg"){H=I.ownerDocument.createElementNS(q.svgNS,"g");while(I.firstChild){H.appendChild(I.firstChild)}I.appendChild(H)}else{H=I;W=H.getAttribute("transform")+W}H.setAttribute("transform",W);return X}function a(H,I){while(H&&(H=H.parentNode)){if(H.nodeName&&I.test(H.nodeName.replace("svg:",""))&&!H.getAttribute("instantiated_by_use")){return true}}return false}q.parseSVGDocument=function(Q,R,O,J){if(!Q){return}f(Q);var P=q.Object.__uid++,K,M,S=j(Q),I=q.util.toArray(Q.getElementsByTagName("*"));S.crossOrigin=J&&J.crossOrigin;S.svgUid=P;if(I.length===0&&q.isLikelyNode){I=Q.selectNodes('//*[name(.)!="svg"]');var L=[];for(K=0,M=I.length;K<M;K++){L[K]=I[K]}I=L}var H=I.filter(function(T){j(T);return q.svgValidTagNamesRegEx.test(T.nodeName.replace("svg:",""))&&!a(T,q.svgInvalidAncestorsRegEx)});if(!H||(H&&!H.length)){R&&R([],{});return}var N={};I.filter(function(T){return T.nodeName.replace("svg:","")==="clipPath"}).forEach(function(T){var U=T.getAttribute("id");N[U]=q.util.toArray(T.getElementsByTagName("*")).filter(function(V){return q.svgValidTagNamesRegEx.test(V.nodeName.replace("svg:",""))})});q.gradientDefs[P]=q.getGradientDefs(Q);q.cssRules[P]=q.getCSSRules(Q);q.clipPaths[P]=N;q.parseElements(H,function(U,T){if(R){R(U,S,T,I);delete q.gradientDefs[P];delete q.cssRules[P];delete q.clipPaths[P]}},E(S),O,J)};function w(N,M){var I=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],J="xlink:href",L=M.getAttribute(J).substr(1),K=t(N,L);if(K&&K.getAttribute(J)){w(N,K)}I.forEach(function(O){if(K&&!M.hasAttribute(O)&&K.hasAttribute(O)){M.setAttribute(O,K.getAttribute(O))}});if(!M.children.length){var H=K.cloneNode(true);while(H.firstChild){M.appendChild(H.firstChild)}}M.removeAttribute(J)}var c=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+q.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+q.reNum+"))?\\s+(.*)");C(q,{parseFontDeclaration:function(N,I){var K=N.match(c);if(!K){return}var O=K[1],J=K[3],M=K[4],L=K[5],H=K[6];if(O){I.fontStyle=O}if(J){I.fontWeight=isNaN(parseFloat(J))?J:parseFloat(J)}if(M){I.fontSize=s(M)}if(H){I.fontFamily=H}if(L){I.lineHeight=L==="normal"?1:L}},getGradientDefs:function(M){var H=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],J=u(M,H),K,I=0,L={};I=J.length;while(I--){K=J[I];if(K.getAttribute("xlink:href")){w(M,K)}L[K.getAttribute("id")]=K}return L},parseAttributes:function(L,J,O){if(!L){return}var Q,K={},U,I;if(typeof O==="undefined"){O=L.getAttribute("svgUid")}if(L.parentNode&&q.svgValidParentsRegEx.test(L.parentNode.nodeName)){K=q.parseAttributes(L.parentNode,J,O)}var T=J.reduce(function(W,V){Q=L.getAttribute(V);if(Q){W[V]=Q}return W},{});var M=C(B(L,O),q.parseStyleAttribute(L));T=C(T,M);if(M[F]){L.setAttribute(F,M[F])}U=I=K.fontSize||q.Text.DEFAULT_SVG_FONT_SIZE;if(T[A]){T[A]=U=s(T[A],I)}var R,P,H={};for(var N in T){R=b(N);P=k(R,T[N],K,U);H[R]=P}if(H&&H.font){q.parseFontDeclaration(H.font,H)}var S=C(K,H);return q.svgValidParentsRegEx.test(L.nodeName)?S:d(S)},parseElements:function(K,L,I,H,J){new q.ElementsParser(K,L,I,H,J).parse()},parseStyleAttribute:function(I){var H={},J=I.getAttribute("style");if(!J){return H}if(typeof J==="string"){r(J,H)}else{o(J,H)}return H},parsePointsAttribute:function(K){if(!K){return null}K=K.replace(/,/g," ").trim();K=K.split(/\s+/);var I=[],J,H;for(J=0,H=K.length;J<H;J+=2){I.push({x:parseFloat(K[J]),y:parseFloat(K[J+1])})}return I},getCSSRules:function(M){var K=M.getElementsByTagName("style"),J,H,I={},N;for(J=0,H=K.length;J<H;J++){var L=K[J].textContent||K[J].text;L=L.replace(/\/\*[\s\S]*?\*\//g,"");if(L.trim()===""){continue}N=L.match(/[^{]*\{[\s\S]*?\}/g);N=N.map(function(O){return O.trim()});N.forEach(function(T){var O=T.match(/([\s\S]*?)\s*\{([^}]*)\}/),P={},V=O[2].trim(),S=V.replace(/;$/,"").split(/\s*;\s*/);for(J=0,H=S.length;J<H;J++){var U=S[J].split(/\s*:\s*/),R=U[0],Q=U[1];P[R]=Q}T=O[1];T.split(",").forEach(function(W){W=W.replace(/^svg/i,"").trim();if(W===""){return}if(I[W]){q.util.object.extend(I[W],P)}else{I[W]=q.util.object.clone(P)}})})}return I},loadSVGFromURL:function(J,L,H,I){J=J.replace(/^\n\s*/,"").trim();new q.util.request(J,{method:"get",onComplete:K});function K(N){var M=N.responseXML;if(M&&!M.documentElement&&q.window.ActiveXObject&&N.responseText){M=new ActiveXObject("Microsoft.XMLDOM");M.async="false";M.loadXML(N.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!M||!M.documentElement){L&&L(null);return false}q.parseSVGDocument(M.documentElement,function(P,O,R,Q){L&&L(P,O,R,Q)},H,I)}},loadSVGFromString:function(J,M,H,I){J=J.trim();var K;if(typeof q.window.DOMParser!=="undefined"){var L=new q.window.DOMParser();if(L&&L.parseFromString){K=L.parseFromString(J,"text/xml")}}else{if(q.window.ActiveXObject){K=new ActiveXObject("Microsoft.XMLDOM");K.async="false";K.loadXML(J.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}}q.parseSVGDocument(K.documentElement,function(O,N,Q,P){M(O,N,Q,P)},H,I)}})})(typeof exports!=="undefined"?exports:this);fabric.ElementsParser=function(d,f,b,a,c,e){this.elements=d;this.callback=f;this.options=b;this.reviver=a;this.svgUid=(b&&b.svgUid)||0;this.parsingOptions=c;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g;this.doc=e};(function(a){a.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};a.createObjects=function(){var b=this;this.elements.forEach(function(d,c){d.setAttribute("svgUid",b.svgUid);b.createObject(d,c)})};a.findTag=function(b){return fabric[fabric.util.string.capitalize(b.tagName.replace("svg:",""))]};a.createObject=function(d,c){var b=this.findTag(d);if(b&&b.fromElement){try{b.fromElement(d,this.createCallback(c,d),this.options)}catch(e){fabric.log(e)}}else{this.checkIfDone()}};a.createCallback=function(b,c){var d=this;return function(f){var e;d.resolveGradient(f,c,"fill");d.resolveGradient(f,c,"stroke");if(f instanceof fabric.Image&&f._originalElement){e=f.parsePreserveAspectRatioAttribute(c)}f._removeTransformMatrix(e);d.resolveClipPath(f,c);d.reviver&&d.reviver(c,f);d.instances[b]=f;d.checkIfDone()}};a.extractPropertyDefinition=function(e,d,g){var c=e[d],b=this.regexUrl;if(!b.test(c)){return}b.lastIndex=0;var f=b.exec(c)[1];b.lastIndex=0;return fabric[g][this.svgUid][f]};a.resolveGradient=function(f,b,c){var e=this.extractPropertyDefinition(f,c,"gradientDefs");if(e){var g=b.getAttribute(c+"-opacity");var d=fabric.Gradient.fromElement(e,f,g,this.options);f.set(c,d)}};a.createClipPathCallback=function(c,b){return function(d){d._removeTransformMatrix();d.fillRule=d.clipRule;b.push(d)}};a.resolveClipPath=function(e,k){var j=this.extractPropertyDefinition(e,"clipPath","clipPaths"),f,h,b,c,g,n;if(j){c=[];b=fabric.util.invertTransform(e.calcTransformMatrix());var l=j[0].parentNode;var m=k;while(m.parentNode&&m.getAttribute("clip-path")!==e.clipPath){m=m.parentNode}m.parentNode.appendChild(l);for(var d=0;d<j.length;d++){f=j[d];h=this.findTag(f);h.fromElement(f,this.createClipPathCallback(e,c),this.options)}if(c.length===1){j=c[0]}else{j=new fabric.Group(c)}g=fabric.util.multiplyTransformMatrices(b,j.calcTransformMatrix());if(j.clipPath){this.resolveClipPath(j,m)}var n=fabric.util.qrDecompose(g);j.flipX=false;j.flipY=false;j.set("scaleX",n.scaleX);j.set("scaleY",n.scaleY);j.angle=n.angle;j.skewX=n.skewX;j.skewY=0;j.setPositionByOrigin({x:n.translateX,y:n.translateY},"center","center");e.clipPath=j}};a.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(b){return b!=null});this.callback(this.instances,this.elements)}}})(fabric.ElementsParser.prototype);(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){this.x=d;this.y=e}a.prototype={type:"point",constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){if(typeof d==="undefined"){d=0.5}d=Math.max(Math.min(1,d),0);return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return this.lerp(d)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e;return this},setX:function(d){this.x=d;return this},setY:function(d){this.y=d;return this},setFromPoint:function(d){this.x=d.x;this.y=d.y;return this},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f},clone:function(){return new a(this.x,this.y)}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){this.status=d;this.points=[]}b.Intersection=c;b.Intersection.prototype={constructor:c,appendPoint:function(d){this.points.push(d);return this},appendPoints:function(d){this.points=this.points.concat(d);return this}};b.Intersection.intersectLineLine=function(h,g,l,k){var m,e=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(g.x-h.x)*(h.y-l.y)-(g.y-h.y)*(h.x-l.x),i=(k.y-l.y)*(g.x-h.x)-(k.x-l.x)*(g.y-h.y);if(i!==0){var f=e/i,d=j/i;if(0<=f&&f<=1&&0<=d&&d<=1){m=new c("Intersection");m.appendPoint(new b.Point(h.x+f*(g.x-h.x),h.y+f*(g.y-h.y)))}else{m=new c()}}else{if(e===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c(),f=l.length,k,j,g,h;for(h=0;h<f;h++){k=l[h];j=l[(h+1)%f];g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c(),l=j.length,k;for(k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c();o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Color){c.warn("fabric.Color is already defined.");return}function d(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}c.Color=d;c.Color.prototype={_tryParsingColor:function(e){var f;if(e in d.colorNameMap){e=d.colorNameMap[e]}if(e==="transparent"){f=[255,255,255,0]}if(!f){f=d.sourceFromHex(e)}if(!f){f=d.sourceFromRgb(e)}if(!f){f=d.sourceFromHsl(e)}if(!f){f=[0,0,0,1]}if(f){this.setSource(f)}},_rgbToHsl:function(e,k,n){e/=255;k/=255;n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);f=(o+i)/2;if(o===i){j=p=0}else{var m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break}j/=6}return[Math.round(j*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var i=this.getSource(),h,f,e;h=i[0].toString(16);h=(h.length===1)?("0"+h):h;f=i[1].toString(16);f=(f.length===1)?("0"+f):f;e=i[2].toString(16);e=(e.length===1)?("0"+e):e;return h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},toHexa:function(){var f=this.getSource(),e;e=Math.round(f[3]*255);e=e.toString(16);e=(e.length===1)?("0"+e):e;return this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();e[3]=f;this.setSource(e);return this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),e=g[3];this.setSource([f,f,f,e]);return this},toBlackWhite:function(e){var h=this.getSource(),g=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0),f=h[3];e=e||127;g=(Number(g)<Number(e))?0:255;this.setSource([g,g,g,f]);return this},overlayWith:function(l){if(!(l instanceof d)){l=new d(l)}var e=[],k=this.getAlpha(),h=0.5,j=this.getSource(),f=l.getSource(),g;for(g=0;g<3;g++){e.push(Math.round((j[g]*(1-h))+(f[g]*h)))}e[3]=k;this.setSource(e);return this}};c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i;c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i;c.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;c.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function a(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g}c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))};c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}};c.Color.fromRgba=d.fromRgb;c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))};c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(!n){return}var m=(((parseFloat(n[1])%360)+360)%360)/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1),e,o,t;if(u===0){e=o=t=j}else{var f=j<=0.5?j*(u+1):j+u-j*u,i=j*2-f;e=a(i,f,m+1/3);o=a(i,f,m);t=a(i,f,m-1/3)}return[Math.round(e*255),Math.round(o*255),Math.round(t*255),n[4]?parseFloat(n[4]):1]};c.Color.fromHsla=d.fromHsl;c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))};c.Color.sourceFromHex=function(i){if(i.match(d.reHex)){var m=i.slice(i.indexOf("#")+1),f=(m.length===3||m.length===4),j=(m.length===8||m.length===4),l=f?(m.charAt(0)+m.charAt(0)):m.substring(0,2),k=f?(m.charAt(1)+m.charAt(1)):m.substring(2,4),e=f?(m.charAt(2)+m.charAt(2)):m.substring(4,6),h=j?(f?(m.charAt(3)+m.charAt(3)):m.substring(6,8)):"FF";return[parseInt(l,16),parseInt(k,16),parseInt(e,16),parseFloat((parseInt(h,16)/255).toFixed(2))]}};c.Color.fromSource=function(e){var f=new d();f.setSource(e);return f}})(typeof exports!=="undefined"?exports:this);(function(){function d(g,r){var f=g.getAttribute("style"),j=g.getAttribute("offset")||0,h,n,m,k;j=parseFloat(j)/(/%$/.test(j)?100:1);j=j<0?0:j>1?1:j;if(f){var l=f.split(/\s*;\s*/);if(l[l.length-1]===""){l.pop()}for(k=l.length;k--;){var o=l[k].split(/\s*:\s*/),q=o[0].trim(),p=o[1].trim();if(q==="stop-color"){h=p}else{if(q==="stop-opacity"){m=p}}}}if(!h){h=g.getAttribute("stop-color")||"rgb(0,0,0)"}if(!m){m=g.getAttribute("stop-opacity")}h=new fabric.Color(h);n=h.getAlpha();m=isNaN(parseFloat(m))?1:parseFloat(m);m*=n*r;return{offset:j,color:h.toRgb(),opacity:m}}function b(f){return{x1:f.getAttribute("x1")||0,y1:f.getAttribute("y1")||0,x2:f.getAttribute("x2")||"100%",y2:f.getAttribute("y2")||0}}function c(f){return{x1:f.getAttribute("fx")||f.getAttribute("cx")||"50%",y1:f.getAttribute("fy")||f.getAttribute("cy")||"50%",r1:0,x2:f.getAttribute("cx")||"50%",y2:f.getAttribute("cy")||"50%",r2:f.getAttribute("r")||"50%"}}var e=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(f){f||(f={});f.coords||(f.coords={});var g,h=this;Object.keys(f).forEach(function(i){h[i]=f[i]});if(this.id){this.id+="_"+fabric.Object.__uid++}else{this.id=fabric.Object.__uid++}g={x1:f.coords.x1||0,y1:f.coords.y1||0,x2:f.coords.x2||0,y2:f.coords.y2||0};if(this.type==="radial"){g.r1=f.coords.r1||0;g.r2=f.coords.r2||0}this.coords=g;this.colorStops=f.colorStops.slice()},addColorStop:function(h){for(var f in h){var g=new fabric.Color(h[f]);this.colorStops.push({offset:parseFloat(f),color:g.toRgb(),opacity:g.getAlpha()})}return this},toObject:function(g){var f={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,f,g);return f},toSVG:function(x,f){var q=e(this.coords,true),r,s,f=f||{},t,g,h=e(this.colorStops,true),u=q.r1>q.r2,p=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),w=-this.offsetX,v=-this.offsetY,l=!!f.additionalTransform,o=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";h.sort(function(y,i){return y.offset-i.offset});if(o==="objectBoundingBox"){w/=x.width;v/=x.height}else{w+=x.width/2;v+=x.height/2}if(x.type==="path"){w-=x.pathOffset.x;v-=x.pathOffset.y}p[4]-=w;p[5]-=v;g='id="SVGID_'+this.id+'" gradientUnits="'+o+'"';g+=' gradientTransform="'+(l?f.additionalTransform+" ":"")+fabric.util.matrixToSVG(p)+'" ';if(this.type==="linear"){t=["<linearGradient ",g,' x1="',q.x1,'" y1="',q.y1,'" x2="',q.x2,'" y2="',q.y2,'">\n']}else{if(this.type==="radial"){t=["<radialGradient ",g,' cx="',u?q.x1:q.x2,'" cy="',u?q.y1:q.y2,'" r="',u?q.r1:q.r2,'" fx="',u?q.x2:q.x1,'" fy="',u?q.y2:q.y1,'">\n']}}if(this.type==="radial"){if(u){h=h.concat();h.reverse();for(r=0,s=h.length;r<s;r++){h[r].offset=1-h[r].offset}}var k=Math.min(q.r1,q.r2);if(k>0){var j=Math.max(q.r1,q.r2),m=k/j;for(r=0,s=h.length;r<s;r++){h[r].offset+=m*(1-h[r].offset)}}}for(r=0,s=h.length;r<s;r++){var n=h[r];t.push("<stop ",'offset="',(n.offset*100)+"%",'" style="stop-color:',n.color,(typeof n.opacity!=="undefined"?";stop-opacity: "+n.opacity:";"),'"/>\n')}t.push((this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n"));return t.join("")},toLive:function(t,j){var p,q=fabric.util.object.clone(this.coords),l,n,g=q.x1,r=q.y1,f=q.x2,o=q.y2,s=this.colorStops;if(!this.type){return}if(j instanceof fabric.Text&&this.gradientUnits==="percentage"){g*=j.width;r*=j.height;f*=j.width;o*=j.height}if(this.type==="linear"){p=t.createLinearGradient(g,r,f,o)}else{if(this.type==="radial"){p=t.createRadialGradient(g,r,q.r1,f,o,q.r2)}}for(l=0,n=s.length;l<n;l++){var h=s[l].color,m=s[l].opacity,k=s[l].offset;if(typeof m!=="undefined"){h=new fabric.Color(h).setAlpha(m).toRgba()}p.addColorStop(k,h)}return p}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(j,u,g,l){var v=parseFloat(g)/(/%$/.test(g)?100:1);v=v<0?0:v>1?1:v;if(isNaN(v)){v=1}var t=j.getElementsByTagName("stop"),q,k=j.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",f=j.getAttribute("gradientTransform")||"",h=[],s,o,p=0,n=0,m;if(j.nodeName==="linearGradient"||j.nodeName==="LINEARGRADIENT"){q="linear";s=b(j)}else{q="radial";s=c(j)}for(o=t.length;o--;){h.push(d(t[o],v))}m=fabric.parseTransformAttribute(f);a(u,s,l,k);if(k==="pixels"){p=-u.left;n=-u.top}var r=new fabric.Gradient({id:j.getAttribute("id"),type:q,coords:s,colorStops:h,gradientUnits:k,gradientTransform:m,offsetX:p,offsetY:n,});return r},forObject:function(g,f){f||(f={});a(g,f.coords,f.gradientUnits,{viewBoxWidth:100,viewBoxHeight:100,});return new fabric.Gradient(f)}});function a(f,h,i,g){var k,j;Object.keys(h).forEach(function(l){k=h[l];if(k==="Infinity"){j=1}else{if(k==="-Infinity"){j=0}else{j=parseFloat(h[l],10);if(typeof k==="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(k)){j*=0.01;if(g==="pixels"){if(l==="x1"||l==="x2"||l==="r2"){j*=i.viewBoxWidth||i.width}if(l==="y1"||l==="y2"){j*=i.viewBoxHeight||i.height}}}}}h[l]=j})}})();(function(){var a=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(b,d){b||(b={});this.id=fabric.Object.__uid++;this.setOptions(b);if(!b.source||(b.source&&typeof b.source!=="string")){d&&d(this);return}if(typeof fabric.util.getFunctionBody(b.source)!=="undefined"){this.source=new Function(fabric.util.getFunctionBody(b.source));d&&d(this)}else{var c=this;this.source=fabric.util.createImage();fabric.util.loadImage(b.source,function(e){c.source=e;d&&d(c)},null,this.crossOrigin)}},toObject:function(e){var c=fabric.Object.NUM_FRACTION_DIGITS,d,b;if(typeof this.source==="function"){d=String(this.source)}else{if(typeof this.source.src==="string"){d=this.source.src}else{if(typeof this.source==="object"&&this.source.toDataURL){d=this.source.toDataURL()}}}b={type:"pattern",source:d,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:a(this.offsetX,c),offsetY:a(this.offsetY,c),patternTransform:this.patternTransform?this.patternTransform.concat():null};fabric.util.populateWithProperties(this,b,e);return b},toSVG:function(c){var b=typeof this.source==="function"?this.source():this.source,g=b.width/c.width,e=b.height/c.height,f=this.offsetX/c.width,d=this.offsetY/c.height,h="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat"){e=1;if(d){e+=Math.abs(d)}}if(this.repeat==="repeat-y"||this.repeat==="no-repeat"){g=1;if(f){g+=Math.abs(f)}}if(b.src){h=b.src}else{if(b.toDataURL){h=b.toDataURL()}}return'<pattern id="SVGID_'+this.id+'" x="'+f+'" y="'+d+'" width="'+g+'" height="'+e+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+h+'"></image>\n</pattern>\n'},setOptions:function(b){for(var c in b){this[c]=b[c]}},toLive:function(b){var c=typeof this.source==="function"?this.source():this.source;if(!c){return""}if(typeof c.src!=="undefined"){if(!c.complete){return""}if(c.naturalWidth===0||c.naturalHeight===0){return""}}return b.createPattern(c,this.repeat)}})})();(function(b){var c=b.fabric||(b.fabric={}),a=c.util.toFixed;if(c.Shadow){c.warn("fabric.Shadow is already defined.");return}c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,nonScaling:false,initialize:function(d){if(typeof d==="string"){d=this._parseShadow(d)}for(var e in d){this[e]=d[e]}this.id=c.Object.__uid++},_parseShadow:function(g){var f=g.trim(),e=c.Shadow.reOffsetsAndBlur.exec(f)||[],d=f.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:d.trim(),offsetX:parseInt(e[1],10)||0,offsetY:parseInt(e[2],10)||0,blur:parseInt(e[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var d=40,j=40,g=c.Object.NUM_FRACTION_DIGITS,i=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-f.angle)),h=20,e=new c.Color(this.color);if(f.width&&f.height){d=a((Math.abs(i.x)+this.blur)/f.width,g)*100+h;j=a((Math.abs(i.y)+this.blur)/f.height,g)*100+h}if(f.flipX){i.x*=-1}if(f.flipY){i.y*=-1}return('<filter id="SVGID_'+this.id+'" y="-'+j+'%" height="'+(100+2*j)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+a(this.blur?this.blur/2:0,g)+'"></feGaussianBlur>\n\t<feOffset dx="'+a(i.x,g)+'" dy="'+a(i.y,g)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+e.toRgb()+'" flood-opacity="'+e.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling}}var e={},d=c.Shadow.prototype;["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(f){if(this[f]!==d[f]){e[f]=this[f]}},this);return e}});c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,c=fabric.util.getElementOffset,f=fabric.util.removeFromArray,a=fabric.util.toFixed,d=fabric.util.transformPoint,g=fabric.util.invertTransform,i=fabric.util.getNodeCanvas,h=fabric.util.createCanvasElement,b=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(k,j){j||(j={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(k,j)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:true,stateful:false,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:true,overlayVpt:true,onBeforeScaleRotate:function(){},enableRetinaScaling:true,vptCoords:{},skipOffscreen:true,clipPath:undefined,_initStatic:function(l,k){var j=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(l);this._initOptions(k);this._setImageSmoothing();if(!this.interactive){this._initRetinaScaling()}if(k.overlayImage){this.setOverlayImage(k.overlayImage,j)}if(k.backgroundImage){this.setBackgroundImage(k.backgroundImage,j)}if(k.backgroundColor){this.setBackgroundColor(k.backgroundColor,j)}if(k.overlayColor){this.setOverlayColor(k.overlayColor,j)}this.calcOffset()},_isRetinaScaling:function(){return(fabric.devicePixelRatio!==1&&this.enableRetinaScaling)},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){if(!this._isRetinaScaling()){return}var j=fabric.devicePixelRatio;this.__initRetinaScaling(j,this.lowerCanvasEl,this.contextContainer);if(this.upperCanvasEl){this.__initRetinaScaling(j,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(l,j,k){j.setAttribute("width",this.width*l);j.setAttribute("height",this.height*l);k.scale(l,l)},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(k,l,j){return this.__setBgOverlayImage("overlayImage",k,l,j)},setBackgroundImage:function(k,l,j){return this.__setBgOverlayImage("backgroundImage",k,l,j)},setOverlayColor:function(k,j){return this.__setBgOverlayColor("overlayColor",k,j)},setBackgroundColor:function(j,k){return this.__setBgOverlayColor("backgroundColor",j,k)},_setImageSmoothing:function(){var j=this.getContext();j.imageSmoothingEnabled=j.imageSmoothingEnabled||j.webkitImageSmoothingEnabled||j.mozImageSmoothingEnabled||j.msImageSmoothingEnabled||j.oImageSmoothingEnabled;j.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(k,l,m,j){if(typeof l==="string"){fabric.util.loadImage(l,function(o){if(o){var n=new fabric.Image(o,j);this[k]=n;n.canvas=this}m&&m(o)},this,j&&j.crossOrigin)}else{j&&l.setOptions(j);this[k]=l;l&&(l.canvas=this);m&&m(l)}return this},__setBgOverlayColor:function(k,j,l){this[k]=j;this._initGradient(j,k);this._initPattern(j,k,l);return this},_createCanvasElement:function(){var j=h();if(!j){throw b}if(!j.style){j.style={}}if(typeof j.getContext==="undefined"){throw b}return j},_initOptions:function(j){var k=this.lowerCanvasEl;this._setOptions(j);this.width=this.width||parseInt(k.width,10)||0;this.height=this.height||parseInt(k.height,10)||0;if(!this.lowerCanvasEl.style){return}k.width=this.width;k.height=this.height;k.style.width=this.width+"px";k.style.height=this.height+"px";this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(j){if(j&&j.getContext){this.lowerCanvasEl=j}else{this.lowerCanvasEl=fabric.util.getById(j)||this._createCanvasElement()}fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(k,j){return this.setDimensions({width:k},j)},setHeight:function(k,j){return this.setDimensions({height:k},j)},setDimensions:function(l,k){var j;k=k||{};for(var m in l){j=l[m];if(!k.cssOnly){this._setBackstoreDimension(m,l[m]);j+="px";this.hasLostContext=true}if(!k.backstoreOnly){this._setCssDimension(m,j)}}if(this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles()}this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();if(!k.cssOnly){this.requestRenderAll()}return this},_setBackstoreDimension:function(k,j){this.lowerCanvasEl[k]=j;if(this.upperCanvasEl){this.upperCanvasEl[k]=j}if(this.cacheCanvasEl){this.cacheCanvasEl[k]=j}this[k]=j;return this},_setCssDimension:function(k,j){this.lowerCanvasEl.style[k]=j;if(this.upperCanvasEl){this.upperCanvasEl.style[k]=j}if(this.wrapperEl){this.wrapperEl.style[k]=j}return this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(p){var n=this._activeObject,k,o=false,m=true,l,j;this.viewportTransform=p;for(l=0,j=this._objects.length;l<j;l++){k=this._objects[l];k.group||k.setCoords(o,m)}if(n&&n.type==="activeSelection"){n.setCoords(o,m)}this.calcViewportBoundaries();this.renderOnAddRemove&&this.requestRenderAll();return this},zoomToPoint:function(j,l){var k=j,n=this.viewportTransform.slice(0);j=d(j,g(this.viewportTransform));n[0]=l;n[3]=l;var m=d(j,n);n[4]+=k.x-m.x;n[5]+=k.y-m.y;return this.setViewportTransform(n)},setZoom:function(j){this.zoomToPoint(new fabric.Point(0,0),j);return this},absolutePan:function(j){var k=this.viewportTransform.slice(0);k[4]=-j.x;k[5]=-j.y;return this.setViewportTransform(k)},relativePan:function(j){return this.absolutePan(new fabric.Point(-j.x-this.viewportTransform[4],-j.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(j){this.stateful&&j.setupState();j._set("canvas",this);j.setCoords();this.fire("object:added",{target:j});j.fire("added")},_onObjectRemoved:function(j){this.fire("object:removed",{target:j});j.fire("removed");delete j.canvas},clearContext:function(j){j.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.backgroundImage=null;this.overlayImage=null;this.backgroundColor="";this.overlayColor="";if(this._hasITextHandlers){this.off("mouse:up",this._mouseUpITextHandler);this._iTextInstances=null;this._hasITextHandlers=false}this.clearContext(this.contextContainer);this.fire("canvas:cleared");this.renderOnAddRemove&&this.requestRenderAll();return this},renderAll:function(){var j=this.contextContainer;this.renderCanvas(j,this._objects);return this},renderAndReset:function(){this.isRendering=0;this.renderAll()},requestRenderAll:function(){if(!this.isRendering){this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)}return this},calcViewportBoundaries:function(){var l={},k=this.width,j=this.height,m=g(this.viewportTransform);l.tl=d({x:0,y:0},m);l.br=d({x:k,y:j},m);l.tr=new fabric.Point(l.br.x,l.tl.y);l.bl=new fabric.Point(l.tl.x,l.br.y);this.vptCoords=l;return l},cancelRequestedRender:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0}},renderCanvas:function(j,l){var k=this.viewportTransform,m=this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(j);this.fire("before:render",{ctx:j,});if(this.clipTo){fabric.util.clipContext(this,j)}this._renderBackground(j);j.save();j.transform(k[0],k[1],k[2],k[3],k[4],k[5]);this._renderObjects(j,l);j.restore();if(!this.controlsAboveOverlay&&this.interactive){this.drawControls(j)}if(this.clipTo){j.restore()}if(m){m.canvas=this;m.shouldCache();m._transformDone=true;m.renderCache({forClipping:true});this.drawClipPathOnCanvas(j)}this._renderOverlay(j);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(j)}this.fire("after:render",{ctx:j,})},drawClipPathOnCanvas:function(j){var k=this.viewportTransform,l=this.clipPath;j.save();j.transform(k[0],k[1],k[2],k[3],k[4],k[5]);j.globalCompositeOperation="destination-in";l.transform(j);j.scale(1/l.zoomX,1/l.zoomY);j.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY);j.restore()},_renderObjects:function(k,m){var l,j;for(l=0,j=m.length;l<j;++l){m[l]&&m[l].render(k)}},_renderBackgroundOrOverlay:function(k,o){var p=this[o+"Color"],n=this[o+"Image"],l=this.viewportTransform,q=this[o+"Vpt"];if(!p&&!n){return}if(p){k.save();k.beginPath();k.moveTo(0,0);k.lineTo(this.width,0);k.lineTo(this.width,this.height);k.lineTo(0,this.height);k.closePath();k.fillStyle=p.toLive?p.toLive(k,this):p;if(q){k.transform(l[0],l[1],l[2],l[3],l[4],l[5])}k.transform(1,0,0,1,p.offsetX||0,p.offsetY||0);var j=p.gradientTransform||p.patternTransform;j&&k.transform(j[0],j[1],j[2],j[3],j[4],j[5]);k.fill();k.restore()}if(n){k.save();if(q){k.transform(l[0],l[1],l[2],l[3],l[4],l[5])}n.render(k);k.restore()}},_renderBackground:function(j){this._renderBackgroundOrOverlay(j,"background")},_renderOverlay:function(j){this._renderBackgroundOrOverlay(j,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(j){return this._centerObject(j,new fabric.Point(this.getCenter().left,j.getCenterPoint().y))},centerObjectV:function(j){return this._centerObject(j,new fabric.Point(j.getCenterPoint().x,this.getCenter().top))},centerObject:function(k){var j=this.getCenter();return this._centerObject(k,new fabric.Point(j.left,j.top))},viewportCenterObject:function(j){var k=this.getVpCenter();return this._centerObject(j,k)},viewportCenterObjectH:function(j){var k=this.getVpCenter();this._centerObject(j,new fabric.Point(k.x,j.getCenterPoint().y));return this},viewportCenterObjectV:function(j){var k=this.getVpCenter();return this._centerObject(j,new fabric.Point(j.getCenterPoint().x,k.y))},getVpCenter:function(){var j=this.getCenter(),k=g(this.viewportTransform);return d({x:j.left,y:j.top},k)},_centerObject:function(k,j){k.setPositionByOrigin(j,"center","center");k.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this},toDatalessJSON:function(j){return this.toDatalessObject(j)},toObject:function(j){return this._toObjectMethod("toObject",j)},toDatalessObject:function(j){return this._toObjectMethod("toDatalessObject",j)},_toObjectMethod:function(j,m){var k=this.clipPath,l={version:fabric.version,objects:this._toObjects(j,m),};if(k){l.clipPath=this._toObject(this.clipPath,j,m)}e(l,this.__serializeBgOverlay(j,m));fabric.util.populateWithProperties(this,l,m);return l},_toObjects:function(j,k){return this._objects.filter(function(l){return !l.excludeFromExport}).map(function(l){return this._toObject(l,j,k)},this)},_toObject:function(j,l,n){var k;if(!this.includeDefaultValues){k=j.includeDefaultValues;j.includeDefaultValues=false}var m=j[l](n);if(!this.includeDefaultValues){j.includeDefaultValues=k}return m},__serializeBgOverlay:function(k,n){var m={},j=this.backgroundImage,l=this.overlayImage;if(this.backgroundColor){m.background=this.backgroundColor.toObject?this.backgroundColor.toObject(n):this.backgroundColor}if(this.overlayColor){m.overlay=this.overlayColor.toObject?this.overlayColor.toObject(n):this.overlayColor}if(j&&!j.excludeFromExport){m.backgroundImage=this._toObject(j,k,n)}if(l&&!l.excludeFromExport){m.overlayImage=this._toObject(l,k,n)}return m},svgViewportTransformation:true,toSVG:function(l,j){l||(l={});l.reviver=j;var k=[];this._setSVGPreamble(k,l);this._setSVGHeader(k,l);if(this.clipPath){k.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n')}this._setSVGBgOverlayColor(k,"background");this._setSVGBgOverlayImage(k,"backgroundImage",j);this._setSVGObjects(k,j);if(this.clipPath){k.push("</g>\n")}this._setSVGBgOverlayColor(k,"overlay");this._setSVGBgOverlayImage(k,"overlayImage",j);k.push("</svg>");return k.join("")},_setSVGPreamble:function(j,k){if(k.suppressPreamble){return}j.push('<?xml version="1.0" encoding="',(k.encoding||"UTF-8"),'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(k,l){var n=l.width||this.width,j=l.height||this.height,p,o='viewBox="0 0 '+this.width+" "+this.height+'" ',m=fabric.Object.NUM_FRACTION_DIGITS;if(l.viewBox){o='viewBox="'+l.viewBox.x+" "+l.viewBox.y+" "+l.viewBox.width+" "+l.viewBox.height+'" '}else{if(this.svgViewportTransformation){p=this.viewportTransform;o='viewBox="'+a(-p[4]/p[0],m)+" "+a(-p[5]/p[3],m)+" "+a(this.width/p[0],m)+" "+a(this.height/p[3],m)+'" '}}k.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',j,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(l),"</defs>\n")},createSVGClipPathMarkup:function(j){var k=this.clipPath;if(k){k.clipPathId="CLIPPATH_"+fabric.Object.__uid++;return'<clipPath id="'+k.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(j.reviver)+"</clipPath>\n"}return""},createSVGRefElementsMarkup:function(){var k=this,j=["background","overlay"].map(function(p){var n=k[p+"Color"];if(n&&n.toLive){var l=k[p+"Vpt"],o=k.viewportTransform,m={width:k.width/(l?o[0]:1),height:k.height/(l?o[3]:1)};return n.toSVG(m,{additionalTransform:l?fabric.util.matrixToSVG(o):""})}});return j.join("")},createSVGFontFacesMarkup:function(){var w="",r={},p,s,l,x,t,u,k,o,q,m=fabric.fontPaths,v=this._objects;for(o=0,q=v.length;o<q;o++){p=v[o];s=p.fontFamily;if(p.type.indexOf("text")===-1||r[s]||!m[s]){continue}r[s]=true;if(!p.styles){continue}l=p.styles;for(t in l){x=l[t];for(k in x){u=x[k];s=u.fontFamily;if(!r[s]&&m[s]){r[s]=true}}}}for(var n in r){w+=["\t\t@font-face {\n","\t\t\tfont-family: '",n,"';\n","\t\t\tsrc: url('",m[n],"');\n","\t\t}\n"].join("")}if(w){w=['\t<style type="text/css">',"<![CDATA[\n",w,"]]>","</style>\n"].join("")}return w},_setSVGObjects:function(m,l){var k,n,j,o=this._objects;for(n=0,j=o.length;n<j;n++){k=o[n];if(k.excludeFromExport){continue}this._setSVGObject(m,k,l)}},_setSVGObject:function(l,k,j){l.push(k.toSVG(j))},_setSVGBgOverlayImage:function(k,l,j){if(this[l]&&!this[l].excludeFromExport&&this[l].toSVG){k.push(this[l].toSVG(j))}},_setSVGBgOverlayColor:function(r,q){var n=this[q+"Color"],o=this.viewportTransform,m=this.width,k=this.height;if(!n){return}if(n.toLive){var j=n.repeat,l=fabric.util.invertTransform(o),s=this[q+"Vpt"],p=s?fabric.util.matrixToSVG(l):"";r.push('<rect transform="'+p+" translate(",m/2,",",k/2,')"',' x="',n.offsetX-m/2,'" y="',n.offsetY-k/2,'" ','width="',(j==="repeat-y"||j==="no-repeat"?n.source.width:m),'" height="',(j==="repeat-x"||j==="no-repeat"?n.source.height:k),'" fill="url(#SVGID_'+n.id+')"',"></rect>\n")}else{r.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',"></rect>\n")}},sendToBack:function(j){if(!j){return this}var n=this._activeObject,k,l,m;if(j===n&&j.type==="activeSelection"){m=n._objects;for(k=m.length;k--;){l=m[k];f(this._objects,l);this._objects.unshift(l)}}else{f(this._objects,j);this._objects.unshift(j)}this.renderOnAddRemove&&this.requestRenderAll();return this},bringToFront:function(j){if(!j){return this}var n=this._activeObject,k,l,m;if(j===n&&j.type==="activeSelection"){m=n._objects;for(k=0;k<m.length;k++){l=m[k];f(this._objects,l);this._objects.push(l)}}else{f(this._objects,j);this._objects.push(j)}this.renderOnAddRemove&&this.requestRenderAll();return this},sendBackwards:function(j,o){if(!j){return this}var r=this._activeObject,l,k,q,p,m,n=0;if(j===r&&j.type==="activeSelection"){m=r._objects;for(l=0;l<m.length;l++){k=m[l];q=this._objects.indexOf(k);if(q>0+n){p=q-1;f(this._objects,k);this._objects.splice(p,0,k)}n++}}else{q=this._objects.indexOf(j);if(q!==0){p=this._findNewLowerIndex(j,q,o);f(this._objects,j);this._objects.splice(p,0,j)}}this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewLowerIndex:function(l,j,n){var o,m;if(n){o=j;for(m=j-1;m>=0;--m){var k=l.intersectsWithObject(this._objects[m])||l.isContainedWithinObject(this._objects[m])||this._objects[m].isContainedWithinObject(l);if(k){o=m;break}}}else{o=j-1}return o},bringForward:function(j,o){if(!j){return this}var r=this._activeObject,l,k,q,p,m,n=0;if(j===r&&j.type==="activeSelection"){m=r._objects;for(l=m.length;l--;){k=m[l];q=this._objects.indexOf(k);if(q<this._objects.length-1-n){p=q+1;f(this._objects,k);this._objects.splice(p,0,k)}n++}}else{q=this._objects.indexOf(j);if(q!==this._objects.length-1){p=this._findNewUpperIndex(j,q,o);f(this._objects,j);this._objects.splice(p,0,j)}}this.renderOnAddRemove&&this.requestRenderAll();return this},_findNewUpperIndex:function(m,k,o){var p,n,j;if(o){p=k;for(n=k+1,j=this._objects.length;n<j;++n){var l=m.intersectsWithObject(this._objects[n])||m.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(m);if(l){p=n;break}}}else{p=k+1}return p},moveTo:function(k,j){f(this._objects,k);this._objects.splice(j,0,k);return this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0}this.forEachObject(function(j){j.dispose&&j.dispose()});this._objects=[];if(this.backgroundImage&&this.backgroundImage.dispose){this.backgroundImage.dispose()}this.backgroundImage=null;if(this.overlayImage&&this.overlayImage.dispose){this.overlayImage.dispose()}this.overlayImage=null;this._iTextInstances=null;this.contextContainer=null;fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);this.lowerCanvasEl=undefined;return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}});e(fabric.StaticCanvas.prototype,fabric.Observable);e(fabric.StaticCanvas.prototype,fabric.Collection);e(fabric.StaticCanvas.prototype,fabric.DataURLExporter);e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(k){var l=h();if(!l||!l.getContext){return null}var j=l.getContext("2d");if(!j){return null}switch(k){case"setLineDash":return typeof j.setLineDash!=="undefined";default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;if(fabric.isLikelyNode){fabric.StaticCanvas.prototype.createPNGStream=function(){var j=i(this.lowerCanvasEl);return j&&j.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(k){var j=i(this.lowerCanvasEl);return j&&j.createJPEGStream(k)}}})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(a){this.shadow=new fabric.Shadow(a);return this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color;a.lineWidth=this.width;a.lineCap=this.strokeLineCap;a.miterLimit=this.strokeMiterLimit;a.lineJoin=this.strokeLineJoin;if(fabric.StaticCanvas.supports("setLineDash")){a.setLineDash(this.strokeDashArray||[])}},_saveAndTransform:function(a){var b=this.canvas.viewportTransform;a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5])},_setShadow:function(){if(!this.shadow){return}var b=this.canvas,d=this.shadow,a=b.contextTop,c=b.getZoom();if(b&&b._isRetinaScaling()){c*=fabric.devicePixelRatio}a.shadowColor=d.color;a.shadowBlur=d.blur*c;a.shadowOffsetX=d.offsetX*c;a.shadowOffsetY=d.offsetY*c},needsFullRender:function(){var a=new fabric.Color(this.color);return a.getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:0.4,initialize:function(a){this.canvas=a;this._points=[]},_drawSegment:function(a,c,b){var d=c.midPointFrom(b);a.quadraticCurveTo(c.x,c.y,d.x,d.y);return d},onMouseDown:function(b,a){if(!this.canvas._isMainEvent(a.e)){return}this._prepareForDrawing(b);this._captureDrawingPath(b);this._render()},onMouseMove:function(e,b){if(!this.canvas._isMainEvent(b.e)){return}if(this._captureDrawingPath(e)&&this._points.length>1){if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this._render()}else{var c=this._points,d=c.length,a=this.canvas.contextTop;this._saveAndTransform(a);if(this.oldEnd){a.beginPath();a.moveTo(this.oldEnd.x,this.oldEnd.y)}this.oldEnd=this._drawSegment(a,c[d-2],c[d-1],true);a.stroke();a.restore()}}},onMouseUp:function(a){if(!this.canvas._isMainEvent(a.e)){return true}this.oldEnd=undefined;this._finalizeAndAddPath();return false},_prepareForDrawing:function(b){var a=new fabric.Point(b.x,b.y);this._reset();this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){if(this._points.length>1&&a.eq(this._points[this._points.length-1])){return false}this._points.push(a);return true},_reset:function(){this._points=[];this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);return this._addPoint(b)},_render:function(){var b=this.canvas.contextTop,c,a,f=this._points[0],e=this._points[1];this._saveAndTransform(b);b.beginPath();if(this._points.length===2&&f.x===e.x&&f.y===e.y){var d=this.width/1000;f=new fabric.Point(f.x,f.y);e=new fabric.Point(e.x,e.y);f.x-=d;e.x+=d}b.moveTo(f.x,f.y);for(c=1,a=this._points.length;c<a;c++){this._drawSegment(b,f,e);f=this._points[c];e=this._points[c+1]}b.lineTo(f.x,f.y);b.stroke();b.restore()},convertPointsToSVGPath:function(h){var l=[],c,b=this.width/1000,j=new fabric.Point(h[0].x,h[0].y),g=new fabric.Point(h[1].x,h[1].y),d=h.length,a=1,k=0,e=d>2;if(e){a=h[2].x<g.x?-1:h[2].x===g.x?0:1;k=h[2].y<g.y?-1:h[2].y===g.y?0:1}l.push("M ",j.x-a*b," ",j.y-k*b," ");for(c=1;c<d;c++){if(!j.eq(g)){var f=j.midPointFrom(g);l.push("Q ",j.x," ",j.y," ",f.x," ",f.y," ")}j=h[c];if((c+1)<h.length){g=h[c+1]}}if(e){a=j.x>h[c-2].x?1:j.x===h[c-2].x?0:-1;k=j.y>h[c-2].y?1:j.y===h[c-2].y?0:-1}l.push("L ",j.x+a*b," ",j.y+k*b);return l},createPath:function(b){var a=new fabric.Path(b,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,});if(this.shadow){this.shadow.affectStroke=true;a.setShadow(this.shadow)}return a},decimatePoints:function(g,a){if(g.length<=2){return g}var h=this.canvas.getZoom(),c=Math.pow(a/h,2),d,b=g.length-1,f=g[0],j=[f],e;for(d=1;d<b;d++){e=Math.pow(f.x-g[d].x,2)+Math.pow(f.y-g[d].y,2);if(e>=c){f=g[d];j.push(f)}}if(j.length===1){j.push(new fabric.Point(j[0].x,j[0].y))}return j},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();if(this.decimate){this._points=this.decimatePoints(this._points,this.decimate)}var c=this.convertPointsToSVGPath(this._points).join("");if(c==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var b=this.createPath(c);this.canvas.clearContext(this.canvas.contextTop);this.canvas.add(b);this.canvas.requestRenderAll();b.setCoords();this._resetShadow();this.canvas.fire("path:created",{path:b})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a;this.points=[]},drawDot:function(c){var a=this.addPoint(c),b=this.canvas.contextTop;this._saveAndTransform(b);this.dot(b,a);b.restore()},dot:function(b,a){b.fillStyle=a.fill;b.beginPath();b.arc(a.x,a.y,a.radius,0,Math.PI*2,false);b.closePath();b.fill()},onMouseDown:function(a){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(a)},_render:function(){var b=this.canvas.contextTop,c,a,d=this.points;this._saveAndTransform(b);for(c=0,a=d.length;c<a;c++){this.dot(b,d[c])}b.restore()},onMouseMove:function(a){if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this.addPoint(a);this._render()}else{this.drawDot(a)}},onMouseUp:function(){var g=this.canvas.renderOnAddRemove,c,b;this.canvas.renderOnAddRemove=false;var f=[];for(c=0,b=this.points.length;c<b;c++){var a=this.points[c],e=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&e.setShadow(this.shadow);f.push(e)}var d=new fabric.Group(f);d.canvas=this.canvas;this.canvas.add(d);this.canvas.fire("path:created",{path:d});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=g;this.canvas.requestRenderAll()},addPoint:function(c){var d=new fabric.Point(c.x,c.y),a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=b;this.points.push(d);return d}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(a){this.canvas=a;this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(a);this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.addSprayChunk(a);this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var h=[];for(var c=0,a=this.sprayChunks.length;c<a;c++){var d=this.sprayChunks[c];for(var b=0,k=d.length;b<k;b++){var f=new fabric.Rect({width:d[b].width,height:d[b].width,left:d[b].x+1,top:d[b].y+1,originX:"center",originY:"center",fill:this.color});h.push(f)}}if(this.optimizeOverlapping){h=this._getOptimizedRects(h)}var g=new fabric.Group(h);this.shadow&&g.setShadow(this.shadow);this.canvas.add(g);this.canvas.fire("path:created",{path:g});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.requestRenderAll()},_getOptimizedRects:function(c){var b={},e,d,a;for(d=0,a=c.length;d<a;d++){e=c[d].left+""+c[d].top;if(!b[e]){b[e]=c[d]}}var f=[];for(e in b){f.push(b[e])}return f},render:function(e){var c=this.canvas.contextTop,d,b;c.fillStyle=this.color;this._saveAndTransform(c);for(d=0,b=e.length;d<b;d++){var a=e[d];if(typeof a.opacity!=="undefined"){c.globalAlpha=a.opacity}c.fillRect(a.x,a.y,a.width,a.width)}c.restore()},_render:function(){var a=this.canvas.contextTop,c,b;a.fillStyle=this.color;this._saveAndTransform(a);for(c=0,b=this.sprayChunks.length;c<b;c++){this.render(this.sprayChunks[c])}a.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var c,g,e,b=this.width/2,d;for(d=0;d<this.density;d++){c=fabric.util.getRandomInt(f.x-b,f.x+b);g=fabric.util.getRandomInt(f.y-b,f.y+b);if(this.dotWidthVariance){e=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{e=this.dotWidth}var a=new fabric.Point(c,g);a.width=e;if(this.randomOpacity){a.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=20,b=5,c=fabric.util.createCanvasElement(),a=c.getContext("2d");c.width=c.height=d+b;a.fillStyle=this.color;a.beginPath();a.arc(d/2,d/2,d/2,0,Math.PI*2,false);a.closePath();a.fill();return c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(c){var b=this.callSuper("createPath",c),a=b._getLeftTopCoords().scalarAdd(b.strokeWidth/2);b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-a.x,offsetY:-a.y});return b}});(function(){var c=fabric.util.getPointer,d=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees,e=Math.atan2,b=Math.abs,h=fabric.StaticCanvas.supports("setLineDash"),a=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(j,i){i||(i={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(j,i);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:false,uniScaleKey:"shiftKey",centeredScaling:false,centeredRotation:false,centeredKey:"altKey",altActionKey:"shiftKey",interactive:true,selection:true,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:false,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,preserveObjectStacking:false,snapAngle:0,snapThreshold:null,stopContextMenu:false,fireRightClick:false,fireMiddleClick:false,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_chooseObjectsToRender:function(){var n=this.getActiveObjects(),k,o,j;if(n.length>0&&!this.preserveObjectStacking){o=[];j=[];for(var l=0,m=this._objects.length;l<m;l++){k=this._objects[l];if(n.indexOf(k)===-1){o.push(k)}else{j.push(k)}}if(n.length>1){this._activeObject._objects=j}o.push.apply(o,j)}else{o=this._objects}return o},renderAll:function(){if(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop);this.contextTopDirty=false}if(this.hasLostContext){this.renderTopLayer(this.contextTop)}var i=this.contextContainer;this.renderCanvas(i,this._chooseObjectsToRender());return this},renderTopLayer:function(i){i.save();if(this.isDrawingMode&&this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._render();this.contextTopDirty=true}if(this.selection&&this._groupSelector){this._drawSelection(i);this.contextTopDirty=true}i.restore()},renderTop:function(){var i=this.contextTop;this.clearContext(i);this.renderTopLayer(i);this.fire("after:render");return this},_resetCurrentTransform:function(){var i=this._currentTransform;i.target.set({scaleX:i.original.scaleX,scaleY:i.original.scaleY,skewX:i.original.skewX,skewY:i.original.skewY,left:i.original.left,top:i.original.top});if(this._shouldCenterTransform(i.target)){if(i.originX!=="center"){if(i.originX==="right"){i.mouseXSign=-1}else{i.mouseXSign=1}}if(i.originY!=="center"){if(i.originY==="bottom"){i.mouseYSign=-1}else{i.mouseYSign=1}}i.originX="center";i.originY="center"}else{i.originX=i.original.originX;i.originY=i.original.originY}},containsPoint:function(m,l,i){var j=true,n=i||this.getPointer(m,j),k;if(l.group&&l.group===this._activeObject&&l.group.type==="activeSelection"){k=this._normalizePointer(l.group,n)}else{k={x:n.x,y:n.y}}return(l.containsPoint(k)||l._findTargetCorner(n))},_normalizePointer:function(k,n){var j=k.calcTransformMatrix(),i=fabric.util.invertTransform(j),l=this.restorePointerVpt(n);return fabric.util.transformPoint(l,i)},isTargetTransparent:function(m,o,n){if(m.shouldCache()&&m._cacheCanvas&&m!==this._activeObject){var q=this._normalizePointer(m,{x:o,y:n}),j=Math.max(m.cacheTranslationX+(q.x*m.zoomX),0),i=Math.max(m.cacheTranslationY+(q.y*m.zoomY),0);var l=fabric.util.isTransparent(m._cacheContext,Math.round(j),Math.round(i),this.targetFindTolerance);return l}var r=this.contextCache,k=m.selectionBackgroundColor,p=this.viewportTransform;m.selectionBackgroundColor="";this.clearContext(r);r.save();r.transform(p[0],p[1],p[2],p[3],p[4],p[5]);m.render(r);r.restore();m===this._activeObject&&m._renderControls(r,{hasBorders:false,transparentCorners:false},{hasBorders:false,});m.selectionBackgroundColor=k;var l=fabric.util.isTransparent(r,o,n,this.targetFindTolerance);return l},_isSelectionKeyPressed:function(i){var j=false;if(Object.prototype.toString.call(this.selectionKey)==="[object Array]"){j=!!this.selectionKey.find(function(k){return i[k]===true})}else{j=i[this.selectionKey]}return j},_shouldClearSelection:function(k,j){var l=this.getActiveObjects(),i=this._activeObject;return(!j||(j&&i&&l.length>1&&l.indexOf(j)===-1&&i!==j&&!this._isSelectionKeyPressed(k))||(j&&!j.evented)||(j&&!j.selectable&&i&&i!==j))},_shouldCenterTransform:function(k){if(!k){return}var j=this._currentTransform,i;if(j.action==="scale"||j.action==="scaleX"||j.action==="scaleY"){i=this.centeredScaling||k.centeredScaling}else{if(j.action==="rotate"){i=this.centeredRotation||k.centeredRotation}}return i?!j.altKey:j.altKey},_getOriginFromCorner:function(k,j){var i={x:k.originX,y:k.originY};if(j==="ml"||j==="tl"||j==="bl"){i.x="right"}else{if(j==="mr"||j==="tr"||j==="br"){i.x="left"}}if(j==="tl"||j==="mt"||j==="tr"){i.y="bottom"}else{if(j==="bl"||j==="mb"||j==="br"){i.y="top"}}return i},_getActionFromCorner:function(i,j,k){if(!j||!i){return"drag"}switch(j){case"mtr":return"rotate";case"ml":case"mr":return k[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return k[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(n,m,i){if(!m){return}var o=this.getPointer(n),k=m._findTargetCorner(this.getPointer(n,true)),l=this._getActionFromCorner(i,k,n,m),j=this._getOriginFromCorner(m,k);this._currentTransform={target:m,action:l,corner:k,scaleX:m.scaleX,scaleY:m.scaleY,skewX:m.skewX,skewY:m.skewY,offsetX:o.x-m.left,offsetY:o.y-m.top,originX:j.x,originY:j.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,theta:d(m.angle),width:m.width*m.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:n.shiftKey,altKey:n[this.centeredKey],original:fabric.util.saveObjectTransform(m),};this._currentTransform.original.originX=j.x;this._currentTransform.original.originY=j.y;this._resetCurrentTransform();this._beforeTransform(n)},_translateObject:function(i,p){var k=this._currentTransform,o=k.target,n=i-k.offsetX,j=p-k.offsetY,m=!o.get("lockMovementX")&&o.left!==n,l=!o.get("lockMovementY")&&o.top!==j;m&&o.set("left",n);l&&o.set("top",j);return m||l},_changeSkewTransformOrigin:function(n,p,j){var m="originX",k={0:"center"},r=p.target.skewX,q="left",o="right",l=p.corner==="mt"||p.corner==="ml"?1:-1,i=1;n=n>0?1:-1;if(j==="y"){r=p.target.skewY;q="top";o="bottom";m="originY"}k[-1]=q;k[1]=o;p.target.flipX&&(i*=-1);p.target.flipY&&(i*=-1);if(r===0){p.skewSign=-l*n*i;p[m]=k[-n]}else{r=r>0?1:-1;p.skewSign=r;p[m]=k[r*l*i]}},_skewObject:function(r,q,o){var u=this._currentTransform,n=u.target,w=false,k=n.get("lockSkewingX"),j=n.get("lockSkewingY");if((k&&o==="x")||(j&&o==="y")){return false}var i=n.getCenterPoint(),s=n.toLocalPoint(new fabric.Point(r,q),"center","center")[o],v=n.toLocalPoint(new fabric.Point(u.lastX,u.lastY),"center","center")[o],p,l,m=n._getTransformedDimensions();this._changeSkewTransformOrigin(s-v,u,o);p=n.toLocalPoint(new fabric.Point(r,q),u.originX,u.originY)[o];l=n.translateToOriginPoint(i,u.originX,u.originY);w=this._setObjectSkew(p,u,o,m);u.lastX=r;u.lastY=q;n.setPositionByOrigin(l,u.originX,u.originY);return w},_setObjectSkew:function(s,k,p,q){var o=k.target,i,x=false,n=k.skewSign,m,j,w,v,l,r,u,t;if(p==="x"){w="y";v="Y";l="X";u=0;t=o.skewY}else{w="x";v="X";l="Y";u=o.skewX;t=0}j=o._getTransformedDimensions(u,t);r=2*Math.abs(s)-j[p];if(r<=2){i=0}else{i=n*Math.atan((r/o["scale"+l])/(j[w]/o["scale"+v]));i=fabric.util.radiansToDegrees(i)}x=o["skew"+l]!==i;o.set("skew"+l,i);if(o["skew"+v]!==0){m=o._getTransformedDimensions();i=(q[w]/m[w])*o["scale"+v];o.set("scale"+v,i)}return x},_scaleObject:function(s,r,o){var u=this._currentTransform,m=u.target,p=m.lockScalingX,n=m.lockScalingY,i=m.lockScalingFlip;if(p&&n){return false}var j=m.translateToOriginPoint(m.getCenterPoint(),u.originX,u.originY),q=m.toLocalPoint(new fabric.Point(s,r),u.originX,u.originY),l=m._getTransformedDimensions(),k=false;this._setLocalMouse(q,u);k=this._setObjectScale(q,u,p,n,o,i,l);m.setPositionByOrigin(j,u.originX,u.originY);return k},_setObjectScale:function(s,j,q,o,p,i,r){var n=j.target,m=false,l=false,k=false,v=s.x*n.scaleX/r.x,u=s.y*n.scaleY/r.y,y=n.scaleX!==v,x=n.scaleY!==u;j.newScaleX=v;j.newScaleY=u;if(fabric.Textbox&&p==="x"&&n instanceof fabric.Textbox){var t=n.width*(s.x/r.x);if(t>=n.getMinWidth()){k=t!==n.width;n.set("width",t);return k}return false}if(i&&v<=0&&v<n.scaleX){m=true;s.x=0}if(i&&u<=0&&u<n.scaleY){l=true;s.y=0}if(p==="equally"&&!q&&!o){k=this._scaleObjectEqually(s,n,j,r)}else{if(!p){m||q||(n.set("scaleX",v)&&(k=k||y));l||o||(n.set("scaleY",u)&&(k=k||x))}else{if(p==="x"&&!n.get("lockUniScaling")){m||q||(n.set("scaleX",v)&&(k=y))}else{if(p==="y"&&!n.get("lockUniScaling")){l||o||(n.set("scaleY",u)&&(k=x))}}}}m||l||this._flipObject(j,p);return k},_scaleObjectEqually:function(o,l,i,m){var n=o.y+o.x,k=m.y*i.original.scaleY/l.scaleY+m.x*i.original.scaleX/l.scaleX,j,q=o.x<0?-1:1,p=o.y<0?-1:1,s,r;s=q*Math.abs(i.original.scaleX*n/k);r=p*Math.abs(i.original.scaleY*n/k);j=s!==l.scaleX||r!==l.scaleY;l.set("scaleX",s);l.set("scaleY",r);return j},_flipObject:function(i,j){if(i.newScaleX<0&&j!=="y"){if(i.originX==="left"){i.originX="right"}else{if(i.originX==="right"){i.originX="left"}}}if(i.newScaleY<0&&j!=="x"){if(i.originY==="top"){i.originY="bottom"}else{if(i.originY==="bottom"){i.originY="top"}}}},_setLocalMouse:function(m,i){var l=i.target,j=this.getZoom(),k=l.padding/j;if(i.originX==="right"){m.x*=-1}else{if(i.originX==="center"){m.x*=i.mouseXSign*2;if(m.x<0){i.mouseXSign=-i.mouseXSign}}}if(i.originY==="bottom"){m.y*=-1}else{if(i.originY==="center"){m.y*=i.mouseYSign*2;if(m.y<0){i.mouseYSign=-i.mouseYSign}}}if(b(m.x)>k){if(m.x<0){m.x+=k}else{m.x-=k}}else{m.x=0}if(b(m.y)>k){if(m.y<0){m.y+=k}else{m.y-=k}}else{m.y=0}},_rotateObject:function(q,p){var u=this._currentTransform,o=u.target,k,k=o.translateToOriginPoint(o.getCenterPoint(),u.originX,u.originY);if(o.lockRotation){return false}var l=e(u.ey-k.y,u.ex-k.x),r=e(p-k.y,q-k.x),m=f(r-l+u.theta),s=true;if(o.snapAngle>0){var j=o.snapAngle,n=o.snapThreshold||j,i=Math.ceil(m/j)*j,v=Math.floor(m/j)*j;if(Math.abs(m-v)<n){m=v}else{if(Math.abs(m-i)<n){m=i}}}if(m<0){m=360+m}m%=360;if(o.angle===m){s=false}else{o.angle=m;o.setPositionByOrigin(k,u.originX,u.originY)}return s},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(j){var i=this._groupSelector,p=i.left,o=i.top,n=b(p),l=b(o);if(this.selectionColor){j.fillStyle=this.selectionColor;j.fillRect(i.ex-((p>0)?0:-p),i.ey-((o>0)?0:-o),n,l)}if(!this.selectionLineWidth||!this.selectionBorderColor){return}j.lineWidth=this.selectionLineWidth;j.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1&&!h){var m=i.ex+a-((p>0)?0:n),k=i.ey+a-((o>0)?0:l);j.beginPath();fabric.util.drawDashedLine(j,m,k,m+n,k,this.selectionDashArray);fabric.util.drawDashedLine(j,m,k+l-1,m+n,k+l-1,this.selectionDashArray);fabric.util.drawDashedLine(j,m,k,m,k+l,this.selectionDashArray);fabric.util.drawDashedLine(j,m+n-1,k,m+n-1,k+l,this.selectionDashArray);j.closePath();j.stroke()}else{fabric.Object.prototype._setLineDash.call(this,j,this.selectionDashArray);j.strokeRect(i.ex+a-((p>0)?0:n),i.ey+a-((o>0)?0:l),n,l)}},findTarget:function(o,m){if(this.skipTargetFind){return}var q=true,i=this.getPointer(o,q),k=this._activeObject,j=this.getActiveObjects(),l,p;this.targets=[];if(j.length>1&&!m&&k===this._searchPossibleTargets([k],i)){return k}if(j.length===1&&k._findTargetCorner(i)){return k}if(j.length===1&&k===this._searchPossibleTargets([k],i)){if(!this.preserveObjectStacking){return k}else{l=k;p=this.targets;this.targets=[]}}var n=this._searchPossibleTargets(this._objects,i);if(o[this.altSelectionKey]&&n&&l&&n!==l){n=l;this.targets=p}return n},_checkTarget:function(l,k,i){if(k&&k.visible&&k.evented&&this.containsPoint(null,k,l)){if((this.perPixelTargetFind||k.perPixelTargetFind)&&!k.isEditing){var j=this.isTargetTransparent(k,i.x,i.y);if(!j){return true}}else{return true}}},_searchPossibleTargets:function(m,p){var n,j=m.length,k;while(j--){var o=m[j];var l=o.group&&o.group.type!=="activeSelection"?this._normalizePointer(o.group,p):p;if(this._checkTarget(l,o,p)){n=m[j];if(n.subTargetCheck&&n instanceof fabric.Group){k=this._searchPossibleTargets(n._objects,p);k&&this.targets.push(k)}break}}return n},restorePointerVpt:function(i){return fabric.util.transformPoint(i,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(m,o){if(this._absolutePointer&&!o){return this._absolutePointer}if(this._pointer&&o){return this._pointer}var i=c(m),l=this.upperCanvasEl,j=l.getBoundingClientRect(),k=j.width||0,p=j.height||0,q;if(!k||!p){if("top" in j&&"bottom" in j){p=Math.abs(j.top-j.bottom)}if("right" in j&&"left" in j){k=Math.abs(j.right-j.left)}}this.calcOffset();i.x=i.x-this._offset.left;i.y=i.y-this._offset.top;if(!o){i=this.restorePointerVpt(i)}var n=this.getRetinaScaling();if(n!==1){i.x/=n;i.y/=n}if(k===0||p===0){q={width:1,height:1}}else{q={width:l.width/k,height:l.height/p}}return{x:i.x*q.width,y:i.y*q.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),k=this.lowerCanvasEl,j=this.upperCanvasEl;if(j){j.className=""}else{j=this._createCanvasElement();this.upperCanvasEl=j}fabric.util.addClass(j,"upper-canvas "+i);this.wrapperEl.appendChild(j);this._copyCanvasStyle(k,j);this._applyCanvasStyle(j);this.contextTop=j.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(j){var k=this.width||j.width,i=this.height||j.height;fabric.util.setStyle(j,{position:"absolute",width:k+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"});j.width=k;j.height=i;fabric.util.makeElementUnselectable(j)},_copyCanvasStyle:function(j,i){i.style.cssText=j.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;if(i){if(i.type==="activeSelection"&&i._objects){return i._objects.slice(0)}else{return[i]}}return[]},_onObjectRemoved:function(i){if(i===this._activeObject){this.fire("before:selection:cleared",{target:i});this._discardActiveObject();this.fire("selection:cleared",{target:i});i.fire("deselected")}if(i===this._hoveredTarget){this._hoveredTarget=null;this._hoveredTargets=[]}this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(l,o){var i=false,m=this.getActiveObjects(),k=[],n=[],j={e:o};l.forEach(function(p){if(m.indexOf(p)===-1){i=true;p.fire("deselected",j);n.push(p)}});m.forEach(function(p){if(l.indexOf(p)===-1){i=true;p.fire("selected",j);k.push(p)}});if(l.length>0&&m.length>0){j.selected=k;j.deselected=n;j.updated=k[0]||n[0];j.target=this._activeObject;i&&this.fire("selection:updated",j)}else{if(m.length>0){if(m.length===1){j.target=k[0];this.fire("object:selected",j)}j.selected=k;j.target=this._activeObject;this.fire("selection:created",j)}else{if(l.length>0){j.deselected=n;this.fire("selection:cleared",j)}}}},setActiveObject:function(i,k){var j=this.getActiveObjects();this._setActiveObject(i,k);this._fireSelectionEvents(j,k);return this},_setActiveObject:function(i,j){if(this._activeObject===i){return false}if(!this._discardActiveObject(j,i)){return false}if(i.onSelect({e:j})){return false}this._activeObject=i;return true},_discardActiveObject:function(k,i){var j=this._activeObject;if(j){if(j.onDeselect({e:k,object:i})){return false}this._activeObject=null}return true},discardActiveObject:function(k){var j=this.getActiveObjects(),i=this.getActiveObject();if(j.length){this.fire("before:selection:cleared",{target:i,e:k})}this._discardActiveObject(k);this._fireSelectionEvents(j,k);return this},dispose:function(){var i=this.wrapperEl;this.removeListeners();i.removeChild(this.upperCanvasEl);i.removeChild(this.lowerCanvasEl);this.contextCache=null;this.contextTop=null;["upperCanvasEl","cacheCanvasEl"].forEach((function(j){fabric.util.cleanUpJsdomNode(this[j]);this[j]=undefined}).bind(this));if(i.parentNode){i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl)}delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this},clear:function(){this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper("clear")},drawControls:function(i){var j=this._activeObject;if(j){j._renderControls(i)}},_toObject:function(i,j,m){var l=this._realizeGroupTransformOnObject(i),k=this.callSuper("_toObject",i,j,m);this._unwindGroupTransformOnObject(i,l);return k},_realizeGroupTransformOnObject:function(i){if(i.group&&i.group.type==="activeSelection"&&this._activeObject===i.group){var j=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"];var k={};j.forEach(function(l){k[l]=i[l]});this._activeObject.realizeTransform(i);return k}else{return null}},_unwindGroupTransformOnObject:function(i,j){if(j){i.set(j)}},_setSVGObject:function(k,j,i){var l=this._realizeGroupTransformOnObject(j);this.callSuper("_setSVGObject",k,j,i);this._unwindGroupTransformOnObject(j,l)},setViewportTransform:function(i){if(this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing){this._activeObject.clearContextTop()}fabric.StaticCanvas.prototype.setViewportTransform.call(this,i)}});for(var g in fabric.StaticCanvas){if(g!=="prototype"){fabric.Canvas[g]=fabric.StaticCanvas[g]}}})();(function(){var b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,f=fabric.util.removeListener,a=3,h=2,g=1,d={passive:false};function c(j,i){return j.button&&(j.button===i-1)}fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],mainTouchId:null,_initEventListeners:function(){this.removeListeners();this._bindEvents();this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(k,j){var i=this.upperCanvasEl,l=this._getEventPrefix();k(fabric.window,"resize",this._onResize);k(i,l+"down",this._onMouseDown);k(i,l+"move",this._onMouseMove,d);k(i,l+"out",this._onMouseOut);k(i,l+"enter",this._onMouseEnter);k(i,"wheel",this._onMouseWheel);k(i,"contextmenu",this._onContextMenu);k(i,"dblclick",this._onDoubleClick);k(i,"dragover",this._onDragOver);k(i,"dragenter",this._onDragEnter);k(i,"dragleave",this._onDragLeave);k(i,"drop",this._onDrop);if(!this.enablePointerEvents){k(i,"touchstart",this._onTouchStart,d)}if(typeof eventjs!=="undefined"&&j in eventjs){eventjs[j](i,"gesture",this._onGesture);eventjs[j](i,"drag",this._onDrag);eventjs[j](i,"orientation",this._onOrientationChange);eventjs[j](i,"shake",this._onShake);eventjs[j](i,"longpress",this._onLongPress)}},removeListeners:function(){this.addOrRemove(f,"remove");var i=this._getEventPrefix();f(fabric.document,i+"up",this._onMouseUp);f(fabric.document,"touchend",this._onTouchEnd,d);f(fabric.document,i+"move",this._onMouseMove,d);f(fabric.document,"touchmove",this._onMouseMove,d)},_bindEvents:function(){if(this.eventsBound){return}this._onMouseDown=this._onMouseDown.bind(this);this._onTouchStart=this._onTouchStart.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this);this._onMouseEnter=this._onMouseEnter.bind(this);this._onContextMenu=this._onContextMenu.bind(this);this._onDoubleClick=this._onDoubleClick.bind(this);this._onDragOver=this._onDragOver.bind(this);this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter");this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave");this._onDrop=this._simpleEventHandler.bind(this,"drop");this.eventsBound=true},_onGesture:function(j,i){this.__onTransformGesture&&this.__onTransformGesture(j,i)},_onDrag:function(j,i){this.__onDrag&&this.__onDrag(j,i)},_onMouseWheel:function(i){this.__onMouseWheel(i)},_onMouseOut:function(j){var i=this._hoveredTarget;this.fire("mouse:out",{target:i,e:j});this._hoveredTarget=null;i&&i.fire("mouseout",{e:j});var k=this;this._hoveredTargets.forEach(function(l){k.fire("mouse:out",{target:i,e:j});l&&i.fire("mouseout",{e:j})});this._hoveredTargets=[];if(this._iTextInstances){this._iTextInstances.forEach(function(l){if(l.isEditing){l.hiddenTextarea.focus()}})}},_onMouseEnter:function(i){if(!this.currentTransform&&!this.findTarget(i)){this.fire("mouse:over",{target:null,e:i});this._hoveredTarget=null;this._hoveredTargets=[]}},_onOrientationChange:function(j,i){this.__onOrientationChange&&this.__onOrientationChange(j,i)},_onShake:function(j,i){this.__onShake&&this.__onShake(j,i)},_onLongPress:function(j,i){this.__onLongPress&&this.__onLongPress(j,i)},_onDragOver:function(j){j.preventDefault();var i=this._simpleEventHandler("dragover",j);this._fireEnterLeaveEvents(i,j)},_onContextMenu:function(i){if(this.stopContextMenu){i.stopPropagation();i.preventDefault()}return false},_onDoubleClick:function(i){this._cacheTransformEventData(i);this._handleEvent(i,"dblclick");this._resetTransformEventData(i)},getPointerId:function(i){var j=i.changedTouches;if(j){return j[0]&&j[0].identifier}if(this.enablePointerEvents){return i.pointerId}return -1},_isMainEvent:function(i){if(i.isPrimary===true){return true}if(i.isPrimary===false){return false}if(i.type==="touchend"&&i.touches.length===0){return true}if(i.changedTouches){return i.changedTouches[0].identifier===this.mainTouchId}return true},_onTouchStart:function(k){k.preventDefault();if(this.mainTouchId===null){this.mainTouchId=this.getPointerId(k)}this.__onMouseDown(k);this._resetTransformEventData();var i=this.upperCanvasEl,j=this._getEventPrefix();e(fabric.document,"touchend",this._onTouchEnd,d);e(fabric.document,"touchmove",this._onMouseMove,d);f(i,j+"down",this._onMouseDown)},_onMouseDown:function(k){this.__onMouseDown(k);this._resetTransformEventData();var i=this.upperCanvasEl,j=this._getEventPrefix();f(i,j+"move",this._onMouseMove,d);e(fabric.document,j+"up",this._onMouseUp);e(fabric.document,j+"move",this._onMouseMove,d)},_onTouchEnd:function(j){if(j.touches.length>0){return}this.__onMouseUp(j);this._resetTransformEventData();this.mainTouchId=null;var i=this._getEventPrefix();f(fabric.document,"touchend",this._onTouchEnd,d);f(fabric.document,"touchmove",this._onMouseMove,d);var k=this;if(this._willAddMouseDown){clearTimeout(this._willAddMouseDown)}this._willAddMouseDown=setTimeout(function(){e(k.upperCanvasEl,i+"down",k._onMouseDown);k._willAddMouseDown=0},400)},_onMouseUp:function(k){this.__onMouseUp(k);this._resetTransformEventData();var i=this.upperCanvasEl,j=this._getEventPrefix();if(this._isMainEvent(k)){f(fabric.document,j+"up",this._onMouseUp);f(fabric.document,j+"move",this._onMouseMove,d);e(i,j+"move",this._onMouseMove,d)}},_onMouseMove:function(i){!this.allowTouchScrolling&&i.preventDefault&&i.preventDefault();this.__onMouseMove(i)},_onResize:function(){this.calcOffset()},_shouldRender:function(j){var i=this._activeObject;if(!!i!==!!j||(i&&j&&(i!==j))){return true}else{if(i&&i.isEditing){return false}}return false},__onMouseUp:function(m){var l,j=this._currentTransform,i=this._groupSelector,n=false,k=(!i||(i.left===0&&i.top===0));this._cacheTransformEventData(m);l=this._target;this._handleEvent(m,"up:before");if(c(m,a)){if(this.fireRightClick){this._handleEvent(m,"up",a,k)}return}if(c(m,h)){if(this.fireMiddleClick){this._handleEvent(m,"up",h,k)}this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(m);return}if(!this._isMainEvent(m)){return}if(j){this._finalizeCurrentTransform(m);n=j.actionPerformed}if(!k){this._maybeGroupObjects(m);n||(n=this._shouldRender(l))}if(l){l.isMoving=false}this._setCursorFromEvent(m,l);this._handleEvent(m,"up",g,k);this._groupSelector=null;this._currentTransform=null;l&&(l.__corner=0);if(n){this.requestRenderAll()}else{if(!k){this.renderTop()}}},_simpleEventHandler:function(m,o){var n=this.findTarget(o),j=this.targets,k={e:o,target:n,subTargets:j,};this.fire(m,k);n&&n.fire(m,k);if(!j){return n}for(var l=0;l<j.length;l++){j[l].fire(m,k)}return n},_handleEvent:function(q,n,m,p){var o=this._target,j=this.targets||[],k={e:q,target:o,subTargets:j,button:m||g,isClick:p||false,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+n,k);o&&o.fire("mouse"+n,k);for(var l=0;l<j.length;l++){j[l].fire("mouse"+n,k)}},_finalizeCurrentTransform:function(m){var k=this._currentTransform,l=k.target,i,j={e:m,target:l,transform:k,};if(l._scaling){l._scaling=false}l.setCoords();if(k.actionPerformed||(this.stateful&&l.hasStateChanged())){if(k.actionPerformed){i=this._addEventOptions(j,k);this._fire(i,j)}this._fire("modified",j)}},_addEventOptions:function(k,j){var i,l;switch(j.action){case"scaleX":i="scaled";l="x";break;case"scaleY":i="scaled";l="y";break;case"skewX":i="skewed";l="x";break;case"skewY":i="skewed";l="y";break;case"scale":i="scaled";l="equally";break;case"rotate":i="rotated";break;case"drag":i="moved";break}k.by=l;return i},_onMouseDownInDrawingMode:function(i){this._isCurrentlyDrawing=true;if(this.getActiveObject()){this.discardActiveObject(i).requestRenderAll()}if(this.clipTo){fabric.util.clipContext(this,this.contextTop)}var j=this.getPointer(i);this.freeDrawingBrush.onMouseDown(j,{e:i,pointer:j});this._handleEvent(i,"down")},_onMouseMoveInDrawingMode:function(i){if(this._isCurrentlyDrawing){var j=this.getPointer(i);this.freeDrawingBrush.onMouseMove(j,{e:i,pointer:j})}this.setCursor(this.freeDrawingCursor);this._handleEvent(i,"move")},_onMouseUpInDrawingMode:function(i){if(this.clipTo){this.contextTop.restore()}var j=this.getPointer(i);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:i,pointer:j});this._handleEvent(i,"up")},__onMouseDown:function(l){this._cacheTransformEventData(l);this._handleEvent(l,"down:before");var k=this._target;if(c(l,a)){if(this.fireRightClick){this._handleEvent(l,"down",a)}return}if(c(l,h)){if(this.fireMiddleClick){this._handleEvent(l,"down",h)}return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(l);return}if(!this._isMainEvent(l)){return}if(this._currentTransform){return}var n=this._pointer;this._previousPointer=n;var m=this._shouldRender(k),j=this._shouldGroup(l,k);if(this._shouldClearSelection(l,k)){this.discardActiveObject(l)}else{if(j){this._handleGrouping(l,k);k=this._activeObject}}if(this.selection&&(!k||(!k.selectable&&!k.isEditing&&k!==this._activeObject))){this._groupSelector={ex:n.x,ey:n.y,top:0,left:0}}if(k){var i=k===this._activeObject;if(k.selectable){this.setActiveObject(k,l)}if(k===this._activeObject&&(k.__corner||!j)){this._setupCurrentTransform(l,k,i)}}this._handleEvent(l,"down");(m||j)&&this.requestRenderAll()},_resetTransformEventData:function(){this._target=null;this._pointer=null;this._absolutePointer=null},_cacheTransformEventData:function(i){this._resetTransformEventData();this._pointer=this.getPointer(i,true);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(i)||null},_beforeTransform:function(j){var i=this._currentTransform;this.stateful&&i.target.saveState();this.fire("before:transform",{e:j,transform:i,});if(i.corner){this.onBeforeScaleRotate(i.target)}},__onMouseMove:function(k){this._handleEvent(k,"move:before");this._cacheTransformEventData(k);var j,l;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(k);return}if(!this._isMainEvent(k)){return}var i=this._groupSelector;if(i){l=this._pointer;i.left=l.x-i.ex;i.top=l.y-i.ey;this.renderTop()}else{if(!this._currentTransform){j=this.findTarget(k)||null;this._setCursorFromEvent(k,j);this._fireOverOutEvents(j,k)}else{this._transformObject(k)}}this._handleEvent(k,"move");this._resetTransformEventData()},_fireOverOutEvents:function(p,o){var j=this._hoveredTarget,n=this._hoveredTargets,k=this.targets,m=Math.max(n.length,k.length);this.fireSyntheticInOutEvents(p,o,{oldTarget:j,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over",});for(var l=0;l<m;l++){this.fireSyntheticInOutEvents(k[l],o,{oldTarget:n[l],evtOut:"mouseout",evtIn:"mouseover",})}this._hoveredTarget=p;this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(p,o){var l=this._draggedoverTarget,n=this._hoveredTargets,j=this.targets,m=Math.max(n.length,j.length);this.fireSyntheticInOutEvents(p,o,{oldTarget:l,evtOut:"dragleave",evtIn:"dragenter",});for(var k=0;k<m;k++){this.fireSyntheticInOutEvents(j[k],o,{oldTarget:n[k],evtOut:"dragleave",evtIn:"dragenter",})}this._draggedoverTarget=p},fireSyntheticInOutEvents:function(o,p,i){var j,r,q=i.oldTarget,k,s,n=q!==o,m=i.canvasEvtIn,l=i.canvasEvtOut;if(n){j={e:p,target:o,previousTarget:q};r={e:p,target:q,nextTarget:o}}s=o&&n;k=q&&n;if(k){l&&this.fire(l,r);q.fire(i.evtOut,r)}if(s){m&&this.fire(m,j);o.fire(i.evtIn,j)}},__onMouseWheel:function(i){this._cacheTransformEventData(i);this._handleEvent(i,"wheel");this._resetTransformEventData()},_transformObject:function(j){var k=this.getPointer(j),i=this._currentTransform;i.reset=false;i.target.isMoving=true;i.shiftKey=j.shiftKey;i.altKey=j[this.centeredKey];this._beforeScaleTransform(j,i);this._performTransformAction(j,i,k);i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(m,k,o){var i=o.x,p=o.y,l=k.action,n=false,j={target:k.target,e:m,transform:k,pointer:o};if(l==="rotate"){(n=this._rotateObject(i,p))&&this._fire("rotating",j)}else{if(l==="scale"){(n=this._onScale(m,k,i,p))&&this._fire("scaling",j)}else{if(l==="scaleX"){(n=this._scaleObject(i,p,"x"))&&this._fire("scaling",j)}else{if(l==="scaleY"){(n=this._scaleObject(i,p,"y"))&&this._fire("scaling",j)}else{if(l==="skewX"){(n=this._skewObject(i,p,"x"))&&this._fire("skewing",j)}else{if(l==="skewY"){(n=this._skewObject(i,p,"y"))&&this._fire("skewing",j)}else{n=this._translateObject(i,p);if(n){this._fire("moving",j);this.setCursor(j.target.moveCursor||this.moveCursor)}}}}}}}k.actionPerformed=k.actionPerformed||n},_fire:function(i,j){this.fire("object:"+i,j);j.target.fire(i,j)},_beforeScaleTransform:function(k,i){if(i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"){var j=this._shouldCenterTransform(i.target);if((j&&(i.originX!=="center"||i.originY!=="center"))||(!j&&i.originX==="center"&&i.originY==="center")){this._resetCurrentTransform();i.reset=true}}},_onScale:function(k,j,i,l){if(this._isUniscalePossible(k,j.target)){j.currentAction="scale";return this._scaleObject(i,l)}else{if(!j.reset&&j.currentAction==="scale"){this._resetCurrentTransform()}j.currentAction="scaleEqually";return this._scaleObject(i,l,"equally")}},_isUniscalePossible:function(j,i){return(j[this.uniScaleKey]||this.uniScaleTransform)&&!i.get("lockUniScaling")},_setCursorFromEvent:function(k,j){if(!j){this.setCursor(this.defaultCursor);return false}var l=j.hoverCursor||this.hoverCursor,m=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,i=(!m||!m.contains(j))&&j._findTargetCorner(this.getPointer(k,true));if(!i){if(j.subTargetCheck){this.targets.concat().reverse().map(function(n){l=n.hoverCursor||l})}this.setCursor(l)}else{this.setCursor(this.getCornerCursor(i,j,k))}},getCornerCursor:function(i,k,j){if(this.actionIsDisabled(i,k,j)){return this.notAllowedCursor}else{if(i in b){return this._getRotatedCornerCursor(i,k,j)}else{if(i==="mtr"&&k.hasRotatingPoint){return this.rotationCursor}else{return this.defaultCursor}}}},actionIsDisabled:function(i,k,j){if(i==="mt"||i==="mb"){return j[this.altActionKey]?k.lockSkewingX:k.lockScalingY}else{if(i==="ml"||i==="mr"){return j[this.altActionKey]?k.lockSkewingY:k.lockScalingX}else{if(i==="mtr"){return k.lockRotation}else{return this._isUniscalePossible(j,k)?k.lockScalingX&&k.lockScalingY:k.lockScalingX||k.lockScalingY}}}},_getRotatedCornerCursor:function(i,k,j){var l=Math.round((k.angle%360)/45);if(l<0){l+=8}l+=b[i];if(j[this.altActionKey]&&b[i]%2===0){l+=2}l%=8;return this.cursorMap[l]}})})();(function(){var b=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(f,d){var c=this._activeObject;return c&&this._isSelectionKeyPressed(f)&&d&&d.selectable&&this.selection&&(c!==d||c.type==="activeSelection")&&!d.onSelect({e:f})},_handleGrouping:function(f,d){var c=this._activeObject;if(c.__corner){return}if(d===c){d=this.findTarget(f,true);if(!d||!d.selectable){return}}if(c&&c.type==="activeSelection"){this._updateActiveSelection(d,f)}else{this._createActiveSelection(d,f)}},_updateActiveSelection:function(d,c){var g=this._activeObject,f=g._objects.slice(0);if(g.contains(d)){g.removeWithUpdate(d);this._hoveredTarget=d;this._hoveredTargets=this.targets.concat();if(g.size()===1){this._setActiveObject(g.item(0),c)}}else{g.addWithUpdate(d);this._hoveredTarget=g;this._hoveredTargets=this.targets.concat()}this._fireSelectionEvents(f,c)},_createActiveSelection:function(g,f){var c=this.getActiveObjects(),d=this._createGroup(g);this._hoveredTarget=d;this._setActiveObject(d,f);this._fireSelectionEvents(c,f)},_createGroup:function(f){var e=this._objects,c=e.indexOf(this._activeObject)<e.indexOf(f),d=c?[this._activeObject,f]:[f,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(d,{canvas:this})},_groupSelectedObjects:function(f){var d=this._collectObjects(f),c;if(d.length===1){this.setActiveObject(d[0],f)}else{if(d.length>1){c=new fabric.ActiveSelection(d.reverse(),{canvas:this});this.setActiveObject(c,f)}}},_collectObjects:function(h){var p=[],k,d=this._groupSelector.ex,n=this._groupSelector.ey,c=d+this._groupSelector.left,l=n+this._groupSelector.top,j=new fabric.Point(b(d,c),b(n,l)),m=new fabric.Point(a(d,c),a(n,l)),g=!this.selectionFullyContained,o=d===c&&n===l;for(var f=this._objects.length;f--;){k=this._objects[f];if(!k||!k.selectable||!k.visible){continue}if((g&&k.intersectsWithRect(j,m))||k.isContainedWithinRect(j,m)||(g&&k.containsPoint(j))||(g&&k.containsPoint(m))){p.push(k);if(o){break}}}if(p.length>1){p=p.filter(function(e){return !e.onSelect({e:h})})}return p},_maybeGroupObjects:function(c){if(this.selection&&this._groupSelector){this._groupSelectedObjects(c)}this.setCursor(this.defaultCursor);this._groupSelector=null}})})();(function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var c=a.format||"png",e=a.quality||1,d=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),b=this.toCanvasElement(d,a);return fabric.util.toDataURL(b,c,e)},toCanvasElement:function(n,d){n=n||1;d=d||{};var i=(d.width||this.width)*n,k=(d.height||this.height)*n,o=this.getZoom(),c=this.width,h=this.height,j=o*n,a=this.viewportTransform,f=(a[4]-(d.left||0))*n,b=(a[5]-(d.top||0))*n,p=this.interactive,e=[j,0,0,j,f,b],m=this.enableRetinaScaling,g=fabric.util.createCanvasElement(),l=this.contextTop;g.width=i;g.height=k;this.contextTop=null;this.enableRetinaScaling=false;this.interactive=false;this.viewportTransform=e;this.width=i;this.height=k;this.calcViewportBoundaries();this.renderCanvas(g.getContext("2d"),this._objects);this.viewportTransform=a;this.width=c;this.height=h;this.calcViewportBoundaries();this.interactive=p;this.enableRetinaScaling=m;this.contextTop=l;return g},})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(b,c,a){return this.loadFromJSON(b,c,a)},loadFromJSON:function(b,g,a){if(!b){return}var d=(typeof b==="string")?JSON.parse(b):fabric.util.object.clone(b);var f=this,c=d.clipPath,e=this.renderOnAddRemove;this.renderOnAddRemove=false;delete d.clipPath;this._enlivenObjects(d.objects,function(h){f.clear();f._setBgOverlay(d,function(){if(c){f._enlivenObjects([c],function(i){f.clipPath=i[0];f.__setupCanvas.call(f,d,h,e,g)})}else{f.__setupCanvas.call(f,d,h,e,g)}})},a);return this},__setupCanvas:function(b,a,c,e){var d=this;a.forEach(function(g,f){d.insertAt(g,f)});this.renderOnAddRemove=c;delete b.objects;delete b.backgroundImage;delete b.overlayImage;delete b.background;delete b.overlay;this._setOptions(b);this.renderAll();e&&e()},_setBgOverlay:function(c,d){var b={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!c.backgroundImage&&!c.overlayImage&&!c.background&&!c.overlay){d&&d();return}var a=function(){if(b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor){d&&d()}};this.__setBgOverlay("backgroundImage",c.backgroundImage,b,a);this.__setBgOverlay("overlayImage",c.overlayImage,b,a);this.__setBgOverlay("backgroundColor",c.background,b,a);this.__setBgOverlay("overlayColor",c.overlay,b,a)},__setBgOverlay:function(c,b,a,e){var d=this;if(!b){a[c]=true;e&&e();return}if(c==="backgroundImage"||c==="overlayImage"){fabric.util.enlivenObjects([b],function(f){d[c]=f[0];a[c]=true;e&&e()})}else{this["set"+fabric.util.string.capitalize(c,true)](b,function(){a[c]=true;e&&e()})}},_enlivenObjects:function(b,c,a){if(!b||b.length===0){c&&c([]);return}fabric.util.enlivenObjects(b,function(d){c&&c(d)},null,a)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(c,a){var b=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(b,function(){c&&c(d)})})},cloneWithoutData:function(c){var a=fabric.util.createCanvasElement();a.width=this.width;a.height=this.height;var b=new fabric.Canvas(a);b.clipTo=this.clipTo;if(this.backgroundImage){b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();c&&c(b)});b.backgroundImageOpacity=this.backgroundImageOpacity;b.backgroundImageStretch=this.backgroundImageStretch}else{c&&c(b)}}});(function(b){var e=b.fabric||(b.fabric={}),h=e.util.object.extend,i=e.util.object.clone,d=e.util.toFixed,g=e.util.string.capitalize,c=e.util.degreesToRadians,j=e.StaticCanvas.supports("setLineDash"),a=!e.isLikelyNode,f=2;if(e.Object){return}e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,objectCaching:a,statefullCache:false,noScaleCache:true,strokeUniform:false,dirty:true,__corner:0,paintFirst:"fill",stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform").split(" "),cacheProperties:("fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath").split(" "),clipPath:undefined,inverted:false,absolutePositioned:false,initialize:function(k){if(k){this.setOptions(k)}},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=e.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext("2d");this._updateCacheCanvas();this.dirty=true},_limitCacheSize:function(t){var k=e.perfLimitSizeTotal,l=t.width,u=t.height,r=e.maxCacheSideLimit,n=e.minCacheSideLimit;if(l<=r&&u<=r&&l*u<=k){if(l<n){t.width=n}if(u<n){t.height=n}return t}var m=l/u,o=e.util.limitDimsByArea(m,k),p=e.util.capValue,s=p(n,o.x,r),q=p(n,o.y,r);if(l>s){t.zoomX/=l/s;t.width=s;t.capped=true}if(u>q){t.zoomY/=u/q;t.height=q;t.capped=true}return t},_getCacheCanvasDimensions:function(){var l=this.getTotalObjectScaling(),n=this._getTransformedDimensions(0,0),m=n.x*l.scaleX/this.scaleX,k=n.y*l.scaleY/this.scaleY;return{width:m+f,height:k+f,zoomX:l.scaleX,zoomY:l.scaleY,x:m,y:k}},_updateCacheCanvas:function(){var D=this.canvas;if(this.noScaleCache&&D&&D._currentTransform){var F=D._currentTransform.target,B=D._currentTransform.action;if(this===F&&B.slice&&B.slice(0,5)==="scale"){return false}}var n=this._cacheCanvas,y=this._limitCacheSize(this._getCacheCanvasDimensions()),k=e.minCacheSideLimit,z=y.width,x=y.height,o,u,s=y.zoomX,p=y.zoomY,C=z!==this.cacheWidth||x!==this.cacheHeight,q=this.zoomX!==s||this.zoomY!==p,w=C||q,t=0,A=0,r=false;if(C){var E=this._cacheCanvas.width,m=this._cacheCanvas.height,v=z>E||x>m,l=(z<E*0.9||x<m*0.9)&&E>k&&m>k;r=v||l;if(v&&!y.capped&&(z>k||x>k)){t=z*0.1;A=x*0.1}}if(w){if(r){n.width=Math.ceil(z+t);n.height=Math.ceil(x+A)}else{this._cacheContext.setTransform(1,0,0,1,0,0);this._cacheContext.clearRect(0,0,n.width,n.height)}o=y.x/2;u=y.y/2;this.cacheTranslationX=Math.round(n.width/2-o)+o;this.cacheTranslationY=Math.round(n.height/2-u)+u;this.cacheWidth=z;this.cacheHeight=x;this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY);this._cacheContext.scale(s,p);this.zoomX=s;this.zoomY=p;return true}return false},setOptions:function(k){this._setOptions(k);this._initGradient(k.fill,"fill");this._initGradient(k.stroke,"stroke");this._initClipping(k);this._initPattern(k.fill,"fill");this._initPattern(k.stroke,"stroke")},transform:function(l){var k;if(this.group&&!this.group._transformDone){k=this.calcTransformMatrix()}else{k=this.calcOwnMatrix()}l.transform(k[0],k[1],k[2],k[3],k[4],k[5])},toObject:function(m){var l=e.Object.NUM_FRACTION_DIGITS,k={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:d(this.left,l),top:d(this.top,l),width:d(this.width,l),height:d(this.height,l),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,l),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,l),scaleX:d(this.scaleX,l),scaleY:d(this.scaleY,l),angle:d(this.angle,l),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,l),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:d(this.skewX,l),skewY:d(this.skewY,l),};if(this.clipPath){k.clipPath=this.clipPath.toObject(m);k.clipPath.inverted=this.clipPath.inverted;k.clipPath.absolutePositioned=this.clipPath.absolutePositioned}e.util.populateWithProperties(this,k,m);if(!this.includeDefaultValues){k=this._removeDefaultValues(k)}return k},toDatalessObject:function(k){return this.toObject(k)},_removeDefaultValues:function(l){var k=e.util.getKlass(l.type).prototype,m=k.stateProperties;m.forEach(function(o){if(o==="left"||o==="top"){return}if(l[o]===k[o]){delete l[o]}var n=Object.prototype.toString.call(l[o])==="[object Array]"&&Object.prototype.toString.call(k[o])==="[object Array]";if(n&&l[o].length===0&&k[o].length===0){delete l[o]}});return l},toString:function(){return"#<fabric."+g(this.type)+">"},getObjectScaling:function(){var l=this.scaleX,k=this.scaleY;if(this.group){var m=this.group.getObjectScaling();l*=m.scaleX;k*=m.scaleY}return{scaleX:l,scaleY:k}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),m=o.scaleX,l=o.scaleY;if(this.canvas){var n=this.canvas.getZoom();var k=this.canvas.getRetinaScaling();m*=n*k;l*=n*k}return{scaleX:m,scaleY:l}},getObjectOpacity:function(){var k=this.opacity;if(this.group){k*=this.group.getObjectOpacity()}return k},_set:function(m,n){var o=(m==="scaleX"||m==="scaleY"),k=this[m]!==n,l=false;if(o){n=this._constrainScale(n)}if(m==="scaleX"&&n<0){this.flipX=!this.flipX;n*=-1}else{if(m==="scaleY"&&n<0){this.flipY=!this.flipY;n*=-1}else{if(m==="shadow"&&n&&!(n instanceof e.Shadow)){n=new e.Shadow(n)}else{if(m==="dirty"&&this.group){this.group.set("dirty",n)}}}}this[m]=n;if(k){l=this.group&&this.group.isOnACache();if(this.cacheProperties.indexOf(m)>-1){this.dirty=true;l&&this.group.set("dirty",true)}else{if(l&&this.stateProperties.indexOf(m)>-1){this.group.set("dirty",true)}}}return this},setOnGroup:function(){},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||(this.width===0&&this.height===0&&this.strokeWidth===0)||!this.visible},render:function(k){if(this.isNotVisible()){return}if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return}k.save();this._setupCompositeOperation(k);this.drawSelectionBackground(k);this.transform(k);this._setOpacity(k);this._setShadow(k,this);if(this.transformMatrix){k.transform.apply(k,this.transformMatrix)}this.clipTo&&e.util.clipContext(this,k);if(this.shouldCache()){this.renderCache();this.drawCacheOnCanvas(k)}else{this._removeCacheCanvas();this.dirty=false;this.drawObject(k);if(this.objectCaching&&this.statefullCache){this.saveState({propertySet:"cacheProperties"})}}this.clipTo&&k.restore();k.restore()},renderCache:function(k){k=k||{};if(!this._cacheCanvas){this._createCacheCanvas()}if(this.isCacheDirty()){this.statefullCache&&this.saveState({propertySet:"cacheProperties"});this.drawObject(this._cacheContext,k.forClipping);this.dirty=false}},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheWidth=0;this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){if(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow==="object"){return true}if(this.clipPath){return true}return false},shouldCache:function(){this.ownCaching=this.needsItsOwnCache()||(this.objectCaching&&(!this.group||!this.group.isOnACache()));return this.ownCaching},willDrawShadow:function(){return !!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(l){var n=this.clipPath;l.save();if(n.inverted){l.globalCompositeOperation="destination-out"}else{l.globalCompositeOperation="destination-in"}if(n.absolutePositioned){var k=e.util.invertTransform(this.calcTransformMatrix());l.transform(k[0],k[1],k[2],k[3],k[4],k[5])}n.transform(l);l.scale(1/n.zoomX,1/n.zoomY);l.drawImage(n._cacheCanvas,-n.cacheTranslationX,-n.cacheTranslationY);l.restore()},drawObject:function(l,k){var n=this.fill,m=this.stroke;if(k){this.fill="black";this.stroke="";this._setClippingProperties(l)}else{this._renderBackground(l);this._setStrokeStyles(l,this);this._setFillStyles(l,this)}this._render(l);this._drawClipPath(l);this.fill=n;this.stroke=m},_drawClipPath:function(k){var l=this.clipPath;if(!l){return}l.canvas=this.canvas;l.shouldCache();l._transformDone=true;l.renderCache({forClipping:true});this.drawClipPathOnCache(k)},drawCacheOnCanvas:function(k){k.scale(1/this.zoomX,1/this.zoomY);k.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(l){if(this.isNotVisible()){return false}if(this._cacheCanvas&&!l&&this._updateCacheCanvas()){return true}else{if(this.dirty||(this.clipPath&&this.clipPath.absolutePositioned)||(this.statefullCache&&this.hasStateChanged("cacheProperties"))){if(this._cacheCanvas&&!l){var m=this.cacheWidth/this.zoomX;var k=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-m/2,-k/2,m,k)}return true}}return false},_renderBackground:function(k){if(!this.backgroundColor){return}var l=this._getNonTransformedDimensions();k.fillStyle=this.backgroundColor;k.fillRect(-l.x/2,-l.y/2,l.x,l.y);this._removeShadow(k)},_setOpacity:function(k){if(this.group&&!this.group._transformDone){k.globalAlpha=this.getObjectOpacity()}else{k.globalAlpha*=this.opacity}},_setStrokeStyles:function(l,k){if(k.stroke){l.lineWidth=k.strokeWidth;l.lineCap=k.strokeLineCap;l.lineDashOffset=k.strokeDashOffset;l.lineJoin=k.strokeLineJoin;l.miterLimit=k.strokeMiterLimit;l.strokeStyle=k.stroke.toLive?k.stroke.toLive(l,this):k.stroke}},_setFillStyles:function(l,k){if(k.fill){l.fillStyle=k.fill.toLive?k.fill.toLive(l,this):k.fill}},_setClippingProperties:function(k){k.globalAlpha=1;k.strokeStyle="transparent";k.fillStyle="#000000"},_setLineDash:function(k,l,m){if(!l||l.length===0){return}if(1&l.length){l.push.apply(l,l)}if(j){k.setLineDash(l)}else{m&&m(k)}},_renderControls:function(m,p){var q=this.getViewportTransform(),n=this.calcTransformMatrix(),o,k,l;p=p||{};k=typeof p.hasBorders!=="undefined"?p.hasBorders:this.hasBorders;l=typeof p.hasControls!=="undefined"?p.hasControls:this.hasControls;n=e.util.multiplyTransformMatrices(q,n);o=e.util.qrDecompose(n);m.save();m.translate(o.translateX,o.translateY);m.lineWidth=1*this.borderScaleFactor;if(!this.group){m.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1}if(p.forActiveSelection){m.rotate(c(o.angle));k&&this.drawBordersInGroup(m,o,p)}else{m.rotate(c(this.angle));k&&this.drawBorders(m,p)}l&&this.drawControls(m,p);m.restore()},_setShadow:function(k){if(!this.shadow){return}var p=this.shadow,n=this.canvas,o,m=(n&&n.viewportTransform[0])||1,l=(n&&n.viewportTransform[3])||1;if(p.nonScaling){o={scaleX:1,scaleY:1}}else{o=this.getObjectScaling()}if(n&&n._isRetinaScaling()){m*=e.devicePixelRatio;l*=e.devicePixelRatio}k.shadowColor=p.color;k.shadowBlur=p.blur*e.browserShadowBlurConstant*(m+l)*(o.scaleX+o.scaleY)/4;k.shadowOffsetX=p.offsetX*m*o.scaleX;k.shadowOffsetY=p.offsetY*l*o.scaleY},_removeShadow:function(k){if(!this.shadow){return}k.shadowColor="";k.shadowBlur=k.shadowOffsetX=k.shadowOffsetY=0},_applyPatternGradientTransform:function(l,n){if(!n||!n.toLive){return{offsetX:0,offsetY:0}}var m=n.gradientTransform||n.patternTransform;var k=-this.width/2+n.offsetX||0,o=-this.height/2+n.offsetY||0;if(n.gradientUnits==="percentage"){l.transform(this.width,0,0,this.height,k,o)}else{l.transform(1,0,0,1,k,o)}if(m){l.transform(m[0],m[1],m[2],m[3],m[4],m[5])}return{offsetX:k,offsetY:o}},_renderPaintInOrder:function(k){if(this.paintFirst==="stroke"){this._renderStroke(k);this._renderFill(k)}else{this._renderFill(k);this._renderStroke(k)}},_render:function(){},_renderFill:function(k){if(!this.fill){return}k.save();this._applyPatternGradientTransform(k,this.fill);if(this.fillRule==="evenodd"){k.fill("evenodd")}else{k.fill()}k.restore()},_renderStroke:function(k){if(!this.stroke||this.strokeWidth===0){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(k)}k.save();if(this.strokeUniform){k.scale(1/this.scaleX,1/this.scaleY)}this._setLineDash(k,this.strokeDashArray,this._renderDashedStroke);if(this.stroke.toLive&&this.stroke.gradientUnits==="percentage"){this._applyPatternForTransformedGradient(k,this.stroke)}else{this._applyPatternGradientTransform(k,this.stroke)}k.stroke();k.restore()},_applyPatternForTransformedGradient:function(l,n){var q=this._limitCacheSize(this._getCacheCanvasDimensions()),r=e.util.createCanvasElement(),m,p=this.canvas.getRetinaScaling(),o=q.x/this.scaleX/p,k=q.y/this.scaleY/p;r.width=o;r.height=k;m=r.getContext("2d");m.beginPath();m.moveTo(0,0);m.lineTo(o,0);m.lineTo(o,k);m.lineTo(0,k);m.closePath();m.translate(o/2,k/2);m.scale(q.zoomX/this.scaleX/p,q.zoomY/this.scaleY/p);this._applyPatternGradientTransform(m,n);m.fillStyle=n.toLive(l);m.fill();l.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2);l.scale(p*this.scaleX/q.zoomX,p*this.scaleY/q.zoomY);l.strokeStyle=m.createPattern(r,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var k=e.util.qrDecompose(this.transformMatrix);this.flipX=false;this.flipY=false;this.set("scaleX",k.scaleX);this.set("scaleY",k.scaleY);this.angle=k.angle;this.skewX=k.skewX;this.skewY=0}},_removeTransformMatrix:function(l){var k=this._findCenterFromElement();if(this.transformMatrix){this._assignTransformMatrixProps();k=e.util.transformPoint(k,this.transformMatrix)}this.transformMatrix=null;if(l){this.scaleX*=l.scaleX;this.scaleY*=l.scaleY;this.cropX=l.cropX;this.cropY=l.cropY;k.x+=l.offsetLeft;k.y+=l.offsetTop;this.width=l.width;this.height=l.height}this.setPositionByOrigin(k,"center","center")},clone:function(m,l){var k=this.toObject(l);if(this.constructor.fromObject){this.constructor.fromObject(k,m)}else{e.Object._fromObject("Object",k,m)}},cloneAsImage:function(m,k){var l=this.toCanvasElement(k);if(m){m(new e.Image(l))}return this},toCanvasElement:function(y){y||(y={});var t=e.util,q=t.saveObjectTransform(this),v=this.group,r=this.shadow,z=Math.abs,x=(y.multiplier||1)*(y.enableRetinaScaling?e.devicePixelRatio:1);delete this.group;if(y.withoutTransform){t.resetObjectTransform(this)}if(y.withoutShadow){this.shadow=null}var n=e.util.createCanvasElement(),m=this.getBoundingRect(true,true),u=this.shadow,k,w={x:0,y:0},p;if(u){p=u.blur;if(u.nonScaling){k={scaleX:1,scaleY:1}}else{k=this.getObjectScaling()}w.x=2*Math.round(z(u.offsetX)+p)*(z(k.scaleX));w.y=2*Math.round(z(u.offsetY)+p)*(z(k.scaleY))}n.width=m.width+w.x;n.height=m.height+w.y;n.width+=n.width%2?2-n.width%2:0;n.height+=n.height%2?2-n.height%2:0;var l=new e.StaticCanvas(n,{enableRetinaScaling:false,renderOnAddRemove:false,skipOffscreen:false,});if(y.format==="jpeg"){l.backgroundColor="#fff"}this.setPositionByOrigin(new e.Point(l.width/2,l.height/2),"center","center");var s=this.canvas;l.add(this);var o=l.toCanvasElement(x||1,y);this.shadow=r;this.canvas=s;if(v){this.group=v}this.set(q).setCoords();l._objects=[];l.dispose();l=null;return o},toDataURL:function(k){k||(k={});return e.util.toDataURL(this.toCanvasElement(k),k.format||"png",k.quality||1)},isType:function(k){return this.type===k},complexity:function(){return 1},toJSON:function(k){return this.toObject(k)},setGradient:function(l,k){k||(k={});var m={colorStops:[]};m.type=k.type||(k.r1||k.r2?"radial":"linear");m.coords={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2};m.gradientUnits=k.gradientUnits||"pixels";if(k.r1||k.r2){m.coords.r1=k.r1;m.coords.r2=k.r2}m.gradientTransform=k.gradientTransform;e.Gradient.prototype.addColorStop.call(m,k.colorStops);return this.set(l,e.Gradient.forObject(this,m))},setPatternFill:function(k,l){return this.set("fill",new e.Pattern(k,l))},setShadow:function(k){return this.set("shadow",k?new e.Shadow(k):null)},setColor:function(k){this.set("fill",k);return this},rotate:function(l){var k=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(k){this._setOriginToCenter()}this.set("angle",l);if(k){this._resetOrigin()}return this},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this},center:function(){this.canvas&&this.canvas.centerObject(this);return this},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this},getLocalPointer:function(l,m){m=m||this.canvas.getPointer(l);var k=new e.Point(m.x,m.y),n=this._getLeftTopCoords();if(this.angle){k=e.util.rotatePoint(k,n,c(-this.angle))}return{x:k.x-n.x,y:k.y-n.y}},_setupCompositeOperation:function(k){if(this.globalCompositeOperation){k.globalCompositeOperation=this.globalCompositeOperation}}});e.util.createAccessors&&e.util.createAccessors(e.Object);h(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object._fromObject=function(n,m,o,l){var k=e[n];m=i(m,true);e.util.enlivenPatterns([m.fill,m.stroke],function(p){if(typeof p[0]!=="undefined"){m.fill=p[0]}if(typeof p[1]!=="undefined"){m.stroke=p[1]}e.util.enlivenObjects([m.clipPath],function(r){m.clipPath=r[0];var q=l?new k(m[l],m):new k(m);o&&o(q)})})};e.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.degreesToRadians,c={left:-0.5,center:0,right:0.5},b={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(m,e,d,k,i){var l=m.x,j=m.y,h,f,g;if(typeof e==="string"){e=c[e]}else{e-=0.5}if(typeof k==="string"){k=c[k]}else{k-=0.5}h=k-e;if(typeof d==="string"){d=b[d]}else{d-=0.5}if(typeof i==="string"){i=b[i]}else{i-=0.5}f=i-d;if(h||f){g=this._getTransformedDimensions();l=m.x+h*g.x;j=m.y+f*g.y}return new fabric.Point(l,j)},translateToCenterPoint:function(d,f,e){var g=this.translateToGivenOrigin(d,f,e,"center","center");if(this.angle){return fabric.util.rotatePoint(g,d,a(this.angle))}return g},translateToOriginPoint:function(d,f,e){var g=this.translateToGivenOrigin(d,"center","center",f,e);if(this.angle){return fabric.util.rotatePoint(g,d,a(this.angle))}return g},getCenterPoint:function(){var d=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(d,this.originX,this.originY)},getPointByOrigin:function(f,e){var d=this.getCenterPoint();return this.translateToOriginPoint(d,f,e)},toLocalPoint:function(e,g,f){var d=this.getCenterPoint(),i,h;if(typeof g!=="undefined"&&typeof f!=="undefined"){i=this.translateToGivenOrigin(d,"center","center",g,f)}else{i=new fabric.Point(this.left,this.top)}h=new fabric.Point(e.x,e.y);if(this.angle){h=fabric.util.rotatePoint(h,d,-a(this.angle))}return h.subtractEquals(i)},setPositionByOrigin:function(h,g,f){var e=this.translateToCenterPoint(h,g,f),d=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",d.x);this.set("top",d.y)},adjustPosition:function(j){var i=a(this.angle),g=this.getScaledWidth(),f=fabric.util.cos(i)*g,d=fabric.util.sin(i)*g,h,e;if(typeof this.originX==="string"){h=c[this.originX]}else{h=this.originX-0.5}if(typeof j==="string"){e=c[j]}else{e=j-0.5}this.left+=f*(e-h);this.top+=d*(e-h);this.setCoords();this.originX=j},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var d=this.getCenterPoint();this.originX="center";this.originY="center";this.left=d.x;this.top=d.y},_resetOrigin:function(){var d=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=d.x;this.top=d.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},})})();(function(){function c(e){return[new fabric.Point(e.tl.x,e.tl.y),new fabric.Point(e.tr.x,e.tr.y),new fabric.Point(e.br.x,e.br.y),new fabric.Point(e.bl.x,e.bl.y)]}var a=fabric.util.degreesToRadians,b=fabric.util.multiplyTransformMatrices,d=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(g,e){if(!this.oCoords){this.setCoords()}var f=g?this.aCoords:this.oCoords;return c(e?this.calcCoords(g):f)},intersectsWithRect:function(e,g,j,f){var h=this.getCoords(j,f),i=fabric.Intersection.intersectPolygonRectangle(h,e,g);return i.status==="Intersection"},intersectsWithObject:function(e,h,f){var g=fabric.Intersection.intersectPolygonPolygon(this.getCoords(h,f),e.getCoords(h,f));return g.status==="Intersection"||e.isContainedWithinObject(this,h,f)||this.isContainedWithinObject(e,h,f)},isContainedWithinObject:function(e,k,h){var j=this.getCoords(k,h),g=0,f=e._getImageLines(h?e.calcCoords(k):k?e.aCoords:e.oCoords);for(;g<4;g++){if(!e.containsPoint(j[g],f)){return false}}return true},isContainedWithinRect:function(e,h,i,g){var f=this.getBoundingRect(i,g);return(f.left>=e.x&&f.left+f.width<=h.x&&f.top>=e.y&&f.top+f.height<=h.y)},containsPoint:function(e,g,i,h){var g=g||this._getImageLines(h?this.calcCoords(i):i?this.aCoords:this.oCoords),f=this._findCrossPoints(e,g);return(f!==0&&f%2===1)},isOnScreen:function(j){if(!this.canvas){return false}var f=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;var k=this.getCoords(true,j),e;for(var g=0;g<4;g++){e=k[g];if(e.x<=h.x&&e.x>=f.x&&e.y<=h.y&&e.y>=f.y){return true}}if(this.intersectsWithRect(f,h,true,j)){return true}return this._containsCenterOfCanvas(f,h,j)},_containsCenterOfCanvas:function(e,g,f){var h={x:(e.x+g.x)/2,y:(e.y+g.y)/2};if(this.containsPoint(h,null,true,f)){return true}return false},isPartiallyOnScreen:function(g){if(!this.canvas){return false}var e=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br;if(this.intersectsWithRect(e,f,true,g)){return true}return this._containsCenterOfCanvas(e,f,g)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(l,n){var k,j,f,e,i,h=0,g;for(var m in n){g=n[m];if((g.o.y<l.y)&&(g.d.y<l.y)){continue}if((g.o.y>=l.y)&&(g.d.y>=l.y)){continue}if((g.o.x===g.d.x)&&(g.o.x>=l.x)){i=g.o.x}else{k=0;j=(g.d.y-g.o.y)/(g.d.x-g.o.x);f=l.y-k*l.x;e=g.o.y-j*g.o.x;i=-(f-e)/(k-j)}if(i>=l.x){h+=1}if(h===2){break}}return h},getBoundingRect:function(g,e){var f=this.getCoords(g,e);return fabric.util.makeBoundingBoxFromPoints(f)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){if(Math.abs(e)<this.minScaleLimit){if(e<0){return -this.minScaleLimit}else{return this.minScaleLimit}}else{if(e===0){return 0.0001}}return e},scale:function(e){this._set("scaleX",e);this._set("scaleY",e);return this.setCoords()},scaleToWidth:function(f,g){var e=this.getBoundingRect(g).width/this.getScaledWidth();return this.scale(f/this.width/e)},scaleToHeight:function(f,g){var e=this.getBoundingRect(g).height/this.getScaledHeight();return this.scale(f/this.height/e)},calcCoords:function(D){var g=this._calcRotateMatrix(),r=this._calcTranslateMatrix(),n=b(r,g),F=this.getViewportTransform(),x=D?n:b(F,n),y=this._getTransformedDimensions(),q=y.x/2,A=y.y/2,l=d({x:-q,y:-A},x),i=d({x:q,y:-A},x),j=d({x:-q,y:A},x),E=d({x:q,y:A},x);if(!D){var s=this.padding,C=a(this.angle),k=fabric.util.cos(C),f=fabric.util.sin(C),t=k*s,G=f*s,p=t+G,m=t-G;if(s){l.x-=m;l.y-=p;i.x+=p;i.y-=m;j.x-=p;j.y+=m;E.x+=m;E.y+=p}var B=new fabric.Point((l.x+j.x)/2,(l.y+j.y)/2),u=new fabric.Point((i.x+l.x)/2,(i.y+l.y)/2),v=new fabric.Point((E.x+i.x)/2,(E.y+i.y)/2),e=new fabric.Point((E.x+j.x)/2,(E.y+j.y)/2),o=new fabric.Point(u.x+f*this.rotatingPointOffset,u.y-k*this.rotatingPointOffset)}var z={tl:l,tr:i,br:E,bl:j,};if(!D){z.ml=B;z.mt=u;z.mr=v;z.mb=e;z.mtr=o}return z},setCoords:function(f,e){this.oCoords=this.calcCoords(f);if(!e){this.aCoords=this.calcCoords(true)}f||(this._setCornerCoords&&this._setCornerCoords());return this},_calcRotateMatrix:function(){return fabric.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(f){var e="_",g="";if(!f&&this.group){g=this.group.transformMatrixKey(f)+e}return g+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(h){if(h){return this.calcOwnMatrix()}var g=this.transformMatrixKey(),f=this.matrixCache||(this.matrixCache={});if(f.key===g){return f.value}var e=this.calcOwnMatrix();if(this.group){e=b(this.group.calcTransformMatrix(),e)}f.key=g;f.value=e;return e},calcOwnMatrix:function(){var f=this.transformMatrixKey(true),e=this.ownMatrixCache||(this.ownMatrixCache={});if(e.key===f){return e.value}var g=this._calcTranslateMatrix();this.translateX=g[4];this.translateY=g[5];e.key=f;e.value=fabric.util.composeMatrix(this);return e.value},_calcDimensionsTransformMatrix:function(f,e,g){return fabric.util.calcDimensionsMatrix({skewX:f,skewY:e,scaleX:this.scaleX*(g&&this.flipX?-1:1),scaleY:this.scaleY*(g&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var g=this.strokeWidth,e=this.width+g,f=this.height+g;return{x:e,y:f}},_getTransformedDimensions:function(i,h){if(typeof i==="undefined"){i=this.skewX}if(typeof h==="undefined"){h=this.skewY}var e=this._getNonTransformedDimensions(),m,l,g=i===0&&h===0;if(this.strokeUniform){m=this.width;l=this.height}else{m=e.x;l=e.y}if(g){return this._finalizeDimensions(m*this.scaleX,l*this.scaleY)}else{m/=2;l/=2}var j=[{x:-m,y:-l},{x:m,y:-l},{x:-m,y:l},{x:m,y:l}],f=fabric.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:h,}),k=fabric.util.makeBoundingBoxFromPoints(j,f);return this._finalizeDimensions(k.width,k.height)},_finalizeDimensions:function(f,e){return this.strokeUniform?{x:f+this.strokeWidth,y:e+this.strokeWidth}:{x:f,y:e}},_calculateCurrentDimensions:function(){var g=this.getViewportTransform(),f=this._getTransformedDimensions(),e=fabric.util.transformPoint(f,g,true);return e.scalarAdd(2*this.padding)},})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(a){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a)}else{this.canvas.sendBackwards(this,a)}return this},bringForward:function(a){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a)}else{this.canvas.bringForward(this,a)}return this},moveTo:function(a){if(this.group&&this.group.type!=="activeSelection"){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a)}else{this.canvas.moveTo(this,a)}return this}});(function(){function b(g,e){if(!e){return g+": none; "}else{if(e.toLive){return g+": url(#SVGID_"+e.id+"); "}else{var c=new fabric.Color(e),f=g+": "+c.toRgb()+"; ",d=c.getAlpha();if(d!==1){f+=g+"-opacity: "+d.toString()+"; "}return f}}}var a=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(j){var g=this.fillRule?this.fillRule:"nonzero",l=this.strokeWidth?this.strokeWidth:"0",k=this.strokeDashArray?this.strokeDashArray.join(" "):"none",e=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",h=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",i=typeof this.opacity!=="undefined"?this.opacity:"1",c=this.visible?"":" visibility: hidden;",d=j?"":this.getSvgFilter(),n=b("fill",this.fill),m=b("stroke",this.stroke);return[m,"stroke-width: ",l,"; ","stroke-dasharray: ",k,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",e,"; ","stroke-linejoin: ",h,"; ","stroke-miterlimit: ",f,"; ",n,"fill-rule: ",g,"; ","opacity: ",i,";",d,c].join("")},getSvgSpanStyles:function(c,j){var d="; ";var g=c.fontFamily?"font-family: "+(((c.fontFamily.indexOf("'")===-1&&c.fontFamily.indexOf('"')===-1)?"'"+c.fontFamily+"'":c.fontFamily))+d:"";var i=c.strokeWidth?"stroke-width: "+c.strokeWidth+d:"",g=g,n=c.fontSize?"font-size: "+c.fontSize+"px"+d:"",f=c.fontStyle?"font-style: "+c.fontStyle+d:"",h=c.fontWeight?"font-weight: "+c.fontWeight+d:"",l=c.fill?b("fill",c.fill):"",k=c.stroke?b("stroke",c.stroke):"",m=this.getSvgTextDecoration(c),e=c.deltaY?"baseline-shift: "+(-c.deltaY)+"; ":"";if(m){m="text-decoration: "+m+d}return[k,i,g,n,f,h,m,l,e,j?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(c){if("overline" in c||"underline" in c||"linethrough" in c){return(c.overline?"overline ":"")+(c.underline?"underline ":"")+(c.linethrough?"line-through ":"")}return""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':"",].join("")},getSvgTransform:function(e,c){var d=e?this.calcTransformMatrix():this.calcOwnMatrix(),f='transform="'+fabric.util.matrixToSVG(d);return f+(c||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+fabric.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(d){if(this.backgroundColor){var c=fabric.Object.NUM_FRACTION_DIGITS;d.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,c),'" y="',a(-this.height/2,c),'" width="',a(this.width,c),'" height="',a(this.height,c),'"></rect>\n')}},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(c),{reviver:c})},toClipPathSVG:function(c){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(c),{reviver:c})},_createBaseClipPathSVGMarkup:function(g,f){f=f||{};var c=f.reviver,d=f.additionalTransform||"",h=[this.getSvgTransform(true,d),this.getSvgCommons(),].join(""),e=g.indexOf("COMMON_PARTS");g[e]=h;return c?c(g.join("")):g.join("")},_createBaseSVGMarkup:function(d,s){s=s||{};var i=s.noStyle,l=s.reviver,h=i?"":'style="'+this.getSvgStyles()+'" ',g=s.withShadow?'style="'+this.getSvgFilter()+'" ':"",k=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=k&&k.absolutePositioned,r=this.stroke,q=this.fill,o=this.shadow,n,p=[],e,j=d.indexOf("COMMON_PARTS"),m=s.additionalTransform;if(k){k.clipPathId="CLIPPATH_"+fabric.Object.__uid++;e='<clipPath id="'+k.clipPathId+'" >\n'+k.toClipPathSVG(l)+"</clipPath>\n"}if(f){p.push("<g ",g,this.getSvgCommons()," >\n")}p.push("<g ",this.getSvgTransform(false),!f?g+this.getSvgCommons():""," >\n");n=[h,c,i?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':"",].join("");d[j]=n;if(q&&q.toLive){p.push(q.toSVG(this))}if(r&&r.toLive){p.push(r.toSVG(this))}if(o){p.push(o.toSVG(this))}if(k){p.push(e)}p.push(d.join(""));p.push("</g>\n");f&&p.push("</g>\n");return l?l(p.join("")):p.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})})();(function(){var d=fabric.util.object.extend,a="stateProperties";function c(g,e,h){var i={},f=true;h.forEach(function(j){i[j]=g[j]});d(g[e],i,f)}function b(f,j,l){if(f===j){return true}else{if(Array.isArray(f)){if(!Array.isArray(j)||f.length!==j.length){return false}for(var h=0,e=f.length;h<e;h++){if(!b(f[h],j[h])){return false}}return true}else{if(f&&typeof f==="object"){var k=Object.keys(f),g;if(!j||typeof j!=="object"||(!l&&k.length!==Object.keys(j).length)){return false}for(var h=0,e=k.length;h<e;h++){g=k[h];if(g==="canvas"){continue}if(!b(f[g],j[g])){return false}}return true}}}}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(e){e=e||a;var f="_"+e;if(Object.keys(this[f]).length<this[e].length){return true}return !b(this[f],this,true)},saveState:function(g){var f=g&&g.propertySet||a,e="_"+f;if(!this[e]){return this.setupState(g)}c(this,e,this[f]);if(g&&g.stateProperties){c(this,e,g.stateProperties)}return this},setupState:function(f){f=f||{};var e=f.propertySet||a;f.propertySet=e;this["_"+e]={};this.saveState(f);return this}})})();(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(g){if(!this.hasControls||this.group||(!this.canvas||this.canvas._activeObject!==this)){return false}var f=g.x,d=g.y,c,b;this.__corner=0;for(var e in this.oCoords){if(!this.isControlVisible(e)){continue}if(e==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(e==="mt"||e==="mr"||e==="mb"||e==="ml")){continue}b=this._getImageLines(this.oCoords[e].corner);c=this._findCrossPoints({x:f,y:d},b);if(c!==0&&c%2===1){this.__corner=e;return e}}return false},_setCornerCoords:function(){var h=this.oCoords,f=a(45-this.angle),g=this.cornerSize*0.707106,d=g*fabric.util.cos(f),e=g*fabric.util.sin(f),c,i;for(var b in h){c=h[b].x;i=h[b].y;h[b].corner={tl:{x:c-e,y:i-d},tr:{x:c+d,y:i-e},bl:{x:c-d,y:i+e},br:{x:c+e,y:i+d}}}},drawSelectionBackground:function(d){if(!this.selectionBackgroundColor||(this.canvas&&!this.canvas.interactive)||(this.canvas&&this.canvas._activeObject!==this)){return this}d.save();var b=this.getCenterPoint(),c=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;d.translate(b.x,b.y);d.scale(1/e[0],1/e[3]);d.rotate(a(this.angle));d.fillStyle=this.selectionBackgroundColor;d.fillRect(-c.x/2,-c.y/2,c.x,c.y);d.restore();return this},drawBorders:function(k,i){i=i||{};var b=this._calculateCurrentDimensions(),h=1/this.borderScaleFactor,c=b.x+h,j=b.y+h,f=typeof i.hasRotatingPoint!=="undefined"?i.hasRotatingPoint:this.hasRotatingPoint,d=typeof i.hasControls!=="undefined"?i.hasControls:this.hasControls,g=typeof i.rotatingPointOffset!=="undefined"?i.rotatingPointOffset:this.rotatingPointOffset;k.save();k.strokeStyle=i.borderColor||this.borderColor;this._setLineDash(k,i.borderDashArray||this.borderDashArray,null);k.strokeRect(-c/2,-j/2,c,j);if(f&&this.isControlVisible("mtr")&&d){var e=-j/2;k.beginPath();k.moveTo(0,e);k.lineTo(0,e-g);k.stroke()}k.restore();return this},drawBordersInGroup:function(i,j,g){g=g||{};var c=this._getNonTransformedDimensions(),f=fabric.util.composeMatrix({scaleX:j.scaleX,scaleY:j.scaleY,skewX:j.skewX}),b=fabric.util.transformPoint(c,f),e=1/this.borderScaleFactor,d=b.x+e,h=b.y+e;i.save();this._setLineDash(i,g.borderDashArray||this.borderDashArray,null);i.strokeStyle=g.borderColor||this.borderColor;i.strokeRect(-d/2,-h/2,d,h);i.restore();return this},drawControls:function(k,i){i=i||{};var b=this._calculateCurrentDimensions(),c=b.x,j=b.y,f=i.cornerSize||this.cornerSize,d=-(c+f)/2,g=-(j+f)/2,e=typeof i.transparentCorners!=="undefined"?i.transparentCorners:this.transparentCorners,l=typeof i.hasRotatingPoint!=="undefined"?i.hasRotatingPoint:this.hasRotatingPoint,h=e?"stroke":"fill";k.save();k.strokeStyle=k.fillStyle=i.cornerColor||this.cornerColor;if(!this.transparentCorners){k.strokeStyle=i.cornerStrokeColor||this.cornerStrokeColor}this._setLineDash(k,i.cornerDashArray||this.cornerDashArray,null);this._drawControl("tl",k,h,d,g,i);this._drawControl("tr",k,h,d+c,g,i);this._drawControl("bl",k,h,d,g+j,i);this._drawControl("br",k,h,d+c,g+j,i);if(!this.get("lockUniScaling")){this._drawControl("mt",k,h,d+c/2,g,i);this._drawControl("mb",k,h,d+c/2,g+j,i);this._drawControl("mr",k,h,d+c,g+j/2,i);this._drawControl("ml",k,h,d,g+j/2,i)}if(l){this._drawControl("mtr",k,h,d+c/2,g-this.rotatingPointOffset,i)}k.restore();return this},_drawControl:function(i,b,c,h,g,e){e=e||{};if(!this.isControlVisible(i)){return}var d=this.cornerSize,f=!this.transparentCorners&&this.cornerStrokeColor;switch(e.cornerStyle||this.cornerStyle){case"circle":b.beginPath();b.arc(h+d/2,g+d/2,d/2,0,2*Math.PI,false);b[c]();if(f){b.stroke()}break;default:this.transparentCorners||b.clearRect(h,g,d,d);b[c+"Rect"](h,g,d,d);if(f){b.strokeRect(h,g,d,d)}}},isControlVisible:function(b){return this._getControlsVisibility()[b]},setControlVisible:function(b,c){this._getControlsVisibility()[b]=c;return this},setControlsVisibility:function(b){b||(b={});for(var c in b){this.setControlVisible(c,b[c])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true}}return this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.requestRenderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.requestRenderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(g){b.set("opacity",g);f.requestRenderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var e=[],d,b;for(d in arguments[0]){e.push(d)}for(var c=0,a=e.length;c<a;c++){d=e[c];b=c!==a-1;this._animate(d,arguments[0][d],arguments[1],b)}}else{this._animate.apply(this,arguments)}return this},_animate:function(e,g,c,a){var f=this,b;g=g.toString();if(!c){c={}}else{c=fabric.util.object.clone(c)}if(~e.indexOf(".")){b=e.split(".")}var d=b?this.get(b[0])[b[1]]:this.get(e);if(!("from" in c)){c.from=d}if(~g.indexOf("=")){g=d+parseFloat(g.replace("=",""))}else{g=parseFloat(g)}fabric.util.animate({startValue:c.from,endValue:g,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(j,h,i){if(b){f[b[0]][b[1]]=j}else{f.set(e,j)}if(a){return}c.onChange&&c.onChange(j,h,i)},onComplete:function(j,h,i){if(a){return}f.setCoords();c.onComplete&&c.onComplete(j,h,i)}})}});(function(b){var c=b.fabric||(b.fabric={}),g=c.util.object.extend,f=c.util.object.clone,a={x1:1,x2:1,y1:1,y2:1},d=c.StaticCanvas.supports("setLineDash");if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,h){if(!i){i=[0,0,0,0]}this.callSuper("initialize",h);this.set("x1",i[0]);this.set("y1",i[1]);this.set("x2",i[2]);this.set("y2",i[3]);this._setWidthHeight(h)},_setWidthHeight:function(h){h||(h={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left" in h?h.left:this._getLeftToOriginX();this.top="top" in h?h.top:this._getTopToOriginY()},_set:function(h,i){this.callSuper("_set",h,i);if(typeof a[h]!=="undefined"){this._setWidthHeight()}return this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();if(!this.strokeDashArray||this.strokeDashArray&&d){var i=this.calcLinePoints();h.moveTo(i.x1,i.y1);h.lineTo(i.x2,i.y2)}h.lineWidth=this.strokeWidth;var j=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle;this.stroke&&this._renderStroke(h);h.strokeStyle=j},_renderDashedStroke:function(h){var i=this.calcLinePoints();h.beginPath();c.util.drawDashedLine(h,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray);h.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2,}},toObject:function(h){return g(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");if(this.strokeLineCap==="butt"){if(this.width===0){h.y-=this.strokeWidth}if(this.height===0){h.x-=this.strokeWidth}}return h},calcLinePoints:function(){var m=this.x1<=this.x2?-1:1,l=this.y1<=this.y2?-1:1,i=(m*this.width*0.5),k=(l*this.height*0.5),h=(m*this.width*-0.5),j=(l*this.height*-0.5);return{x1:i,x2:h,y1:k,y2:j}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,'" />\n']},});c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));c.Line.fromElement=function(i,l,h){h=h||{};var k=c.parseAttributes(i,c.Line.ATTRIBUTE_NAMES),j=[k.x1||0,k.y1||0,k.x2||0,k.y2||0];l(new c.Line(j,g(k,h)))};c.Line.fromObject=function(j,k){function h(l){delete l.points;k&&k(l)}var i=f(j,true);i.points=[j.x1,j.y1,j.x2,j.y2];c.Object._fromObject("Line",i,h,"points")};function e(i,n){var l=i.origin,o=i.axis1,m=i.axis2,k=i.dimension,j=n.nearest,h=n.center,p=n.farthest;return function(){switch(this.get(l)){case j:return Math.min(this.get(o),this.get(m));case h:return Math.min(this.get(o),this.get(m))+(0.5*this.get(k));case p:return Math.max(this.get(o),this.get(m))}}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:d*2,cacheProperties:b.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,f){this.callSuper("_set",e,f);if(e==="radius"){this.setRadius(f)}return this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,j=0,i=0,f=(this.endAngle-this.startAngle)%(2*d);if(f===0){e=["<circle ","COMMON_PARTS",'cx="'+j+'" cy="'+i+'" ','r="',this.radius,'" />\n']}else{var h=b.util.cos(this.startAngle)*this.radius,g=b.util.sin(this.startAngle)*this.radius,l=b.util.cos(this.endAngle)*this.radius,k=b.util.sin(this.endAngle)*this.radius,m=f>d?"1":"0";e=['<path d="M '+h+" "+g," A "+this.radius+" "+this.radius," 0 ",+m+" 1"," "+l+" "+k,'" ',"COMMON_PARTS"," />\n"]}return e},_render:function(e){e.beginPath();e.arc(0,0,this.radius,this.startAngle,this.endAngle,false);this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){this.radius=e;return this.set("width",e*2).set("height",e*2)},});b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));b.Circle.fromElement=function(e,g){var f=b.parseAttributes(e,b.Circle.ATTRIBUTE_NAMES);if(!c(f)){throw new Error("value of `r` attribute is required and can not be negative")}f.left=(f.left||0)-f.radius;f.top=(f.top||0)-f.radius;g(new b.Circle(f))};function c(e){return(("radius" in e)&&(e.radius>=0))}b.Circle.fromObject=function(e,f){return b.Object._fromObject("Circle",e,f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",width:100,height:100,_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();this._renderPaintInOrder(c)},_renderDashedStroke:function(c){var d=this.width/2,e=this.height/2;c.beginPath();b.util.drawDashedLine(c,-d,e,0,-e,this.strokeDashArray);b.util.drawDashedLine(c,0,-e,d,e,this.strokeDashArray);b.util.drawDashedLine(c,d,e,-d,e,this.strokeDashArray);c.closePath()},_toSVG:function(){var c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return["<polygon ","COMMON_PARTS",'points="',e,'" />']},});b.Triangle.fromObject=function(c,d){return b.Object._fromObject("Triangle",c,d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d);this.set("rx",d&&d.rx||0);this.set("ry",d&&d.ry||0)},_set:function(d,e){this.callSuper("_set",d,e);switch(d){case"rx":this.rx=e;this.set("width",e*2);break;case"ry":this.ry=e;this.set("height",e*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(d){d.beginPath();d.save();d.transform(1,0,0,this.ry/this.rx,0,0);d.arc(0,0,this.rx,0,c,false);d.restore();this._renderPaintInOrder(d)},});b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));b.Ellipse.fromElement=function(d,f){var e=b.parseAttributes(d,b.Ellipse.ATTRIBUTE_NAMES);e.left=(e.left||0)-e.rx;e.top=(e.top||0)-e.ry;f(new b.Ellipse(e))};b.Ellipse.fromObject=function(d,e){return b.Object._fromObject("Ellipse",d,e)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect){b.warn("fabric.Rect is already defined");return}b.Rect=b.util.createClass(b.Object,{stateProperties:b.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:b.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(n){var e=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,m=this.width,g=this.height,l=-this.width/2,i=-this.height/2,j=e!==0||d!==0,f=1-0.5522847498;n.beginPath();n.moveTo(l+e,i);n.lineTo(l+m-e,i);j&&n.bezierCurveTo(l+m-f*e,i,l+m,i+f*d,l+m,i+d);n.lineTo(l+m,i+g-d);j&&n.bezierCurveTo(l+m,i+g-f*d,l+m-f*e,i+g,l+m-e,i+g);n.lineTo(l+e,i+g);j&&n.bezierCurveTo(l+f*e,i+g,l,i+g-f*d,l,i+g-d);n.lineTo(l,i+d);j&&n.bezierCurveTo(l,i+f*d,l+f*e,i,l+e,i);n.closePath();this._renderPaintInOrder(n)},_renderDashedStroke:function(f){var d=-this.width/2,i=-this.height/2,e=this.width,g=this.height;f.beginPath();b.util.drawDashedLine(f,d,i,d+e,i,this.strokeDashArray);b.util.drawDashedLine(f,d+e,i,d+e,i+g,this.strokeDashArray);b.util.drawDashedLine(f,d+e,i+g,d,i+g,this.strokeDashArray);b.util.drawDashedLine(f,d,i+g,d,i,this.strokeDashArray);f.closePath()},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){var d=-this.width/2,e=-this.height/2;return["<rect ","COMMON_PARTS",'x="',d,'" y="',e,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']},});b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));b.Rect.fromElement=function(e,h,d){if(!e){return h(null)}d=d||{};var g=b.parseAttributes(e,b.Rect.ATTRIBUTE_NAMES);g.left=g.left||0;g.top=g.top||0;g.height=g.height||0;g.width=g.width||0;var f=new b.Rect(c((d?b.util.object.clone(d):{}),g));f.visible=f.visible&&f.width>0&&f.height>0;h(f)};b.Rect.fromObject=function(d,e){return b.Object._fromObject("Rect",d,e)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(h,g){g=g||{};this.points=h||[];this.callSuper("initialize",g);this._setPositionDimensions(g)},_setPositionDimensions:function(i){var h=this._calcDimensions(i),g;this.width=h.width;this.height=h.height;if(!i.fromSVG){g=this.translateToGivenOrigin({x:h.left-this.strokeWidth/2,y:h.top-this.strokeWidth/2},"left","top",this.originX,this.originY)}if(typeof i.left==="undefined"){this.left=i.fromSVG?h.left:g.x}if(typeof i.top==="undefined"){this.top=i.fromSVG?h.top:g.y}this.pathOffset={x:h.left+this.width/2,y:h.top+this.height/2}},_calcDimensions:function(){var j=this.points,h=c(j,"x")||0,m=c(j,"y")||0,l=b(j,"x")||0,k=b(j,"y")||0,i=(l-h),g=(k-m);return{left:h,top:m,width:i,height:g}},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},_toSVG:function(){var m=[],j=this.pathOffset.x,h=this.pathOffset.y,l=e.Object.NUM_FRACTION_DIGITS;for(var k=0,g=this.points.length;k<g;k++){m.push(a(this.points[k].x-j,l),",",a(this.points[k].y-h,l)," ")}return["<"+this.type+" ","COMMON_PARTS",'points="',m.join(""),'" />\n']},commonRender:function(k){var j,h=this.points.length,g=this.pathOffset.x,m=this.pathOffset.y;if(!h||isNaN(this.points[h-1].y)){return false}k.beginPath();k.moveTo(this.points[0].x-g,this.points[0].y-m);for(var l=0;l<h;l++){j=this.points[l];k.lineTo(j.x-g,j.y-m)}return true},_render:function(g){if(!this.commonRender(g)){return}this._renderPaintInOrder(g)},_renderDashedStroke:function(h){var l,k;h.beginPath();for(var j=0,g=this.points.length;j<g;j++){l=this.points[j];k=this.points[j+1]||l;e.util.drawDashedLine(h,l.x,l.y,k.x,k.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polyline.fromElementGenerator=function(g){return function(i,l,h){if(!i){return l(null)}h||(h={});var j=e.parsePointsAttribute(i.getAttribute("points")),k=e.parseAttributes(i,e[g].ATTRIBUTE_NAMES);k.fromSVG=true;l(new e[g](j,f(k,h)))}};e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline");e.Polyline.fromObject=function(g,h){return e.Object._fromObject("Polyline",g,h,"points")}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Polygon){b.warn("fabric.Polygon is already defined");return}b.Polygon=b.util.createClass(b.Polyline,{type:"polygon",_render:function(c){if(!this.commonRender(c)){return}c.closePath();this._renderPaintInOrder(c)},_renderDashedStroke:function(c){this.callSuper("_renderDashedStroke",c);c.closePath()},});b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat();b.Polygon.fromElement=b.Polyline.fromElementGenerator("Polygon");b.Polygon.fromObject=function(c,d){return b.Object._fromObject("Polygon",c,d,"points")}})(typeof exports!=="undefined"?exports:this);(function(a){var d=a.fabric||(a.fabric={}),e=d.util.array.min,h=d.util.array.max,g=d.util.object.extend,c=Object.prototype.toString,j=d.util.drawArc,b=d.util.toFixed,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},f={m:"l",M:"L"};if(d.Path){d.warn("fabric.Path is already defined");return}d.Path=d.util.createClass(d.Object,{type:"path",path:null,cacheProperties:d.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:d.Object.prototype.stateProperties.concat("path"),initialize:function(m,l){l=l||{};this.callSuper("initialize",l);if(!m){m=[]}var k=c.call(m)==="[object Array]";this.path=k?m:m.match&&m.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!k){this.path=this._parsePath()}d.Polyline.prototype._setPositionDimensions.call(this,l)},_renderPathCommands:function(A){var s,q=null,C=0,z=0,v=0,u=0,k=0,B=0,p,o,m=-this.pathOffset.x,w=-this.pathOffset.y;A.beginPath();for(var n=0,r=this.path.length;n<r;++n){s=this.path[n];switch(s[0]){case"l":v+=s[1];u+=s[2];A.lineTo(v+m,u+w);break;case"L":v=s[1];u=s[2];A.lineTo(v+m,u+w);break;case"h":v+=s[1];A.lineTo(v+m,u+w);break;case"H":v=s[1];A.lineTo(v+m,u+w);break;case"v":u+=s[1];A.lineTo(v+m,u+w);break;case"V":u=s[1];A.lineTo(v+m,u+w);break;case"m":v+=s[1];u+=s[2];C=v;z=u;A.moveTo(v+m,u+w);break;case"M":v=s[1];u=s[2];C=v;z=u;A.moveTo(v+m,u+w);break;case"c":p=v+s[5];o=u+s[6];k=v+s[3];B=u+s[4];A.bezierCurveTo(v+s[1]+m,u+s[2]+w,k+m,B+w,p+m,o+w);v=p;u=o;break;case"C":v=s[5];u=s[6];k=s[3];B=s[4];A.bezierCurveTo(s[1]+m,s[2]+w,k+m,B+w,v+m,u+w);break;case"s":p=v+s[3];o=u+s[4];if(q[0].match(/[CcSs]/)===null){k=v;B=u}else{k=2*v-k;B=2*u-B}A.bezierCurveTo(k+m,B+w,v+s[1]+m,u+s[2]+w,p+m,o+w);k=v+s[1];B=u+s[2];v=p;u=o;break;case"S":p=s[3];o=s[4];if(q[0].match(/[CcSs]/)===null){k=v;B=u}else{k=2*v-k;B=2*u-B}A.bezierCurveTo(k+m,B+w,s[1]+m,s[2]+w,p+m,o+w);v=p;u=o;k=s[1];B=s[2];break;case"q":p=v+s[3];o=u+s[4];k=v+s[1];B=u+s[2];A.quadraticCurveTo(k+m,B+w,p+m,o+w);v=p;u=o;break;case"Q":p=s[3];o=s[4];A.quadraticCurveTo(s[1]+m,s[2]+w,p+m,o+w);v=p;u=o;k=s[1];B=s[2];break;case"t":p=v+s[1];o=u+s[2];if(q[0].match(/[QqTt]/)===null){k=v;B=u}else{k=2*v-k;B=2*u-B}A.quadraticCurveTo(k+m,B+w,p+m,o+w);v=p;u=o;break;case"T":p=s[1];o=s[2];if(q[0].match(/[QqTt]/)===null){k=v;B=u}else{k=2*v-k;B=2*u-B}A.quadraticCurveTo(k+m,B+w,p+m,o+w);v=p;u=o;break;case"a":j(A,v+m,u+w,[s[1],s[2],s[3],s[4],s[5],s[6]+v+m,s[7]+u+w]);v+=s[6];u+=s[7];break;case"A":j(A,v+m,u+w,[s[1],s[2],s[3],s[4],s[5],s[6]+m,s[7]+w]);v=s[6];u=s[7];break;case"z":case"Z":v=C;u=z;A.closePath();break}q=s}},_render:function(k){this._renderPathCommands(k);this._renderPaintInOrder(k)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(k){return g(this.callSuper("toObject",k),{path:this.path.map(function(l){return l.slice()}),})},toDatalessObject:function(l){var k=this.toObject(["sourcePath"].concat(l));if(k.sourcePath){delete k.path}return k},_toSVG:function(){var k=this.path.map(function(l){return l.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',k,'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var k=d.Object.NUM_FRACTION_DIGITS;return" translate("+b(-this.pathOffset.x,k)+", "+b(-this.pathOffset.y,k)+")"},toClipPathSVG:function(k){var l=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:k,additionalTransform:l})},toSVG:function(k){var l=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:k,additionalTransform:l})},complexity:function(){return this.path.length},_parsePath:function(){var B=[],w=[],x,u,z=d.rePathCommand,r,l;for(var p=0,v,s=this.path.length;p<s;p++){x=this.path[p];l=x.slice(1).trim();w.length=0;while((r=z.exec(l))){w.push(r[0])}v=[x.charAt(0)];for(var o=0,y=w.length;o<y;o++){u=parseFloat(w[o]);if(!isNaN(u)){v.push(u)}}var n=v[0],A=i[n.toLowerCase()],q=f[n]||n;if(v.length-1>A){for(var m=1,t=v.length;m<t;m+=A){B.push([n].concat(v.slice(m,m+A)));n=q}}else{B.push(v)}}return B},_calcDimensions:function(){var o=[],l=[],u,n=null,A=0,z=0,t=0,s=0,m=0,k=0,q,p,r;for(var v=0,w=this.path.length;v<w;++v){u=this.path[v];switch(u[0]){case"l":t+=u[1];s+=u[2];r=[];break;case"L":t=u[1];s=u[2];r=[];break;case"h":t+=u[1];r=[];break;case"H":t=u[1];r=[];break;case"v":s+=u[1];r=[];break;case"V":s=u[1];r=[];break;case"m":t+=u[1];s+=u[2];A=t;z=s;r=[];break;case"M":t=u[1];s=u[2];A=t;z=s;r=[];break;case"c":q=t+u[5];p=s+u[6];m=t+u[3];k=s+u[4];r=d.util.getBoundsOfCurve(t,s,t+u[1],s+u[2],m,k,q,p);t=q;s=p;break;case"C":m=u[3];k=u[4];r=d.util.getBoundsOfCurve(t,s,u[1],u[2],m,k,u[5],u[6]);t=u[5];s=u[6];break;case"s":q=t+u[3];p=s+u[4];if(n[0].match(/[CcSs]/)===null){m=t;k=s}else{m=2*t-m;k=2*s-k}r=d.util.getBoundsOfCurve(t,s,m,k,t+u[1],s+u[2],q,p);m=t+u[1];k=s+u[2];t=q;s=p;break;case"S":q=u[3];p=u[4];if(n[0].match(/[CcSs]/)===null){m=t;k=s}else{m=2*t-m;k=2*s-k}r=d.util.getBoundsOfCurve(t,s,m,k,u[1],u[2],q,p);t=q;s=p;m=u[1];k=u[2];break;case"q":q=t+u[3];p=s+u[4];m=t+u[1];k=s+u[2];r=d.util.getBoundsOfCurve(t,s,m,k,m,k,q,p);t=q;s=p;break;case"Q":m=u[1];k=u[2];r=d.util.getBoundsOfCurve(t,s,m,k,m,k,u[3],u[4]);t=u[3];s=u[4];break;case"t":q=t+u[1];p=s+u[2];if(n[0].match(/[QqTt]/)===null){m=t;k=s}else{m=2*t-m;k=2*s-k}r=d.util.getBoundsOfCurve(t,s,m,k,m,k,q,p);t=q;s=p;break;case"T":q=u[1];p=u[2];if(n[0].match(/[QqTt]/)===null){m=t;k=s}else{m=2*t-m;k=2*s-k}r=d.util.getBoundsOfCurve(t,s,m,k,m,k,q,p);t=q;s=p;break;case"a":r=d.util.getBoundsOfArc(t,s,u[1],u[2],u[3],u[4],u[5],u[6]+t,u[7]+s);t+=u[6];s+=u[7];break;case"A":r=d.util.getBoundsOfArc(t,s,u[1],u[2],u[3],u[4],u[5],u[6],u[7]);t=u[6];s=u[7];break;case"z":case"Z":t=A;s=z;break}n=u;r.forEach(function(x){o.push(x.x);l.push(x.y)});o.push(t);l.push(s)}var E=e(o)||0,D=e(l)||0,C=h(o)||0,B=h(l)||0,G=C-E,F=B-D;return{left:E,top:D,width:G,height:F}}});d.Path.fromObject=function(k,m){if(typeof k.sourcePath==="string"){var l=k.sourcePath;d.loadSVGFromURL(l,function(n){var o=n[0];o.setOptions(k);m&&m(o)})}else{d.Object._fromObject("Path",k,m,"path")}};d.Path.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["d"]);d.Path.fromElement=function(l,n,k){var m=d.parseAttributes(l,d.Path.ATTRIBUTE_NAMES);m.fromSVG=true;n(new d.Path(m.d,g(m,k)))}})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),b=d.util.array.min,a=d.util.array.max;if(d.Group){return}d.Group=d.util.createClass(d.Object,d.Collection,{type:"group",strokeWidth:0,subTargetCheck:false,cacheProperties:[],useSetOnGroup:false,initialize:function(h,f,j){f=f||{};this._objects=[];j&&this.callSuper("initialize",f);this._objects=h||[];for(var g=this._objects.length;g--;){this._objects[g].group=this}if(!j){var e=f&&f.centerPoint;if(f.originX!==undefined){this.originX=f.originX}if(f.originY!==undefined){this.originY=f.originY}e||this._calcBounds();this._updateObjectsCoords(e);delete f.centerPoint;this.callSuper("initialize",f)}else{this._updateObjectsACoords()}this.setCoords()},_updateObjectsACoords:function(){var g=true,f=true;for(var e=this._objects.length;e--;){this._objects[e].setCoords(g,f)}},_updateObjectsCoords:function(e){var e=e||this.getCenterPoint();for(var f=this._objects.length;f--;){this._updateObjectCoords(this._objects[f],e)}},_updateObjectCoords:function(f,e){var i=f.left,j=f.top,h=true,g=true;f.set({left:i-e.x,top:j-e.y});f.group=this;f.setCoords(h,g)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){this._restoreObjectsState();d.util.resetObjectTransform(this);if(e){this._objects.push(e);e.group=this;e._set("canvas",this.canvas)}this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this},removeWithUpdate:function(e){this._restoreObjectsState();d.util.resetObjectTransform(this);this.remove(e);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this},_onObjectAdded:function(e){this.dirty=true;e.group=this;e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=true;delete e.group},_set:function(f,g){var e=this._objects.length;if(this.useSetOnGroup){while(e--){this._objects[e].setOnGroup(f,g)}}if(f==="canvas"){while(e--){this._objects[e]._set(f,g)}}d.Object.prototype._set.call(this,f,g)},toObject:function(h){var e=this.includeDefaultValues;var g=this._objects.map(function(j){var i=j.includeDefaultValues;j.includeDefaultValues=e;var k=j.toObject(h);j.includeDefaultValues=i;return k});var f=d.Object.prototype.toObject.call(this,h);f.objects=g;return f},toDatalessObject:function(i){var h,f=this.sourcePath;if(f){h=f}else{var e=this.includeDefaultValues;h=this._objects.map(function(k){var j=k.includeDefaultValues;k.includeDefaultValues=e;var l=k.toDatalessObject(i);k.includeDefaultValues=j;return l})}var g=d.Object.prototype.toDatalessObject.call(this,i);g.objects=h;return g},render:function(e){this._transformDone=true;this.callSuper("render",e);this._transformDone=false},shouldCache:function(){var g=d.Object.prototype.shouldCache.call(this);if(g){for(var f=0,e=this._objects.length;f<e;f++){if(this._objects[f].willDrawShadow()){this.ownCaching=false;return false}}}return g},willDrawShadow:function(){if(this.shadow){return d.Object.prototype.willDrawShadow.call(this)}for(var f=0,e=this._objects.length;f<e;f++){if(this._objects[f].willDrawShadow()){return true}}return false},isOnACache:function(){return this.ownCaching||(this.group&&this.group.isOnACache())},drawObject:function(f){for(var g=0,e=this._objects.length;g<e;g++){this._objects[g].render(f)}this._drawClipPath(f)},isCacheDirty:function(g){if(this.callSuper("isCacheDirty",g)){return true}if(!this.statefullCache){return false}for(var h=0,f=this._objects.length;h<f;h++){if(this._objects[h].isCacheDirty(true)){if(this._cacheCanvas){var e=this.cacheWidth/this.zoomX,j=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-j/2,e,j)}return true}}return false},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(h){var f=h.calcTransformMatrix(),g=d.util.qrDecompose(f),e=new d.Point(g.translateX,g.translateY);h.flipX=false;h.flipY=false;h.set("scaleX",g.scaleX);h.set("scaleY",g.scaleY);h.skewX=g.skewX;h.skewY=g.skewY;h.angle=g.angle;h.setPositionByOrigin(e,"center","center");return h},_restoreObjectState:function(e){this.realizeTransform(e);e.setCoords();delete e.group;return this},destroy:function(){this._objects.forEach(function(e){e.set("dirty",true)});return this._restoreObjectsState()},toActiveSelection:function(){if(!this.canvas){return}var g=this._objects,f=this.canvas;this._objects=[];var e=this.toObject();delete e.objects;var h=new d.ActiveSelection([]);h.set(e);h.type="activeSelection";f.remove(this);g.forEach(function(i){i.group=h;i.dirty=true;f.add(i)});h.canvas=f;h._objects=g;f._activeObject=h;h.setCoords();return h},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var f=true,e=true;this.forEachObject(function(g){g.setCoords(f,e)});return this},_calcBounds:function(h){var m=[],l=[],f,e,q=["tr","br","bl","tl"],n=0,g=this._objects.length,k,r=q.length,p=true;for(;n<g;++n){f=this._objects[n];f.setCoords(p);for(k=0;k<r;k++){e=q[k];m.push(f.oCoords[e].x);l.push(f.oCoords[e].y)}}this._getBounds(m,l,h)},_getBounds:function(i,h,f){var j=new d.Point(b(i),b(h)),l=new d.Point(a(i),a(h)),k=j.y||0,g=j.x||0,e=(l.x-j.x)||0,m=(l.y-j.y)||0;this.width=e;this.height=m;if(!f){this.setPositionByOrigin({x:g,y:k},"left","top")}},_toSVG:function(f){var h=["<g ","COMMON_PARTS"," >\n"];for(var g=0,e=this._objects.length;g<e;g++){h.push("\t\t",this._objects[g].toSVG(f))}h.push("</g>\n");return h},getSvgStyles:function(){var f=typeof this.opacity!=="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",e=this.visible?"":" visibility: hidden;";return[f,this.getSvgFilter(),e].join("")},toClipPathSVG:function(f){var h=[];for(var g=0,e=this._objects.length;g<e;g++){h.push("\t",this._objects[g].toClipPathSVG(f))}return this._createBaseClipPathSVGMarkup(h,{reviver:f})},});d.Group.fromObject=function(f,h){var g=f.objects,e=d.util.object.clone(f,true);delete e.objects;if(typeof g==="string"){d.loadSVGFromURL(g,function(i){var j=d.util.groupSVGElements(i,f,g);j.set(e);h&&h(j)});return}d.util.enlivenObjects(g,function(i){d.util.enlivenObjects([f.clipPath],function(j){var k=d.util.object.clone(f,true);k.clipPath=j[0];delete k.objects;h&&h(new d.Group(i,k,true))})})}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.ActiveSelection){return}b.ActiveSelection=b.util.createClass(b.Group,{type:"activeSelection",initialize:function(e,c){c=c||{};this._objects=e||[];for(var d=this._objects.length;d--;){this._objects[d].group=this}if(c.originX){this.originX=c.originX}if(c.originY){this.originY=c.originY}this._calcBounds();this._updateObjectsCoords();b.Object.prototype.initialize.call(this,c);this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var d=b.Object.prototype.toObject.call(this);var f=new b.Group([]);delete d.type;f.set(d);e.forEach(function(g){g.canvas.remove(g);g.group=f});f._objects=e;if(!this.canvas){return f}var c=this.canvas;c.add(f);c._activeObject=f;f.setCoords();return f},onDeselect:function(){this.destroy();return false},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return false},isOnACache:function(){return false},_renderControls:function(d,g,f){d.save();d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper("_renderControls",d,g);f=f||{};if(typeof f.hasControls==="undefined"){f.hasControls=false}if(typeof f.hasRotatingPoint==="undefined"){f.hasRotatingPoint=false}f.forActiveSelection=true;for(var e=0,c=this._objects.length;e<c;e++){this._objects[e]._renderControls(d,f)}d.restore()},});b.ActiveSelection.fromObject=function(c,d){b.util.enlivenObjects(c.objects,function(e){delete c.objects;d&&d(new b.ActiveSelection(e,c,true))})}})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:false,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:0.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(d,c){c||(c={});this.filters=[];this.cacheKey="texture"+fabric.Object.__uid++;this.callSuper("initialize",c);this._initElement(d,c)},getElement:function(){return this._element||{}},setElement:function(d,c){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+"_filtered");this._element=d;this._originalElement=d;this._initConfig(c);if(this.filters.length!==0){this.applyFilters()}if(this.resizeFilter){this.applyResizeFilters()}return this},removeTexture:function(d){var c=fabric.filterBackend;if(c&&c.evictCachesForKey){c.evictCachesForKey(d)}},dispose:function(){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+"_filtered");this._cacheContext=undefined;["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(c){fabric.util.cleanUpJsdomNode(this[c]);this[c]=undefined}).bind(this))},setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},getOriginalSize:function(){var c=this.getElement();return{width:c.naturalWidth||c.width,height:c.naturalHeight||c.height}},_stroke:function(d){if(!this.stroke||this.strokeWidth===0){return}var c=this.width/2,e=this.height/2;d.beginPath();d.moveTo(-c,-e);d.lineTo(c,-e);d.lineTo(c,e);d.lineTo(-c,e);d.lineTo(-c,-e);d.closePath()},_renderDashedStroke:function(e){var c=-this.width/2,g=-this.height/2,d=this.width,f=this.height;e.save();this._setStrokeStyles(e,this);e.beginPath();fabric.util.drawDashedLine(e,c,g,c+d,g,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g,c+d,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g+f,c,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c,g+f,c,g,this.strokeDashArray);e.closePath();e.restore()},toObject:function(e){var d=[];this.filters.forEach(function(f){if(f){d.push(f.toObject())}});var c=b(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(e)),{src:this.getSrc(),filters:d,});if(this.resizeFilter){c.resizeFilter=this.resizeFilter.toObject()}return c},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var f=[],e=[],i,c=-this.width/2,j=-this.height/2,g="";if(this.hasCrop()){var d=fabric.Object.__uid++;f.push('<clipPath id="imageCrop_'+d+'">\n','\t<rect x="'+c+'" y="'+j+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n");g=' clip-path="url(#imageCrop_'+d+')" '}e.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(true),'" x="',c-this.cropX,'" y="',j-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',g,"></image>\n");if(this.stroke||this.strokeDashArray){var h=this.fill;this.fill=null;i=["\t<rect ",'x="',c,'" y="',j,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'];this.fill=h}if(this.paintFirst!=="fill"){f=f.concat(i,e)}else{f=f.concat(e,i)}return f},getSrc:function(c){var d=c?this._element:this._originalElement;if(d){if(d.toDataURL){return d.toDataURL()}if(this.srcFromAttribute){return d.getAttribute("src")}else{return d.src}}else{return this.src||""}},setSrc:function(d,e,c){fabric.util.loadImage(d,function(f){this.setElement(f,c);this._setWidthHeight();e&&e(this)},this,c&&c.crossOrigin);return this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,c=this.minimumScaleTrigger,h=this.getTotalObjectScaling(),l=h.scaleX,k=h.scaleY,i=this._filteredEl||this._originalElement;if(this.group){this.set("dirty",true)}if(!e||(l>c&&k>c)){this._element=i;this._filterScalingX=1;this._filterScalingY=1;this._lastScaleX=l;this._lastScaleY=k;return}if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend()}var g=fabric.util.createCanvasElement(),j=this._filteredEl?(this.cacheKey+"_filtered"):this.cacheKey,d=i.width,f=i.height;g.width=d;g.height=f;this._element=g;this._lastScaleX=e.scaleX=l;this._lastScaleY=e.scaleY=k;fabric.filterBackend.applyFilters([e],i,d,f,this._element,j);this._filterScalingX=g.width/this._originalElement.width;this._filterScalingY=g.height/this._originalElement.height},applyFilters:function(e){e=e||this.filters||[];e=e.filter(function(h){return h&&!h.isNeutralState()});this.set("dirty",true);this.removeTexture(this.cacheKey+"_filtered");if(e.length===0){this._element=this._originalElement;this._filteredEl=null;this._filterScalingX=1;this._filterScalingY=1;return this}var g=this._originalElement,c=g.naturalWidth||g.width,f=g.naturalHeight||g.height;if(this._element===this._originalElement){var d=fabric.util.createCanvasElement();d.width=c;d.height=f;this._element=d;this._filteredEl=d}else{this._element=this._filteredEl;this._filteredEl.getContext("2d").clearRect(0,0,c,f);this._lastScaleX=1;this._lastScaleY=1}if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend()}fabric.filterBackend.applyFilters(e,this._originalElement,c,f,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height){this._filterScalingX=this._element.width/this._originalElement.width;this._filterScalingY=this._element.height/this._originalElement.height}return this},_render:function(c){if(this.isMoving!==true&&this.resizeFilter&&this._needsResize()){this.applyResizeFilters()}this._stroke(c);this._renderPaintInOrder(c)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(m){var i=this._element,k=this.width,f=this.height,e=Math.min(i.naturalWidth||i.width,k*this._filterScalingX),l=Math.min(i.naturalHeight||i.height,f*this._filterScalingY),j=-k/2,g=-f/2,d=Math.max(0,this.cropX*this._filterScalingX),c=Math.max(0,this.cropY*this._filterScalingY);i&&m.drawImage(i,d,c,e,l,j,g,k,f)},_needsResize:function(){var c=this.getTotalObjectScaling();return(c.scaleX!==this._lastScaleX||c.scaleY!==this._lastScaleY)},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(d,c){this.setElement(fabric.util.getById(d),c);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c);if(this._element&&this.crossOrigin){this._element.crossOrigin=this.crossOrigin}},_initFilters:function(c,d){if(c&&c.length){fabric.util.enlivenObjects(c,function(e){d&&d(e)},"fabric.Image.filters")}else{d&&d()}},_setWidthHeight:function(c){c||(c={});var d=this.getElement();this.width=c.width||d.naturalWidth||d.width||0;this.height=c.height||d.naturalHeight||d.height||0},parsePreserveAspectRatioAttribute:function(){var c=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),k=this._element.width,o=this._element.height,l=1,i=1,f=0,d=0,n=0,m=0,g,e=this.width,j=this.height,h={width:e,height:j};if(c&&(c.alignX!=="none"||c.alignY!=="none")){if(c.meetOrSlice==="meet"){l=i=fabric.util.findScaleToFit(this._element,h);g=(e-k*l)/2;if(c.alignX==="Min"){f=-g}if(c.alignX==="Max"){f=g}g=(j-o*i)/2;if(c.alignY==="Min"){d=-g}if(c.alignY==="Max"){d=g}}if(c.meetOrSlice==="slice"){l=i=fabric.util.findScaleToCover(this._element,h);g=k-e/l;if(c.alignX==="Mid"){n=g/2}if(c.alignX==="Max"){n=g}g=o-j/i;if(c.alignY==="Mid"){m=g/2}if(c.alignY==="Max"){m=g}k=e/l;o=j/i}}else{l=e/k;i=j/o}return{width:k,height:o,scaleX:l,scaleY:i,offsetLeft:f,offsetTop:d,cropX:n,cropY:m}}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(d,e){var c=fabric.util.object.clone(d);fabric.util.loadImage(c.src,function(f,g){if(g){e&&e(null,g);return}fabric.Image.prototype._initFilters.call(c,c.filters,function(h){c.filters=h||[];fabric.Image.prototype._initFilters.call(c,[c.resizeFilter],function(i){c.resizeFilter=i[0];fabric.util.enlivenObjects([c.clipPath],function(j){c.clipPath=j[0];var k=new fabric.Image(f,c);e(k)})})})},null,c.crossOrigin)};fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f){e&&e(new fabric.Image(f,d))},null,d&&d.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" "));fabric.Image.fromElement=function(d,f,c){var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],f,b((c?fabric.util.object.clone(c):{}),e))}})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;if(a>0){return Math.round((a-1)/90)*90}return Math.round(a/90)*90},straighten:function(){this.rotate(this._getAngleValueForStraighten());return this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.rotate(f);a()},onComplete:function(){e.setCoords();d()},});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.requestRenderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.requestRenderAllBound});return this}});(function(){function a(f,d){var e="precision "+d+" float;\nvoid main(){}";var c=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(c,e);f.compileShader(c);if(!f.getShaderParameter(c,f.COMPILE_STATUS)){return false}return true}fabric.isWebglSupported=function(g){if(fabric.isLikelyNode){return false}g=g||fabric.WebglFilterBackend.prototype.tileSize;var d=document.createElement("canvas");var h=d.getContext("webgl")||d.getContext("experimental-webgl");var f=false;if(h){fabric.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE);f=fabric.maxTextureSize>=g;var c=["highp","mediump","lowp"];for(var e=0;e<3;e++){if(a(h,c[e])){fabric.webGlPrecision=c[e];break}}}this.isSupported=f;return f};fabric.WebglFilterBackend=b;function b(c){if(c&&c.tileSize){this.tileSize=c.tileSize}this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo()}b.prototype={tileSize:2048,resources:{},setupGLContext:function(d,c){this.dispose();this.createWebGLCanvas(d,c);this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(d,c)},chooseFastestCopyGLTo2DMethod:function(c,o){var n=typeof window.performance!=="undefined",i;try{new ImageData(1,1);i=true}catch(g){i=false}var f=typeof ArrayBuffer!=="undefined";var j=typeof Uint8ClampedArray!=="undefined";if(!(n&&i&&f&&j)){return}var k=fabric.util.createCanvasElement();var p=new ArrayBuffer(c*o*4);if(fabric.forceGLPutImageData){this.imageBuffer=p;this.copyGLTo2D=copyGLTo2DPutImageData;return}var m={imageBuffer:p,destinationWidth:c,destinationHeight:o,targetCanvas:k};var d,h,l;k.width=c;k.height=o;d=window.performance.now();copyGLTo2DDrawImage.call(m,this.gl,m);h=window.performance.now()-d;d=window.performance.now();copyGLTo2DPutImageData.call(m,this.gl,m);l=window.performance.now()-d;if(h>l){this.imageBuffer=p;this.copyGLTo2D=copyGLTo2DPutImageData}else{this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(f,d){var e=fabric.util.createCanvasElement();e.width=f;e.height=d;var c={alpha:true,premultipliedAlpha:false,depth:false,stencil:false,antialias:false},g=e.getContext("webgl",c);if(!g){g=e.getContext("experimental-webgl",c)}if(!g){return}g.clearColor(0,0,0,0);this.canvas=e;this.gl=g},applyFilters:function(f,c,d,l,k,j){var g=this.gl;var i;if(j){i=this.getCachedTexture(j,c)}var e={originalWidth:c.width||c.originalWidth,originalHeight:c.height||c.originalHeight,sourceWidth:d,sourceHeight:l,destinationWidth:d,destinationHeight:l,context:g,sourceTexture:this.createTexture(g,d,l,!i&&c),targetTexture:this.createTexture(g,d,l),originalTexture:i||this.createTexture(g,d,l,!i&&c),passes:f.length,webgl:true,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:k};var h=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,h);f.forEach(function(m){m&&m.applyTo(e)});resizeCanvasIfNeeded(e);this.copyGLTo2D(g,e);g.bindTexture(g.TEXTURE_2D,null);g.deleteTexture(e.sourceTexture);g.deleteTexture(e.targetTexture);g.deleteFramebuffer(h);k.getContext("2d").setTransform(1,0,0,1,0,0);return e},dispose:function(){if(this.canvas){this.canvas=null;this.gl=null}this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={};this.textureCache={}},createTexture:function(f,d,c,g){var e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);if(g){f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,g)}else{f.texImage2D(f.TEXTURE_2D,0,f.RGBA,d,c,0,f.RGBA,f.UNSIGNED_BYTE,null)}return e},getCachedTexture:function(e,d){if(this.textureCache[e]){return this.textureCache[e]}else{var c=this.createTexture(this.gl,d.width,d.height,d);this.textureCache[e]=c;return c}},evictCachesForKey:function(c){if(this.textureCache[c]){this.gl.deleteTexture(this.textureCache[c]);delete this.textureCache[c]}},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo){return this.gpuInfo}var f=this.gl,e={renderer:"",vendor:""};if(!f){return e}var c=f.getExtension("WEBGL_debug_renderer_info");if(c){var d=f.getParameter(c.UNMASKED_RENDERER_WEBGL);var g=f.getParameter(c.UNMASKED_VENDOR_WEBGL);if(d){e.renderer=d.toLowerCase()}if(g){e.vendor=g.toLowerCase()}}this.gpuInfo=e;return e},}})();function resizeCanvasIfNeeded(d){var c=d.targetCanvas,e=c.width,a=c.height,b=d.destinationWidth,f=d.destinationHeight;if(e!==b||a!==f){c.width=b;c.height=f}}function copyGLTo2DDrawImage(f,d){var c=f.canvas,b=d.targetCanvas,a=b.getContext("2d");a.translate(0,b.height);a.scale(1,-1);var e=c.height-b.height;a.drawImage(c,0,e,b.width,b.height,0,0,b.width,b.height)}function copyGLTo2DPutImageData(f,d){var h=d.targetCanvas,j=h.getContext("2d"),g=d.destinationWidth,e=d.destinationHeight,a=g*e*4;var i=new Uint8Array(this.imageBuffer,0,a);var c=new Uint8ClampedArray(this.imageBuffer,0,a);f.readPixels(0,0,g,e,f.RGBA,f.UNSIGNED_BYTE,i);var b=new ImageData(c,g,e);j.putImageData(b,0,0)}(function(){var a=function(){};fabric.Canvas2dFilterBackend=b;function b(){}b.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(g,d,e,i,j){var k=j.getContext("2d");k.drawImage(d,0,0,e,i);var c=k.getImageData(0,0,e,i);var h=k.getImageData(0,0,e,i);var f={sourceWidth:e,sourceHeight:i,imageData:c,originalEl:d,originalImageData:h,canvasEl:j,ctx:k,filterBackend:this,};g.forEach(function(l){l.applyTo(f)});if(f.imageData.width!==e||f.imageData.height!==i){j.width=f.imageData.width;j.height=f.imageData.height}k.putImageData(f.imageData,0,0);return f},}})();fabric.Image=fabric.Image||{};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(a){if(a){this.setOptions(a)}},setOptions:function(a){for(var b in a){this[b]=a[b]}},createProgram:function(g,d,h){d=d||this.fragmentSource;h=h||this.vertexSource;if(fabric.webGlPrecision!=="highp"){d=d.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float")}var f=g.createShader(g.VERTEX_SHADER);g.shaderSource(f,h);g.compileShader(f);if(!g.getShaderParameter(f,g.COMPILE_STATUS)){throw new Error("Vertex shader compile error for "+this.type+": "+g.getShaderInfoLog(f))}var b=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(b,d);g.compileShader(b);if(!g.getShaderParameter(b,g.COMPILE_STATUS)){throw new Error("Fragment shader compile error for "+this.type+": "+g.getShaderInfoLog(b))}var c=g.createProgram();g.attachShader(c,f);g.attachShader(c,b);g.linkProgram(c);if(!g.getProgramParameter(c,g.LINK_STATUS)){throw new Error('Shader link error for "${this.type}" '+g.getProgramInfoLog(c))}var a=this.getAttributeLocations(g,c);var e=this.getUniformLocations(g,c)||{};e.uStepW=g.getUniformLocation(c,"uStepW");e.uStepH=g.getUniformLocation(c,"uStepH");return{program:c,attributeLocations:a,uniformLocations:e}},getAttributeLocations:function(b,a){return{aPosition:b.getAttribLocation(a,"aPosition"),}},getUniformLocations:function(){return{}},sendAttributeData:function(e,b,d){var c=b.aPosition;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a);e.enableVertexAttribArray(c);e.vertexAttribPointer(c,2,e.FLOAT,false,0,0);e.bufferData(e.ARRAY_BUFFER,d,e.STATIC_DRAW)},_setupFrameBuffer:function(b){var d=b.context,c,a;if(b.passes>1){c=b.destinationWidth;a=b.destinationHeight;if(b.sourceWidth!==c||b.sourceHeight!==a){d.deleteTexture(b.targetTexture);b.targetTexture=b.filterBackend.createTexture(d,c,a)}d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,b.targetTexture,0)}else{d.bindFramebuffer(d.FRAMEBUFFER,null);d.finish()}},_swapTextures:function(b){b.passes--;b.pass++;var a=b.targetTexture;b.targetTexture=b.sourceTexture;b.sourceTexture=a},isNeutralState:function(){var a=this.mainParameter,b=fabric.Image.filters[this.type].prototype;if(a){if(Array.isArray(b[a])){for(var c=b[a].length;c--;){if(this[a][c]!==b[a][c]){return false}}return true}else{return b[a]===this[a]}}else{return false}},applyTo:function(a){if(a.webgl){this._setupFrameBuffer(a);this.applyToWebGL(a);this._swapTextures(a)}else{this.applyTo2d(a)}},retrieveShader:function(a){if(!a.programCache.hasOwnProperty(this.type)){a.programCache[this.type]=this.createProgram(a.context)}return a.programCache[this.type]},applyToWebGL:function(a){var c=a.context;var b=this.retrieveShader(a);if(a.pass===0&&a.originalTexture){c.bindTexture(c.TEXTURE_2D,a.originalTexture)}else{c.bindTexture(c.TEXTURE_2D,a.sourceTexture)}c.useProgram(b.program);this.sendAttributeData(c,b.attributeLocations,a.aPosition);c.uniform1f(b.uniformLocations.uStepW,1/a.sourceWidth);c.uniform1f(b.uniformLocations.uStepH,1/a.sourceHeight);this.sendUniformData(c,b.uniformLocations);c.viewport(0,0,a.destinationWidth,a.destinationHeight);c.drawArrays(c.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(c,b,a){c.activeTexture(a);c.bindTexture(c.TEXTURE_2D,b);c.activeTexture(c.TEXTURE0)},unbindAdditionalTexture:function(b,a){b.activeTexture(a);b.bindTexture(b.TEXTURE_2D,null);b.activeTexture(b.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var b=document.createElement("canvas");b.width=a.sourceWidth;b.height=a.sourceHeight;a.helpLayer=b}},toObject:function(){var a={type:this.type},b=this.mainParameter;if(b){a[b]=this[b]}return a},toJSON:function(){return this.toObject()}});fabric.Image.filters.BaseFilter.fromObject=function(a,c){var b=new fabric.Image.filters[a.type](a);c&&c(b);return b};(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.ColorMatrix=d(a.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:true,initialize:function(e){this.callSuper("initialize",e);this.matrix=this.matrix.slice(0)},applyTo2d:function(s){var e=s.imageData,l=e.data,h=l.length,j=this.matrix,f,n,o,p,k,q=this.colorsOnly;for(k=0;k<h;k+=4){f=l[k];n=l[k+1];o=l[k+2];if(q){l[k]=f*j[0]+n*j[1]+o*j[2]+j[4]*255;l[k+1]=f*j[5]+n*j[6]+o*j[7]+j[9]*255;l[k+2]=f*j[10]+n*j[11]+o*j[12]+j[14]*255}else{p=l[k+3];l[k]=f*j[0]+n*j[1]+o*j[2]+p*j[3]+j[4]*255;l[k+1]=f*j[5]+n*j[6]+o*j[7]+p*j[8]+j[9]*255;l[k+2]=f*j[10]+n*j[11]+o*j[12]+p*j[13]+j[14]*255;l[k+3]=f*j[15]+n*j[16]+o*j[17]+p*j[18]+j[19]*255}}},getUniformLocations:function(f,e){return{uColorMatrix:f.getUniformLocation(e,"uColorMatrix"),uConstants:f.getUniformLocation(e,"uConstants"),}},sendUniformData:function(i,h){var e=this.matrix,f=[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]],g=[e[4],e[9],e[14],e[19]];i.uniformMatrix4fv(h.uColorMatrix,false,f);i.uniform4fv(h.uConstants,g)},});c.Image.filters.ColorMatrix.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Brightness=d(a.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(f){if(this.brightness===0){return}var k=f.imageData,h=k.data,g,e=h.length,j=Math.round(this.brightness*255);for(g=0;g<e;g+=4){h[g]=h[g]+j;h[g+1]=h[g+1]+j;h[g+2]=h[g+2]+j}},getUniformLocations:function(f,e){return{uBrightness:f.getUniformLocation(e,"uBrightness"),}},sendUniformData:function(f,e){f.uniform1f(e.uBrightness,this.brightness)},});c.Image.filters.Brightness.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a=c.Image.filters,d=c.util.createClass;a.Convolute=d(a.BaseFilter,{type:"Convolute",opaque:false,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",},retrieveShader:function(f){var g=Math.sqrt(this.matrix.length);var h=this.type+"_"+g+"_"+(this.opaque?1:0);var i=this.fragmentSource[h];if(!f.programCache.hasOwnProperty(h)){f.programCache[h]=this.createProgram(f.context,i)}return f.programCache[h]},applyTo2d:function(k){var A=k.imageData,F=A.data,B=this.matrix,h=Math.round(Math.sqrt(B.length)),l=Math.floor(h/2),t=A.width,E=A.height,m=k.ctx.createImageData(t,E),G=m.data,q=this.opaque?1:0,s,z,C,D,u,w,v,p,f,o,n,j,i;for(n=0;n<E;n++){for(o=0;o<t;o++){u=(n*t+o)*4;s=0;z=0;C=0;D=0;for(i=0;i<h;i++){for(j=0;j<h;j++){v=n+i-l;w=o+j-l;if(v<0||v>=E||w<0||w>=t){continue}p=(v*t+w)*4;f=B[i*h+j];s+=F[p]*f;z+=F[p+1]*f;C+=F[p+2]*f;if(!q){D+=F[p+3]*f}}}G[u]=s;G[u+1]=z;G[u+2]=C;if(!q){G[u+3]=D}else{G[u+3]=F[u+3]}}}k.imageData=m},getUniformLocations:function(g,f){return{uMatrix:g.getUniformLocation(f,"uMatrix"),uOpaque:g.getUniformLocation(f,"uOpaque"),uHalfSize:g.getUniformLocation(f,"uHalfSize"),uSize:g.getUniformLocation(f,"uSize"),}},sendUniformData:function(g,f){g.uniform1fv(f.uMatrix,this.matrix)},toObject:function(){return e(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Grayscale=d(a.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}",},mode:"average",mainParameter:"mode",applyTo2d:function(f){var l=f.imageData,j=l.data,g,e=j.length,h,k=this.mode;for(g=0;g<e;g+=4){if(k==="average"){h=(j[g]+j[g+1]+j[g+2])/3}else{if(k==="lightness"){h=(Math.min(j[g],j[g+1],j[g+2])+Math.max(j[g],j[g+1],j[g+2]))/2}else{if(k==="luminosity"){h=0.21*j[g]+0.72*j[g+1]+0.07*j[g+2]}}}j[g]=h;j[g+1]=h;j[g+2]=h}},retrieveShader:function(e){var f=this.type+"_"+this.mode;if(!e.programCache.hasOwnProperty(f)){var g=this.fragmentSource[this.mode];e.programCache[f]=this.createProgram(e.context,g)}return e.programCache[f]},getUniformLocations:function(f,e){return{uMode:f.getUniformLocation(e,"uMode"),}},sendUniformData:function(g,e){var f=1;g.uniform1i(e.uMode,f)},isNeutralState:function(){return false},});c.Image.filters.Grayscale.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Invert=d(a.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:true,mainParameter:"invert",applyTo2d:function(f){var j=f.imageData,h=j.data,g,e=h.length;for(g=0;g<e;g+=4){h[g]=255-h[g];h[g+1]=255-h[g+1];h[g+2]=255-h[g+2]}},isNeutralState:function(){return !this.invert},getUniformLocations:function(f,e){return{uInvert:f.getUniformLocation(e,"uInvert"),}},sendUniformData:function(f,e){f.uniform1i(e.uInvert,this.invert)},});c.Image.filters.Invert.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a=c.Image.filters,d=c.util.createClass;a.Noise=d(a.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(h){if(this.noise===0){return}var m=h.imageData,l=m.data,j,f=l.length,g=this.noise,k;for(j=0,f=l.length;j<f;j+=4){k=(0.5-Math.random())*g;l[j]+=k;l[j+1]+=k;l[j+2]+=k}},getUniformLocations:function(g,f){return{uNoise:g.getUniformLocation(f,"uNoise"),uSeed:g.getUniformLocation(f,"uSeed"),}},sendUniformData:function(g,f){g.uniform1f(f.uNoise,this.noise/255);g.uniform1f(f.uSeed,Math.random())},toObject:function(){return e(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Pixelate=d(a.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(x){var f=x.imageData,n=f.data,h=f.height,w=f.width,q,o,m,e,p,t,u,l,k,v,s;for(o=0;o<h;o+=this.blocksize){for(m=0;m<w;m+=this.blocksize){q=(o*4)*w+(m*4);e=n[q];p=n[q+1];t=n[q+2];u=n[q+3];v=Math.min(o+this.blocksize,h);s=Math.min(m+this.blocksize,w);for(l=o;l<v;l++){for(k=m;k<s;k++){q=(l*4)*w+(k*4);n[q]=e;n[q+1]=p;n[q+2]=t;n[q+3]=u}}}}},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(f,e){return{uBlocksize:f.getUniformLocation(e,"uBlocksize"),uStepW:f.getUniformLocation(e,"uStepW"),uStepH:f.getUniformLocation(e,"uStepH"),}},sendUniformData:function(f,e){f.uniform1f(e.uBlocksize,this.blocksize)},});c.Image.filters.Pixelate.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend,a=c.Image.filters,d=c.util.createClass;a.RemoveColor=d(a.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:0.02,useAlpha:false,applyTo2d:function(s){var h=s.imageData,l=h.data,m,k=this.distance*255,j,n,p,f=new c.Color(this.color).getSource(),o=[f[0]-k,f[1]-k,f[2]-k,],q=[f[0]+k,f[1]+k,f[2]+k,];for(m=0;m<l.length;m+=4){j=l[m];n=l[m+1];p=l[m+2];if(j>o[0]&&n>o[1]&&p>o[2]&&j<q[0]&&n<q[1]&&p<q[2]){l[m+3]=0}}},getUniformLocations:function(g,f){return{uLow:g.getUniformLocation(f,"uLow"),uHigh:g.getUniformLocation(f,"uHigh"),}},sendUniformData:function(j,g){var i=new c.Color(this.color).getSource(),k=parseFloat(this.distance),h=[0+i[0]/255-k,0+i[1]/255-k,0+i[2]/255-k,1],f=[i[0]/255+k,i[1]/255+k,i[2]/255+k,1];j.uniform4fv(g.uLow,h);j.uniform4fv(g.uHigh,f)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,distance:this.distance})}});c.Image.filters.RemoveColor.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),c=e.Image.filters,f=e.util.createClass;var a={Brownie:[0.5997,0.34553,-0.27082,0,0.186,-0.0377,0.86095,0.15059,0,-0.1449,0.24113,-0.07441,0.44972,0,-0.02965,0,0,0,1,0],Vintage:[0.62793,0.32021,-0.03965,0,0.03784,0.02578,0.64411,0.03259,0,0.02926,0.0466,-0.08512,0.52416,0,0.02023,0,0,0,1,0],Kodachrome:[1.12855,-0.39673,-0.03992,0,0.24991,-0.16404,1.08352,-0.05498,0,0.09698,-0.16786,-0.56034,1.60148,0,0.13972,0,0,0,1,0],Technicolor:[1.91252,-0.85453,-0.09155,0,0.04624,-0.30878,1.76589,-0.10601,0,-0.27589,-0.2311,-0.75018,1.84759,0,0.12137,0,0,0,1,0],Polaroid:[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0],Sepia:[0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0,]};for(var b in a){c[b]=f(c.ColorMatrix,{type:b,matrix:a[b],mainParameter:false,colorsOnly:true,});e.Image.filters[b].fromObject=e.Image.filters.BaseFilter.fromObject}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric,a=c.Image.filters,d=c.util.createClass;a.BlendColor=d(a.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n",},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var f=this.type+"_"+this.mode,g;if(!e.programCache.hasOwnProperty(f)){g=this.buildSource(this.mode);e.programCache[f]=this.createProgram(e.context,g)}return e.programCache[f]},applyTo2d:function(t){var f=t.imageData,n=f.data,k=n.length,p,j,l,h,o,q,e,s=1-this.alpha;e=new c.Color(this.color).getSource();p=e[0]*this.alpha;j=e[1]*this.alpha;l=e[2]*this.alpha;for(var m=0;m<k;m+=4){h=n[m];o=n[m+1];q=n[m+2];switch(this.mode){case"multiply":n[m]=h*p/255;n[m+1]=o*j/255;n[m+2]=q*l/255;break;case"screen":n[m]=255-(255-h)*(255-p)/255;n[m+1]=255-(255-o)*(255-j)/255;n[m+2]=255-(255-q)*(255-l)/255;break;case"add":n[m]=h+p;n[m+1]=o+j;n[m+2]=q+l;break;case"diff":case"difference":n[m]=Math.abs(h-p);n[m+1]=Math.abs(o-j);n[m+2]=Math.abs(q-l);break;case"subtract":n[m]=h-p;n[m+1]=o-j;n[m+2]=q-l;break;case"darken":n[m]=Math.min(h,p);n[m+1]=Math.min(o,j);n[m+2]=Math.min(q,l);break;case"lighten":n[m]=Math.max(h,p);n[m+1]=Math.max(o,j);n[m+2]=Math.max(q,l);break;case"overlay":n[m]=p<128?(2*h*p/255):(255-2*(255-h)*(255-p)/255);n[m+1]=j<128?(2*o*j/255):(255-2*(255-o)*(255-j)/255);n[m+2]=l<128?(2*q*l/255):(255-2*(255-q)*(255-l)/255);break;case"exclusion":n[m]=p+h-((2*p*h)/255);n[m+1]=j+o-((2*j*o)/255);n[m+2]=l+q-((2*l*q)/255);break;case"tint":n[m]=p+h*s;n[m+1]=j+o*s;n[m+2]=l+q*s}}},getUniformLocations:function(f,e){return{uColor:f.getUniformLocation(e,"uColor"),}},sendUniformData:function(g,e){var f=new c.Color(this.color).getSource();f[0]=this.alpha*f[0]/255;f[1]=this.alpha*f[1]/255;f[2]=this.alpha*f[2]/255;f[3]=this.alpha;g.uniform4fv(e.uColor,f)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}});c.Image.filters.BlendColor.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric,a=c.Image.filters,d=c.util.createClass;a.BlendImage=d(a.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}",},retrieveShader:function(e){var f=this.type+"_"+this.mode;var g=this.fragmentSource[this.mode];if(!e.programCache.hasOwnProperty(f)){e.programCache[f]=this.createProgram(e.context,g)}return e.programCache[f]},applyToWebGL:function(e){var g=e.context,f=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(g,f,g.TEXTURE1);this.callSuper("applyToWebGL",e);this.unbindAdditionalTexture(g,g.TEXTURE1)},createTexture:function(e,f){return e.getCachedTexture(f.cacheKey,f._element)},calculateMatrix:function(){var g=this.image,f=g._element.width,e=g._element.height;return[1/g.scaleX,0,0,0,1/g.scaleY,0,-g.left/f,-g.top/e,1]},applyTo2d:function(j){var x=j.imageData,w=j.filterBackend.resources,A=x.data,t=A.length,s=x.width,q=x.height,e,k,l,m,o,v,y,z,h,f,p=this.image,n;if(!w.blendImage){w.blendImage=c.util.createCanvasElement()}h=w.blendImage;f=h.getContext("2d");if(h.width!==s||h.height!==q){h.width=s;h.height=q}else{f.clearRect(0,0,s,q)}f.setTransform(p.scaleX,0,0,p.scaleY,p.left,p.top);f.drawImage(p._element,0,0,s,q);n=f.getImageData(0,0,s,q).data;for(var u=0;u<t;u+=4){o=A[u];v=A[u+1];y=A[u+2];z=A[u+3];e=n[u];k=n[u+1];l=n[u+2];m=n[u+3];switch(this.mode){case"multiply":A[u]=o*e/255;A[u+1]=v*k/255;A[u+2]=y*l/255;A[u+3]=z*m/255;break;case"mask":A[u+3]=m;break}}},getUniformLocations:function(f,e){return{uTransformMatrix:f.getUniformLocation(e,"uTransformMatrix"),uImage:f.getUniformLocation(e,"uImage"),}},sendUniformData:function(g,f){var e=this.calculateMatrix();g.uniform1i(f.uImage,1);g.uniformMatrix3fv(f.uTransformMatrix,false,e)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}});c.Image.filters.BlendImage.fromObject=function(e,f){c.Image.fromObject(e.image,function(h){var g=c.util.object.clone(e);g.image=h;f(new c.Image.filters.BlendImage(g))})}})(typeof exports!=="undefined"?exports:this);(function(b){var d=b.fabric||(b.fabric={}),f=Math.pow,e=Math.floor,h=Math.sqrt,k=Math.abs,j=Math.round,g=Math.sin,i=Math.ceil,c=d.Image.filters,a=d.util.createClass;c.Resize=a(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(m,l){return{uDelta:m.getUniformLocation(l,"uDelta"),uTaps:m.getUniformLocation(l,"uTaps"),}},sendUniformData:function(m,l){m.uniform2fv(l.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);m.uniform1fv(l.uTaps,this.taps)},retrieveShader:function(n){var m=this.getFilterWindow(),o=this.type+"_"+m;if(!n.programCache.hasOwnProperty(o)){var l=this.generateShader(m);n.programCache[o]=this.createProgram(n.context,l)}return n.programCache[o]},getFilterWindow:function(){var l=this.tempScale;return Math.ceil(this.lanczosLobes/l)},getTaps:function(){var m=this.lanczosCreate(this.lanczosLobes),o=this.tempScale,l=this.getFilterWindow(),p=new Array(l);for(var n=1;n<=l;n++){p[n-1]=m(n*o)}return p},generateShader:function(m){var o=new Array(m),l=this.fragmentSourceTOP,m;for(var n=1;n<=m;n++){o[n-1]=n+".0 * uDelta"}l+="uniform float uTaps["+m+"];\n";l+="void main() {\n";l+="  vec4 color = texture2D(uTexture, vTexCoord);\n";l+="  float sum = 1.0;\n";o.forEach(function(q,p){l+="  color += texture2D(uTexture, vTexCoord + "+q+") * uTaps["+p+"];\n";l+="  color += texture2D(uTexture, vTexCoord - "+q+") * uTaps["+p+"];\n";l+="  sum += 2.0 * uTaps["+p+"];\n"});l+="  gl_FragColor = color / sum;\n";l+="}";return l},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(l){if(l.webgl){l.passes++;this.width=l.sourceWidth;this.horizontal=true;this.dW=Math.round(this.width*this.scaleX);this.dH=l.sourceHeight;this.tempScale=this.dW/this.width;this.taps=this.getTaps();l.destinationWidth=this.dW;this._setupFrameBuffer(l);this.applyToWebGL(l);this._swapTextures(l);l.sourceWidth=l.destinationWidth;this.height=l.sourceHeight;this.horizontal=false;this.dH=Math.round(this.height*this.scaleY);this.tempScale=this.dH/this.height;this.taps=this.getTaps();l.destinationHeight=this.dH;this._setupFrameBuffer(l);this.applyToWebGL(l);this._swapTextures(l);l.sourceHeight=l.destinationHeight}else{this.applyTo2d(l)}},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(l){return function(m){if(m>=l||m<=-l){return 0}if(m<1.1920929e-7&&m>-1.1920929e-7){return 1}m*=Math.PI;var n=m/l;return(g(m)/m)*g(n)/n}},applyTo2d:function(t){var l=t.imageData,r=this.scaleX,q=this.scaleY;this.rcpScaleX=1/r;this.rcpScaleY=1/q;var p=l.width,n=l.height,o=j(p*r),m=j(n*q),s;if(this.resizeType==="sliceHack"){s=this.sliceByTwo(t,p,n,o,m)}else{if(this.resizeType==="hermite"){s=this.hermiteFastResize(t,p,n,o,m)}else{if(this.resizeType==="bilinear"){s=this.bilinearFiltering(t,p,n,o,m)}else{if(this.resizeType==="lanczos"){s=this.lanczosResize(t,p,n,o,m)}}}}t.imageData=s},sliceByTwo:function(o,C,r,p,v){var A=o.imageData,q=0.5,w=false,B=false,u=C*q,y=r*q,z=d.filterBackend.resources,l,x,t=0,s=0,n=C,m=0;if(!z.sliceByTwo){z.sliceByTwo=document.createElement("canvas")}l=z.sliceByTwo;if(l.width<C*1.5||l.height<r){l.width=C*1.5;l.height=r}x=l.getContext("2d");x.clearRect(0,0,C*1.5,r);x.putImageData(A,0,0);p=e(p);v=e(v);while(!w||!B){C=u;r=y;if(p<e(u*q)){u=e(u*q)}else{u=p;w=true}if(v<e(y*q)){y=e(y*q)}else{y=v;B=true}x.drawImage(l,t,s,C,r,n,m,u,y);t=n;s=m;m+=y}return x.getImageData(t,s,p,v)},lanczosResize:function(o,C,s,q,u){function w(Q){var P,I,J,O,M,E,G,N,F,L,K;B.x=(Q+0.5)*n;y.x=e(B.x);for(P=0;P<u;P++){B.y=(P+0.5)*m;y.y=e(B.y);M=0;E=0;G=0;N=0;F=0;for(I=y.x-r;I<=y.x+r;I++){if(I<0||I>=C){continue}L=e(1000*k(I-B.x));if(!l[L]){l[L]={}}for(var H=y.y-p;H<=y.y+p;H++){if(H<0||H>=s){continue}K=e(1000*k(H-B.y));if(!l[L][K]){l[L][K]=t(h(f(L*x,2)+f(K*v,2))/1000)}J=l[L][K];if(J>0){O=(H*C+I)*4;M+=J;E+=J*A[O];G+=J*A[O+1];N+=J*A[O+2];F+=J*A[O+3]}}}O=(P*q+Q)*4;z[O]=E/M;z[O+1]=G/M;z[O+2]=N/M;z[O+3]=F/M}if(++Q<q){return w(Q)}else{return D}}var A=o.imageData.data,D=o.ctx.createImageData(q,u),z=D.data,t=this.lanczosCreate(this.lanczosLobes),n=this.rcpScaleX,m=this.rcpScaleY,x=2/this.rcpScaleX,v=2/this.rcpScaleY,r=i(n*this.lanczosLobes/2),p=i(m*this.lanczosLobes/2),l={},B={},y={};return w(0)},bilinearFiltering:function(n,L,q,o,B){var K,J,I,H,A,v,F,E,G,w,u,D,r=0,t,m=this.rcpScaleX,l=this.rcpScaleY,s=4*(L-1),M=n.imageData,C=M.data,p=n.ctx.createImageData(o,B),z=p.data;for(F=0;F<B;F++){for(E=0;E<o;E++){A=e(m*E);v=e(l*F);G=m*E-A;w=l*F-v;t=4*(v*L+A);for(u=0;u<4;u++){K=C[t+u];J=C[t+4+u];I=C[t+s+u];H=C[t+s+4+u];D=K*(1-G)*(1-w)+J*G*(1-w)+I*w*(1-G)+H*G*w;z[r++]=D}}}return p},hermiteFastResize:function(n,N,p,o,G){var m=this.rcpScaleX,B=this.rcpScaleY,I=i(m/2),E=i(B/2),Q=n.imageData,P=Q.data,O=n.ctx.createImageData(o,G),q=O.data;for(var J=0;J<G;J++){for(var K=0;K<o;K++){var L=(K+J*o)*4,F=0,M=0,u=0,l=0,s=0,x=0,y=0,t=(J+0.5)*B;for(var H=e(J*B);H<(J+1)*B;H++){var A=k(t-(H+0.5))/E,v=(K+0.5)*m,D=A*A;for(var r=e(K*m);r<(K+1)*m;r++){var C=k(v-(r+0.5))/I,z=h(D+C*C);if(z>1&&z<-1){continue}F=2*z*z*z-3*z*z+1;if(F>0){C=4*(r+H*N);y+=F*P[C+3];u+=F;if(P[C+3]<255){F=F*P[C+3]/250}l+=F*P[C];s+=F*P[C+1];x+=F*P[C+2];M+=F}}}q[L]=l/M;q[L+1]=s/M;q[L+2]=x/M;q[L+3]=y/u}}return O},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});d.Image.filters.Resize.fromObject=d.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Contrast=d(a.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(f){if(this.contrast===0){return}var l=f.imageData,g,e,k=l.data,e=k.length,j=Math.floor(this.contrast*255),h=259*(j+255)/(255*(259-j));for(g=0;g<e;g+=4){k[g]=h*(k[g]-128)+128;k[g+1]=h*(k[g+1]-128)+128;k[g+2]=h*(k[g+2]-128)+128}},getUniformLocations:function(f,e){return{uContrast:f.getUniformLocation(e,"uContrast"),}},sendUniformData:function(f,e){f.uniform1f(e.uContrast,this.contrast)},});c.Image.filters.Contrast.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Saturation=d(a.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(g){if(this.saturation===0){return}var l=g.imageData,j=l.data,f=j.length,k=-this.saturation,h,e;for(h=0;h<f;h+=4){e=Math.max(j[h],j[h+1],j[h+2]);j[h]+=e!==j[h]?(e-j[h])*k:0;j[h+1]+=e!==j[h+1]?(e-j[h+1])*k:0;j[h+2]+=e!==j[h+2]?(e-j[h+2])*k:0}},getUniformLocations:function(f,e){return{uSaturation:f.getUniformLocation(e,"uSaturation"),}},sendUniformData:function(f,e){f.uniform1f(e.uSaturation,-this.saturation)},});c.Image.filters.Saturation.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Blur=d(a.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){if(e.webgl){this.aspectRatio=e.sourceWidth/e.sourceHeight;e.passes++;this._setupFrameBuffer(e);this.horizontal=true;this.applyToWebGL(e);this._swapTextures(e);this._setupFrameBuffer(e);this.horizontal=false;this.applyToWebGL(e);this._swapTextures(e)}else{this.applyTo2d(e)}},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(u){var k=u.filterBackend.resources,f,e,g=u.imageData.width,s=u.imageData.height;if(!k.blurLayer1){k.blurLayer1=c.util.createCanvasElement();k.blurLayer2=c.util.createCanvasElement()}f=k.blurLayer1;e=k.blurLayer2;if(f.width!==g||f.height!==s){e.width=f.width=g;e.height=f.height=s}var p=f.getContext("2d"),o=e.getContext("2d"),q=15,h,r,m,n,l=this.blur*0.06*0.5;p.putImageData(u.imageData,0,0);o.clearRect(0,0,g,s);for(n=-q;n<=q;n++){h=(Math.random()-0.5)/4;r=n/q;m=l*r*g+h;o.globalAlpha=1-Math.abs(r);o.drawImage(f,m,h);p.drawImage(e,0,0);o.globalAlpha=1;o.clearRect(0,0,e.width,e.height)}for(n=-q;n<=q;n++){h=(Math.random()-0.5)/4;r=n/q;m=l*r*s+h;o.globalAlpha=1-Math.abs(r);o.drawImage(f,h,m);p.drawImage(e,0,0);o.globalAlpha=1;o.clearRect(0,0,e.width,e.height)}u.ctx.drawImage(f,0,0);var t=u.ctx.getImageData(0,0,f.width,f.height);p.globalAlpha=1;p.clearRect(0,0,f.width,f.height);return t},getUniformLocations:function(f,e){return{delta:f.getUniformLocation(e,"uDelta"),}},sendUniformData:function(f,e){var g=this.chooseRightDelta();f.uniform2fv(e.delta,g)},chooseRightDelta:function(){var e=1,g=[0,0],f;if(this.horizontal){if(this.aspectRatio>1){e=1/this.aspectRatio}}else{if(this.aspectRatio<1){e=this.aspectRatio}}f=e*this.blur*0.12;if(this.horizontal){g[0]=f}else{g[1]=f}return g},});a.Blur.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Gamma=d(a.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1];a.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(n){var e=n.imageData,h=e.data,f=this.gamma,j=h.length,l=1/f[0],k=1/f[1],m=1/f[2],g;if(!this.rVals){this.rVals=new Uint8Array(256);this.gVals=new Uint8Array(256);this.bVals=new Uint8Array(256)}for(g=0,j=256;g<j;g++){this.rVals[g]=Math.pow(g/255,l)*255;this.gVals[g]=Math.pow(g/255,k)*255;this.bVals[g]=Math.pow(g/255,m)*255}for(g=0,j=h.length;g<j;g+=4){h[g]=this.rVals[h[g]];h[g+1]=this.gVals[h[g+1]];h[g+2]=this.bVals[h[g+2]]}},getUniformLocations:function(f,e){return{uGamma:f.getUniformLocation(e,"uGamma"),}},sendUniformData:function(f,e){f.uniform3fv(e.uGamma,this.gamma)},});c.Image.filters.Gamma.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.Composed=d(a.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e);this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1;this.subFilters.forEach(function(f){f.applyTo(e)})},toObject:function(){return c.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()}),})},isNeutralState:function(){return !this.subFilters.some(function(e){return !e.isNeutralState()})}});c.Image.filters.Composed.fromObject=function(g,i){var h=g.subFilters||[],f=h.map(function(j){return new c.Image.filters[j.type](j)}),e=new c.Image.filters.Composed({subFilters:f});i&&i(e);return e}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.Image.filters,d=c.util.createClass;a.HueRotation=d(a.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,j=c.util.cos(e),i=c.util.sin(e),h=1/3,g=Math.sqrt(h)*i,f=1-j;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=j+f/3;this.matrix[1]=h*f-g;this.matrix[2]=h*f+g;this.matrix[5]=h*f+g;this.matrix[6]=j+h*f;this.matrix[7]=h*f-g;this.matrix[10]=h*f-g;this.matrix[11]=h*f+g;this.matrix[12]=j+h*f},isNeutralState:function(e){this.calculateMatrix();return a.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix();a.BaseFilter.prototype.applyTo.call(this,e)},});c.Image.filters.HueRotation.fromObject=c.Image.filters.BaseFilter.fromObject})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.clone;if(b.Text){b.warn("fabric.Text is already defined");return}b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles",],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:false,overline:false,linethrough:false,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:0.6,baseline:-0.35},subscript:{size:0.6,baseline:0.11},textBackgroundColor:"",stateProperties:b.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:b.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:0.222,offsets:{underline:0.1,linethrough:-0.315,overline:-0.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor",],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,d){this.styles=d?(d.styles||{}):{};this.text=e;this.__skipDimension=true;this.callSuper("initialize",d);this.__skipDimension=false;this.initDimensions();this.setCoords();this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){if(!b._measuringContext){b._measuringContext=this.canvas&&this.canvas.contextCache||b.util.createCanvasElement().getContext("2d")}return b._measuringContext},_splitText:function(){var d=this._splitTextIntoLines(this.text);this.textLines=d.lines;this._textLines=d.graphemeLines;this._unwrappedTextLines=d._unwrappedLines;this._text=d.graphemeText;return d},initDimensions:function(){if(this.__skipDimension){return}this._splitText();this._clearCache();this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH;if(this.textAlign.indexOf("justify")!==-1){this.enlargeSpaces()}this.height=this.calcTextHeight();this.saveState({propertySet:"_dimensionAffectingProps"})},enlargeSpaces:function(){var l,d,h,m,p,n,k;for(var f=0,g=this._textLines.length;f<g;f++){if(this.textAlign!=="justify"&&(f===g-1||this.isEndOfWrapping(f))){continue}m=0;p=this._textLines[f];d=this.getLineWidth(f);if(d<this.width&&(k=this.textLines[f].match(this._reSpacesAndTabs))){h=k.length;l=(this.width-d)/h;for(var e=0,o=p.length;e<=o;e++){n=this.__charBounds[f][e];if(this._reSpaceAndTab.test(p[e])){n.width+=l;n.kernedWidth+=l;n.left+=m;m+=l}else{n.left+=m}}}}},isEndOfWrapping:function(d){return d===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions");var d=this.fontSize;e.width+=d*e.zoomX;e.height+=d*e.zoomY;return e},_render:function(d){this._setTextStyles(d);this._renderTextLinesBackground(d);this._renderTextDecoration(d,"underline");this._renderText(d);this._renderTextDecoration(d,"overline");this._renderTextDecoration(d,"linethrough")},_renderText:function(d){if(this.paintFirst==="stroke"){this._renderTextStroke(d);this._renderTextFill(d)}else{this._renderTextFill(d);this._renderTextStroke(d)}},_setTextStyles:function(e,d,f){e.textBaseline="alphabetic";e.font=this._getFontDeclaration(d,f)},calcTextWidth:function(){var f=this.getLineWidth(0);for(var e=1,d=this._textLines.length;e<d;e++){var g=this.getLineWidth(e);if(g>f){f=g}}return f},_renderTextLine:function(i,e,d,g,f,h){this._renderChars(i,e,d,g,f,h)},_renderTextLinesBackground:function(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor")){return}var g=0,e,p,q=t.fillStyle,v,f,d=this._getLeftOffset(),o=this._getTopOffset(),n=0,m=0,u,k;for(var l=0,r=this._textLines.length;l<r;l++){e=this.getHeightOfLine(l);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",l)){g+=e;continue}v=this._textLines[l];p=this._getLineLeftOffset(l);m=0;n=0;f=this.getValueOfPropertyAt(l,0,"textBackgroundColor");for(var h=0,s=v.length;h<s;h++){u=this.__charBounds[l][h];k=this.getValueOfPropertyAt(l,h,"textBackgroundColor");if(k!==f){t.fillStyle=f;f&&t.fillRect(d+p+n,o+g,m,e/this.lineHeight);n=u.left;m=u.width;f=k}else{m+=u.kernedWidth}}if(k){t.fillStyle=k;t.fillRect(d+p+n,o+g,m,e/this.lineHeight)}g+=e}t.fillStyle=q;this._removeShadow(t)},getFontCache:function(e){var d=e.fontFamily.toLowerCase();if(!b.charWidthsCache[d]){b.charWidthsCache[d]={}}var f=b.charWidthsCache[d],g=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();if(!f[g]){f[g]={}}return f[g]},_applyCharStyles:function(h,d,g,f,e){this._setFillStyles(d,e);this._setStrokeStyles(d,e);d.font=this._getFontDeclaration(e)},_measureChar:function(q,l,k,f){var g=this.getFontCache(l),i=this._getFontDeclaration(l),p=this._getFontDeclaration(f),n=k+q,e=i===p,d,o,m,j=l.fontSize/this.CACHE_FONT_SIZE,h;if(k&&g[k]!==undefined){m=g[k]}if(g[q]!==undefined){h=d=g[q]}if(e&&g[n]!==undefined){o=g[n];h=o-m}if(d===undefined||m===undefined||o===undefined){var r=this.getMeasuringContext();this._setTextStyles(r,l,true)}if(d===undefined){h=d=r.measureText(q).width;g[q]=d}if(m===undefined&&e&&k){m=r.measureText(k).width;g[k]=m}if(e&&o===undefined){o=r.measureText(n).width;g[n]=o;h=o-m}return{width:d*j,kernedWidth:h*j}},getHeightOfChar:function(d,e){return this.getValueOfPropertyAt(d,e,"fontSize")},measureLine:function(e){var d=this._measureLine(e);if(this.charSpacing!==0){d.width-=this._getWidthOfCharSpacing()}if(d.width<0){d.width=0}return d},_measureLine:function(k){var e=0,h,l,m=this._textLines[k],g,d,f=0,j=new Array(m.length);this.__charBounds[k]=j;for(h=0;h<m.length;h++){l=m[h];d=this._getGraphemeBox(l,k,h,g);j[h]=d;e+=d.kernedWidth;g=l}j[h]={left:d?d.left+d.width:0,width:0,kernedWidth:0,height:this.fontSize};return{width:e,numOfSpaces:f}},_getGraphemeBox:function(p,o,d,k,h){var e=this.getCompleteStyleDeclaration(o,d),n=k?this.getCompleteStyleDeclaration(o,d-1):{},g=this._measureChar(p,e,k,n),j=g.kernedWidth,f=g.width,m;if(this.charSpacing!==0){m=this._getWidthOfCharSpacing();f+=m;j+=m}var l={width:f,left:0,height:e.fontSize,kernedWidth:j,deltaY:e.deltaY,};if(d>0&&!h){var i=this.__charBounds[o][d-1];l.left=i.left+i.width+g.kernedWidth-g.width}return l},getHeightOfLine:function(h){if(this.__lineHeights[h]){return this.__lineHeights[h]}var e=this._textLines[h],g=this.getHeightOfChar(h,0);for(var f=1,d=e.length;f<d;f++){g=Math.max(this.getHeightOfChar(h,f),g)}return this.__lineHeights[h]=g*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){var g,e=0;for(var f=0,d=this._textLines.length;f<d;f++){g=this.getHeightOfLine(f);e+=(f===d-1?g/this.lineHeight:g)}return e},_getLeftOffset:function(){return -this.width/2},_getTopOffset:function(){return -this.height/2},_applyPatternGradientTransform:function(e,f){if(!f||!f.toLive){return{offsetX:0,offsetY:0}}var d=-this.width/2+f.offsetX||0,g=-this.height/2+f.offsetY||0;e.transform(1,0,0,1,d,g);return{offsetX:d,offsetY:g}},_renderTextCommon:function(o,d){o.save();var l=0,g=this._getLeftOffset(),m=this._getTopOffset(),h=this._applyPatternGradientTransform(o,d==="fillText"?this.fill:this.stroke);for(var j=0,k=this._textLines.length;j<k;j++){var f=this.getHeightOfLine(j),n=f/this.lineHeight,e=this._getLineLeftOffset(j);this._renderTextLine(d,o,this._textLines[j],g+e-h.offsetX,m+l+n-h.offsetY,j);l+=f}o.restore()},_renderTextFill:function(d){if(!this.fill&&!this.styleHas("fill")){return}this._renderTextCommon(d,"fillText")},_renderTextStroke:function(d){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(d)}d.save();this._setLineDash(d,this.strokeDashArray);d.beginPath();this._renderTextCommon(d,"strokeText");d.closePath();d.restore()},_renderChars:function(e,r,u,g,n,q){var p=this.getHeightOfLine(q),o=this.textAlign.indexOf("justify")!==-1,d,t,l="",s,k=0,f,h=!o&&this.charSpacing===0&&this.isEmptyStyles(q);r.save();n-=p*this._fontSizeFraction/this.lineHeight;if(h){this._renderChar(e,r,q,0,this.textLines[q],g,n,p);r.restore();return}for(var j=0,m=u.length-1;j<=m;j++){f=j===m||this.charSpacing;l+=u[j];s=this.__charBounds[q][j];if(k===0){g+=s.kernedWidth-s.width;k+=s.width}else{k+=s.kernedWidth}if(o&&!f){if(this._reSpaceAndTab.test(u[j])){f=true}}if(!f){d=d||this.getCompleteStyleDeclaration(q,j);t=this.getCompleteStyleDeclaration(q,j+1);f=this._hasStyleChanged(d,t)}if(f){this._renderChar(e,r,q,j,l,g,n,p);l="";d=t;g+=k;k=0}}r.restore()},_renderChar:function(d,n,m,e,k,f,h){var i=this._getStyleDeclaration(m,e),l=this.getCompleteStyleDeclaration(m,e),g=d==="fillText"&&l.fill,j=d==="strokeText"&&l.stroke&&l.strokeWidth;if(!j&&!g){return}i&&n.save();this._applyCharStyles(d,n,m,e,l);if(i&&i.textBackgroundColor){this._removeShadow(n)}if(i&&i.deltaY){h+=i.deltaY}g&&n.fillText(k,f,h);j&&n.strokeText(k,f,h);i&&n.restore()},setSuperscript:function(e,d){return this._setScript(e,d,this.superscript)},setSubscript:function(e,d){return this._setScript(e,d,this.subscript)},_setScript:function(j,e,g){var i=this.get2DCursorLocation(j,true),h=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),d=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),f={fontSize:h*g.size,deltaY:d+h*g.baseline};this.setSelectionStyles(f,j,e);return this},_hasStyleChanged:function(d,e){return d.fill!==e.fill||d.stroke!==e.stroke||d.strokeWidth!==e.strokeWidth||d.fontSize!==e.fontSize||d.fontFamily!==e.fontFamily||d.fontWeight!==e.fontWeight||d.fontStyle!==e.fontStyle||d.deltaY!==e.deltaY},_hasStyleChangedForSvg:function(d,e){return this._hasStyleChanged(d,e)||d.overline!==e.overline||d.underline!==e.underline||d.linethrough!==e.linethrough},_getLineLeftOffset:function(e){var d=this.getLineWidth(e);if(this.textAlign==="center"){return(this.width-d)/2}if(this.textAlign==="right"){return this.width-d}if(this.textAlign==="justify-center"&&this.isEndOfWrapping(e)){return(this.width-d)/2}if(this.textAlign==="justify-right"&&this.isEndOfWrapping(e)){return this.width-d}return 0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[]},_shouldClearDimensionCache:function(){var d=this._forceClearCache;d||(d=this.hasStateChanged("_dimensionAffectingProps"));if(d){this.dirty=true;this._forceClearCache=false}return d},getLineWidth:function(g){if(this.__lineWidths[g]){return this.__lineWidths[g]}var f,e=this._textLines[g],d;if(e===""){f=0}else{d=this.measureLine(g);f=d.width}this.__lineWidths[g]=f;return f},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.charSpacing/1000}return 0},getValueOfPropertyAt:function(g,f,e){var d=this._getStyleDeclaration(g,f);if(d&&typeof d[e]!=="undefined"){return d[e]}return this[e]},_renderTextDecoration:function(y,g){if(!this[g]&&!this.styleHas(g)){return}var t,w,h,s,q,d,p,f,o=this._getLeftOffset(),z=this._getTopOffset(),v,D,n,m,r,x,k,l,e=this._getWidthOfCharSpacing();for(var B=0,C=this._textLines.length;B<C;B++){t=this.getHeightOfLine(B);if(!this[g]&&!this.styleHas(g,B)){z+=t;continue}p=this._textLines[B];x=t/this.lineHeight;s=this._getLineLeftOffset(B);D=0;n=0;f=this.getValueOfPropertyAt(B,0,g);l=this.getValueOfPropertyAt(B,0,"fill");v=z+x*(1-this._fontSizeFraction);w=this.getHeightOfChar(B,0);q=this.getValueOfPropertyAt(B,0,"deltaY");for(var A=0,u=p.length;A<u;A++){m=this.__charBounds[B][A];r=this.getValueOfPropertyAt(B,A,g);k=this.getValueOfPropertyAt(B,A,"fill");h=this.getHeightOfChar(B,A);d=this.getValueOfPropertyAt(B,A,"deltaY");if((r!==f||k!==l||h!==w||d!==q)&&n>0){y.fillStyle=l;f&&l&&y.fillRect(o+s+D,v+this.offsets[g]*w+q,n,this.fontSize/15);D=m.left;n=m.width;f=r;l=k;w=h;q=d}else{n+=m.kernedWidth}}y.fillStyle=k;r&&k&&y.fillRect(o+s+D,v+this.offsets[g]*w+q,n-e,this.fontSize/15);z+=t}this._removeShadow(y)},_getFontDeclaration:function(e,i){var g=e||this,f=this.fontFamily,h=b.Text.genericFonts.indexOf(f.toLowerCase())>-1;var d=f===undefined||f.indexOf("'")>-1||f.indexOf(",")>-1||f.indexOf('"')>-1||h?g.fontFamily:'"'+g.fontFamily+'"';return[(b.isLikelyNode?g.fontWeight:g.fontStyle),(b.isLikelyNode?g.fontStyle:g.fontWeight),i?this.CACHE_FONT_SIZE+"px":g.fontSize+"px",d].join(" ")},render:function(d){if(!this.visible){return}if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return}if(this._shouldClearDimensionCache()){this.initDimensions()}this.callSuper("render",d)},_splitTextIntoLines:function(h){var d=h.split(this._reNewline),e=new Array(d.length),j=["\n"],g=[];for(var f=0;f<d.length;f++){e[f]=b.util.string.graphemeSplit(d[f]);g=g.concat(e[f],j)}g.pop();return{_unwrappedLines:e,lines:d,graphemeText:g,graphemeLines:e}},toObject:function(f){var d=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing",].concat(f);var e=this.callSuper("toObject",d);e.styles=c(this.styles,true);return e},set:function(e,g){this.callSuper("set",e,g);var d=false;if(typeof e==="object"){for(var f in e){d=d||this._dimensionAffectingProps.indexOf(f)!==-1}}else{d=this._dimensionAffectingProps.indexOf(e)!==-1}if(d){this.initDimensions();this.setCoords()}return this},complexity:function(){return 1}});b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" "));b.Text.DEFAULT_SVG_FONT_SIZE=16;b.Text.fromElement=function(d,m,q){if(!d){return m(null)}var j=b.parseAttributes(d,b.Text.ATTRIBUTE_NAMES),n=j.textAnchor||"left";q=b.util.object.extend((q?c(q):{}),j);q.top=q.top||0;q.left=q.left||0;if(j.textDecoration){var p=j.textDecoration;if(p.indexOf("underline")!==-1){q.underline=true}if(p.indexOf("overline")!==-1){q.overline=true}if(p.indexOf("line-through")!==-1){q.linethrough=true}delete q.textDecoration}if("dx" in j){q.left+=j.dx}if("dy" in j){q.top+=j.dy}if(!("fontSize" in q)){q.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE}var f="";if(!("textContent" in d)){if("firstChild" in d&&d.firstChild!==null){if("data" in d.firstChild&&d.firstChild.data!==null){f=d.firstChild.data}}}else{f=d.textContent}f=f.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var o=q.strokeWidth;q.strokeWidth=0;var l=new b.Text(f,q),i=l.getScaledHeight()/l.height,e=(l.height+l.strokeWidth)*l.lineHeight-l.height,g=e*i,h=l.getScaledHeight()+g,k=0;if(n==="center"){k=l.getScaledWidth()/2}if(n==="right"){k=l.getScaledWidth()}l.set({left:l.left-k,top:l.top-(h-l.fontSize*(0.07+l._fontSizeFraction))/l.lineHeight,strokeWidth:typeof o!=="undefined"?o:1,});m(l)};b.Text.fromObject=function(d,e){return b.Object._fromObject("Text",d,e,"text")};b.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"];b.util.createAccessors&&b.util.createAccessors(b.Text)})(typeof exports!=="undefined"?exports:this);(function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(e){if(!this.styles){return true}if(typeof e!=="undefined"&&!this.styles[e]){return true}var c=typeof e==="undefined"?this.styles:{line:this.styles[e]};for(var d in c){for(var b in c[d]){for(var a in c[d][b]){return false}}}return true},styleHas:function(a,e){if(!this.styles||!a||a===""){return false}if(typeof e!=="undefined"&&!this.styles[e]){return false}var c=typeof e==="undefined"?this.styles:{0:this.styles[e]};for(var d in c){for(var b in c[d]){if(typeof c[d][b][a]!=="undefined"){return true}}}return false},cleanStyle:function(h){if(!this.styles||!h||h===""){return false}var b=this.styles,m=0,f,j,l=true,c=0,e;for(var k in b){f=0;for(var g in b[k]){var e=b[k][g],d=e.hasOwnProperty(h);m++;if(d){if(!j){j=e[h]}else{if(e[h]!==j){l=false}}if(e[h]===this[h]){delete e[h]}}else{l=false}if(Object.keys(e).length!==0){f++}else{delete b[k][g]}}if(f===0){delete b[k]}}for(var a=0;a<this._textLines.length;a++){c+=this._textLines[a].length}if(l&&m===c){this[h]=j;this.removeStyle(h)}},removeStyle:function(b){if(!this.styles||!b||b===""){return}var c=this.styles,a,d,e;for(d in c){a=c[d];for(e in a){delete a[e][b];if(Object.keys(a[e]).length===0){delete a[e]}}if(Object.keys(a).length===0){delete c[d]}}},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);if(!this._getLineStyle(c.lineIndex)){this._setLineStyle(c.lineIndex)}if(!this._getStyleDeclaration(c.lineIndex,c.charIndex)){this._setStyleDeclaration(c.lineIndex,c.charIndex,{})}fabric.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),b)},get2DCursorLocation:function(d,e){if(typeof d==="undefined"){d=this.selectionStart}var b=e?this._unwrappedTextLines:this._textLines,a=b.length;for(var c=0;c<a;c++){if(d<=b[c].length){return{lineIndex:c,charIndex:d}}d-=b[c].length+this.missingNewlineOffset(c)}return{lineIndex:c-1,charIndex:b[c-1].length<d?b[c-1].length:d}},getSelectionStyles:function(e,d,a){if(typeof e==="undefined"){e=this.selectionStart||0}if(typeof d==="undefined"){d=this.selectionEnd||e}var c=[];for(var b=e;b<d;b++){c.push(this.getStyleAtPosition(b,a))}return c},getStyleAtPosition:function(a,b){var d=this.get2DCursorLocation(a),c=b?this.getCompleteStyleDeclaration(d.lineIndex,d.charIndex):this._getStyleDeclaration(d.lineIndex,d.charIndex);return c||{}},setSelectionStyles:function(b,d,c){if(typeof d==="undefined"){d=this.selectionStart||0}if(typeof c==="undefined"){c=this.selectionEnd||d}for(var a=d;a<c;a++){this._extendStyles(a,b)}this._forceClearCache=true;return this},_getStyleDeclaration:function(c,b){var a=this.styles&&this.styles[c];if(!a){return null}return a[b]},getCompleteStyleDeclaration:function(e,d){var c=this._getStyleDeclaration(e,d)||{},a={},f;for(var b=0;b<this._styleProperties.length;b++){f=this._styleProperties[b];a[f]=typeof c[f]==="undefined"?this[f]:c[f]}return a},_setStyleDeclaration:function(c,b,a){this.styles[c][b]=a},_deleteStyleDeclaration:function(b,a){delete this.styles[b][a]},_getLineStyle:function(a){return !!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}})})();(function(){function a(b){if(b.textDecoration){b.textDecoration.indexOf("underline")>-1&&(b.underline=true);b.textDecoration.indexOf("line-through")>-1&&(b.linethrough=true);b.textDecoration.indexOf("overline")>-1&&(b.overline=true);delete b.textDecoration}}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:false,editable:true,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1000,cursorDuration:600,caching:true,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,__widthOfSpace:[],inCompositionMode:false,initialize:function(c,b){this.callSuper("initialize",c,b);this.initBehavior()},setSelectionStart:function(b){b=Math.max(b,0);this._updateAndFire("selectionStart",b)},setSelectionEnd:function(b){b=Math.min(b,this.text.length);this._updateAndFire("selectionEnd",b)},_updateAndFire:function(c,b){if(this[c]!==b){this._fireSelectionChanged();this[c]=b}this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper("initDimensions")},render:function(b){this.clearContextTop();this.callSuper("render",b);this.cursorOffsetCache={};this.renderCursorOrSelection()},_render:function(b){this.callSuper("_render",b)},clearContextTop:function(d){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return}var b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(b);this.transformMatrix&&b.transform.apply(b,this.transformMatrix);this._clearTextArea(b);d||b.restore()},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return}var c=this._getCursorBoundaries(),b=this.canvas.contextTop;this.clearContextTop(true);if(this.selectionStart===this.selectionEnd){this.renderCursor(c,b)}else{this.renderSelection(c,b)}b.restore()},_clearTextArea:function(c){var d=this.width+4,b=this.height+4;c.clearRect(-d/2,-b/2,d,b)},_getCursorBoundaries:function(b){if(typeof b==="undefined"){b=this.selectionStart}var e=this._getLeftOffset(),d=this._getTopOffset(),c=this._getCursorBoundariesOffsets(b);return{left:e,top:d,leftOffset:c.left,topOffset:c.top}},_getCursorBoundariesOffsets:function(k){if(this.cursorOffsetCache&&"top" in this.cursorOffsetCache){return this.cursorOffsetCache}var h,l,b,j=0,d=0,e,c=this.get2DCursorLocation(k);b=c.charIndex;l=c.lineIndex;for(var g=0;g<l;g++){j+=this.getHeightOfLine(g)}h=this._getLineLeftOffset(l);var f=this.__charBounds[l][b];f&&(d=f.left);if(this.charSpacing!==0&&b===this._textLines[l].length){d-=this._getWidthOfCharSpacing()}e={top:j,left:h+(d>0?d:0),};this.cursorOffsetCache=e;return this.cursorOffsetCache},renderCursor:function(c,j){var f=this.get2DCursorLocation(),i=f.lineIndex,b=f.charIndex>0?f.charIndex-1:0,d=this.getValueOfPropertyAt(i,b,"fontSize"),h=this.scaleX*this.canvas.getZoom(),k=this.cursorWidth/h,e=c.topOffset,g=this.getValueOfPropertyAt(i,b,"deltaY");e+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-d*(1-this._fontSizeFraction);if(this.inCompositionMode){this.renderSelection(c,j)}j.fillStyle=this.getValueOfPropertyAt(i,b,"fill");j.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;j.fillRect(c.left+c.leftOffset-k/2,e+c.top+g,k,d)},renderSelection:function(r,l){var k=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,c=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(k),g=this.get2DCursorLocation(c),m=h.lineIndex,j=g.lineIndex,d=h.charIndex<0?0:h.charIndex,o=g.charIndex<0?0:g.charIndex;for(var n=m;n<=j;n++){var q=this._getLineLeftOffset(n)||0,f=this.getHeightOfLine(n),e=0,t=0,p=0;if(n===m){t=this.__charBounds[m][d].left}if(n>=m&&n<j){p=s&&!this.isEndOfWrapping(n)?this.width:this.getLineWidth(n)||5}else{if(n===j){if(o===0){p=this.__charBounds[j][o].left}else{var b=this._getWidthOfCharSpacing();p=this.__charBounds[j][o-1].left+this.__charBounds[j][o-1].width-b}}}e=f;if(this.lineHeight<1||(n===j&&this.lineHeight>1)){f/=this.lineHeight}if(this.inCompositionMode){l.fillStyle=this.compositionColor||"black";l.fillRect(r.left+q+t,r.top+r.topOffset+f,p-t,1)}else{l.fillStyle=this.selectionColor;l.fillRect(r.left+q+t,r.top+r.topOffset,p-t,f)}r.topOffset+=e}},getCurrentCharFontSize:function(){var b=this._getCurrentCharIndex();return this.getValueOfPropertyAt(b.l,b.c,"fontSize")},getCurrentCharColor:function(){var b=this._getCurrentCharIndex();return this.getValueOfPropertyAt(b.l,b.c,"fill")},_getCurrentCharIndex:function(){var b=this.get2DCursorLocation(this.selectionStart,true),c=b.charIndex>0?b.charIndex-1:0;return{l:b.lineIndex,c:c}}});fabric.IText.fromObject=function(c,e){a(c);if(c.styles){for(var d in c.styles){for(var b in c.styles[d]){a(c.styles[d][b])}}}fabric.Object._fromObject("IText",c,e,"text")}})();(function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=false},initAddedHandler:function(){var b=this;this.on("added",function(){var c=b.canvas;if(c){if(!c._hasITextHandlers){c._hasITextHandlers=true;b._initCanvasHandlers(c)}c._iTextInstances=c._iTextInstances||[];c._iTextInstances.push(b)}})},initRemovedHandler:function(){var b=this;this.on("removed",function(){var c=b.canvas;if(c){c._iTextInstances=c._iTextInstances||[];fabric.util.removeFromArray(c._iTextInstances,b);if(c._iTextInstances.length===0){c._hasITextHandlers=false;b._removeCanvasHandlers(c)}}})},_initCanvasHandlers:function(b){b._mouseUpITextHandler=function(){if(b._iTextInstances){b._iTextInstances.forEach(function(c){c.__isMousedown=false})}};b.on("mouse:up",b._mouseUpITextHandler)},_removeCanvasHandlers:function(b){b.off("mouse:up",b._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,c,d,f){var b;b={isAborted:false,abort:function(){this.isAborted=true},};e.animate("_currentCursorOpacity",c,{duration:d,onComplete:function(){if(!b.isAborted){e[f]()}},onChange:function(){if(e.canvas&&e.selectionStart===e.selectionEnd){e.renderCursorOrSelection()}},abort:function(){return b.isAborted}});return b},_onTickComplete:function(){var b=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1)}this._cursorTimeout1=setTimeout(function(){b._currentTickCompleteState=b._animateCursor(b,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(b){var d=this,c=b?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){d._tick()},c)},abortCursorAnimation:function(){var c=this._currentTickState||this._currentTickCompleteState,b=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;if(c&&b){b.clearContext(b.contextTop||b.contextContainer)}},selectAll:function(){this.selectionStart=0;this.selectionEnd=this._text.length;this._fireSelectionChanged();this._updateTextarea();return this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this._text[b])){while(this._reSpace.test(this._text[b])){d++;b--}}while(/\S/.test(this._text[b])&&b>-1){d++;b--}return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this._text[b])){while(this._reSpace.test(this._text[b])){d++;b++}}while(/\S/.test(this._text[b])&&b<this._text.length){d++;b++}return c+d},findLineBoundaryLeft:function(c){var d=0,b=c-1;while(!/\n/.test(this._text[b])&&b>-1){d++;b--}return c-d},findLineBoundaryRight:function(c){var d=0,b=c;while(!/\n/.test(this._text[b])&&b<this._text.length){d++;b++}return c+d},searchWordBoundary:function(e,f){var g=this._text,d=this._reSpace.test(g[e])?e-1:e,c=g[d],b=fabric.reNonWord;while(!b.test(c)&&d>0&&d<g.length){d+=f;c=g[d]}if(b.test(c)){d+=f===1?0:1}return d},selectWord:function(d){d=d||this.selectionStart;var b=this.searchWordBoundary(d,-1),c=this.searchWordBoundary(d,1);this.selectionStart=b;this.selectionEnd=c;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()},selectLine:function(d){d=d||this.selectionStart;var b=this.findLineBoundaryLeft(d),c=this.findLineBoundaryRight(d);this.selectionStart=b;this.selectionEnd=c;this._fireSelectionChanged();this._updateTextarea();return this},enterEditing:function(b){if(this.isEditing||!this.editable){return}if(this.canvas){this.canvas.calcOffset();this.exitEditingOnOthers(this.canvas)}this.isEditing=true;this.initHiddenTextarea(b);this.hiddenTextarea.focus();this.hiddenTextarea.value=this.text;this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire("editing:entered");this._fireSelectionChanged();if(!this.canvas){return this}this.canvas.fire("text:editing:entered",{target:this});this.initMouseMoveHandler();this.canvas.requestRenderAll();return this},exitEditingOnOthers:function(b){if(b._iTextInstances){b._iTextInstances.forEach(function(c){c.selected=false;if(c.isEditing){c.exitEditing()}})}},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(c){if(!this.__isMousedown||!this.isEditing){return}var b=this.getSelectionStartFromPointer(c.e),e=this.selectionStart,d=this.selectionEnd;if((b!==this.__selectionStartOnMouseDown||e===d)&&(e===b||d===b)){return}if(b>this.__selectionStartOnMouseDown){this.selectionStart=this.__selectionStartOnMouseDown;this.selectionEnd=b}else{this.selectionStart=b;this.selectionEnd=this.__selectionStartOnMouseDown}if(this.selectionStart!==e||this.selectionEnd!==d){this.restartCursorIfNeeded();this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection()}},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor="text"}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true},fromStringToGraphemeSelection:function(h,b,f){var d=f.slice(0,h),g=fabric.util.string.graphemeSplit(d).length;if(h===b){return{selectionStart:g,selectionEnd:g}}var e=f.slice(h,b),c=fabric.util.string.graphemeSplit(e).length;return{selectionStart:g,selectionEnd:g+c}},fromGraphemeToStringSelection:function(h,b,e){var d=e.slice(0,h),g=d.join("").length;if(h===b){return{selectionStart:g,selectionEnd:g}}var f=e.slice(h,b),c=f.join("").length;return{selectionStart:g,selectionEnd:g+c}},_updateTextarea:function(){this.cursorOffsetCache={};if(!this.hiddenTextarea){return}if(!this.inCompositionMode){var b=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=b.selectionStart;this.hiddenTextarea.selectionEnd=b.selectionEnd}this.updateTextareaPosition()},updateFromTextArea:function(){if(!this.hiddenTextarea){return}this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=b.selectionEnd;if(!this.inCompositionMode){this.selectionStart=b.selectionStart}this.updateTextareaPosition()},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var b=this._calcTextareaPosition();this.hiddenTextarea.style.left=b.left;this.hiddenTextarea.style.top=b.top}},_calcTextareaPosition:function(){if(!this.canvas){return{x:1,y:1}}var i=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(i),k=this.get2DCursorLocation(i),t=k.lineIndex,b=k.charIndex,f=this.getValueOfPropertyAt(t,b,"fontSize")*this.lineHeight,d=e.leftOffset,g=this.calcTransformMatrix(),c={x:e.left+d,y:e.top+e.topOffset+f},j=this.canvas.getRetinaScaling(),n=this.canvas.upperCanvasEl,s=n.width/j,h=n.height/j,r=s-f,q=h-f,o=n.clientWidth/s,l=n.clientHeight/h;c=fabric.util.transformPoint(c,g);c=fabric.util.transformPoint(c,this.canvas.viewportTransform);c.x*=o;c.y*=l;if(c.x<0){c.x=0}if(c.x>r){c.x=r}if(c.y<0){c.y=0}if(c.y>q){c.y=q}c.x+=this.canvas._offset.left;c.y+=this.canvas._offset.top;return{left:c.x+"px",top:c.y+"px",fontSize:f+"px",charHeight:f}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.hoverCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.selectable=this._savedProps.selectable;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor}},exitEditing:function(){var b=(this._textBeforeEdit!==this.text);this.selected=false;this.isEditing=false;this.selectionEnd=this.selectionStart;if(this.hiddenTextarea){this.hiddenTextarea.blur&&this.hiddenTextarea.blur();this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null}this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}this.fire("editing:exited");b&&this.fire("modified");if(this.canvas){this.canvas.off("mouse:move",this.mouseMoveHandler);this.canvas.fire("text:editing:exited",{target:this});b&&this.canvas.fire("object:modified",{target:this})}return this},_removeExtraneousStyles:function(){for(var b in this.styles){if(!this._textLines[b]){delete this.styles[b]}}},removeStyleFromTo:function(c,e){var n=this.get2DCursorLocation(c,true),o=this.get2DCursorLocation(e,true),h=n.lineIndex,j=n.charIndex,f=o.lineIndex,m=o.charIndex,g,b;if(h!==f){if(this.styles[h]){for(g=j;g<this._unwrappedTextLines[h].length;g++){delete this.styles[h][g]}}if(this.styles[f]){for(g=m;g<this._unwrappedTextLines[f].length;g++){b=this.styles[f][g];if(b){this.styles[h]||(this.styles[h]={});this.styles[h][j+g-m]=b}}}for(g=h+1;g<=f;g++){delete this.styles[g]}this.shiftLineStyles(f,h-f)}else{if(this.styles[h]){b=this.styles[h];var l=m-j,d,k;for(g=j;g<m;g++){delete b[g]}for(k in this.styles[h]){d=parseInt(k,10);if(d>=m){b[d-l]=b[k];delete b[k]}}}}},shiftLineStyles:function(f,e){var d=a(this.styles);for(var b in this.styles){var c=parseInt(b,10);if(c>f){this.styles[c+e]=d[c];if(!d[c-e]){delete this.styles[c]}}}},restartCursorIfNeeded:function(){if(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted){this.initDelayedCursor()}},insertNewlineStyleObject:function(j,b,i,g){var c,h={},f=false;i||(i=1);this.shiftLineStyles(j,i);if(this.styles[j]){c=this.styles[j][b===0?b:b-1]}for(var d in this.styles[j]){var e=parseInt(d,10);if(e>=b){f=true;h[e-b]=this.styles[j][d];delete this.styles[j][d]}}if(f){this.styles[j+i]=h}else{delete this.styles[j+i]}while(i>1){i--;if(g&&g[i]){this.styles[j+i]={0:a(g[i])}}else{if(c){this.styles[j+i]={0:a(c)}}else{delete this.styles[j+i]}}}this._forceClearCache=true},insertCharStyleObject:function(j,b,e,i){if(!this.styles){this.styles={}}var g=this.styles[j],c=g?a(g):{};e||(e=1);for(var h in c){var d=parseInt(h,10);if(d>=b){g[d+e]=c[d];if(!c[d-e]){delete g[d]}}}this._forceClearCache=true;if(i){while(e--){if(!Object.keys(i[e]).length){continue}if(!this.styles[j]){this.styles[j]={}}this.styles[j][b+e]=a(i[e])}return}if(!g){return}var f=g[b?b-1:1];while(f&&e--){this.styles[j][b+e]=a(f)}},insertNewStyleBlock:function(g,h,e){var f=this.get2DCursorLocation(h,true),c=[0],b=0;for(var d=0;d<g.length;d++){if(g[d]==="\n"){b++;c[b]=0}else{c[b]++}}if(c[0]>0){this.insertCharStyleObject(f.lineIndex,f.charIndex,c[0],e);e=e&&e.slice(c[0]+1)}b&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+c[0],b);for(var d=1;d<b;d++){if(c[d]>0){this.insertCharStyleObject(f.lineIndex+d,0,c[d],e)}else{if(e){this.styles[f.lineIndex+d][0]=e[0]}}e=e&&e.slice(c[d]+1)}if(c[d]>0){this.insertCharStyleObject(f.lineIndex+d,0,c[d],e)}},setSelectionStartEndWithShift:function(d,c,b){if(b<=d){if(c===d){this._selectionDirection="left"}else{if(this._selectionDirection==="right"){this._selectionDirection="left";this.selectionEnd=d}}this.selectionStart=b}else{if(b>d&&b<c){if(this._selectionDirection==="right"){this.selectionEnd=b}else{this.selectionStart=b}}else{if(c===d){this._selectionDirection="right"}else{if(this._selectionDirection==="left"){this._selectionDirection="right";this.selectionStart=c}}this.selectionEnd=b}}},setSelectionInBoundaries:function(){var b=this.text.length;if(this.selectionStart>b){this.selectionStart=b}else{if(this.selectionStart<0){this.selectionStart=0}}if(this.selectionEnd>b){this.selectionEnd=b}else{if(this.selectionEnd<0){this.selectionEnd=0}}}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(!this.canvas){return}this.__newClickTime=+new Date();var b=a.pointer;if(this.isTripleClick(b)){this.fire("tripleclick",a);this._stopEvent(a.e)}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=b;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},doubleClickHandler:function(a){if(!this.isEditing){return}this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){if(!this.isEditing){return}this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler);this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){if(!this.canvas||!this.editable||(a.e.button&&a.e.button!==1)){return}this.__isMousedown=true;if(this.selected){this.setCursorByClick(a.e)}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;if(this.selectionStart===this.selectionEnd){this.abortCursorAnimation()}this.renderCursorOrSelection()}},_mouseDownHandlerBefore:function(a){if(!this.canvas||!this.editable||(a.e.button&&a.e.button!==1)){return}this.selected=this===this.canvas._activeObject},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler);this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){this.__isMousedown=false;if(!this.editable||this.group||(a.transform&&a.transform.actionPerformed)||(a.e.button&&a.e.button!==1)){return}if(this.canvas){var b=this.canvas._activeObject;if(b&&b!==this){return}}if(this.__lastSelected&&!this.__corner){this.selected=false;this.__lastSelected=false;this.enterEditing(a.e);if(this.selectionStart===this.selectionEnd){this.initDelayedCursor(true)}else{this.renderCursorOrSelection()}}else{this.selected=true}},setCursorByClick:function(c){var a=this.getSelectionStartFromPointer(c),d=this.selectionStart,b=this.selectionEnd;if(c.shiftKey){this.setSelectionStartEndWithShift(d,b,a)}else{this.selectionStart=a;this.selectionEnd=a}if(this.isEditing){this._fireSelectionChanged();this._updateTextarea()}},getSelectionStartFromPointer:function(k){var f=this.getLocalPointer(k),l=0,b=0,n=0,a=0,o=0,g,p;for(var d=0,h=this._textLines.length;d<h;d++){if(n<=f.y){n+=this.getHeightOfLine(d)*this.scaleY;o=d;if(d>0){a+=this._textLines[d-1].length+this.missingNewlineOffset(d-1)}}else{break}}g=this._getLineLeftOffset(o);b=g*this.scaleX;p=this._textLines[o];for(var c=0,m=p.length;c<m;c++){l=b;b+=this.__charBounds[o][c].kernedWidth*this.scaleX;if(b<=f.x){a++}else{break}}return this._getNewSelectionStartFromOffset(f,l,b,a,m)},_getNewSelectionStartFromOffset:function(d,g,a,f,i){var e=d.x-g,h=a-d.x,c=h>e||h<0?0:1,b=f+c;if(this.flipX){b=i-b}if(b>this._text.length){b=this._text.length}return b}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.setAttribute("autocorrect","off");this.hiddenTextarea.setAttribute("autocomplete","off");this.hiddenTextarea.setAttribute("spellcheck","false");this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea","");this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+a.fontSize+";";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this));this._clickHandlerInitialized=true}},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(!this.isEditing||this.inCompositionMode){return}if(a.keyCode in this.keysMap){this[this.keysMap[a.keyCode]](a)}else{if((a.keyCode in this.ctrlKeysMapDown)&&(a.ctrlKey||a.metaKey)){this[this.ctrlKeysMapDown[a.keyCode]](a)}else{return}}a.stopImmediatePropagation();a.preventDefault();if(a.keyCode>=33&&a.keyCode<=40){this.clearContextTop();this.renderCursorOrSelection()}else{this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=false;return}if((a.keyCode in this.ctrlKeysMapUp)&&(a.ctrlKey||a.metaKey)){this[this.ctrlKeysMapUp[a.keyCode]](a)}else{return}a.stopImmediatePropagation();a.preventDefault();this.canvas&&this.canvas.requestRenderAll()},onInput:function(h){var d=this.fromPaste;this.fromPaste=false;h&&h.stopPropagation();if(!this.isEditing){return}var k=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,a=this._text.length,g=k.length,c,b,i=g-a;if(this.hiddenTextarea.value===""){this.styles={};this.updateFromTextArea();this.fire("changed");if(this.canvas){this.canvas.fire("text:changed",{target:this});this.canvas.requestRenderAll()}return}var j=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);var f=this.selectionStart>j.selectionStart;if(this.selectionStart!==this.selectionEnd){c=this._text.slice(this.selectionStart,this.selectionEnd);i+=this.selectionEnd-this.selectionStart}else{if(g<a){if(f){c=this._text.slice(this.selectionEnd+i,this.selectionEnd)}else{c=this._text.slice(this.selectionStart,this.selectionStart-i)}}}b=k.slice(j.selectionEnd-i,j.selectionEnd);if(c&&c.length){if(this.selectionStart!==this.selectionEnd){this.removeStyleFromTo(this.selectionStart,this.selectionEnd)}else{if(f){this.removeStyleFromTo(this.selectionEnd-c.length,this.selectionEnd)}else{this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+c.length)}}}if(b.length){if(d&&b.join("")===fabric.copiedText&&!fabric.disableStyleCopyPaste){this.insertNewStyleBlock(b,this.selectionStart,fabric.copiedTextStyle)}else{this.insertNewStyleBlock(b,this.selectionStart)}}this.updateFromTextArea();this.fire("changed");if(this.canvas){this.canvas.fire("text:changed",{target:this});this.canvas.requestRenderAll()}},onCompositionStart:function(){this.inCompositionMode=true},onCompositionEnd:function(){this.inCompositionMode=false},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart;this.compositionEnd=a.target.selectionEnd;this.updateTextareaPosition()},copy:function(){if(this.selectionStart===this.selectionEnd){return}fabric.copiedText=this.getSelectedText();if(!fabric.disableStyleCopyPaste){fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,true)}else{fabric.copiedTextStyle=null}this._copyDone=true},paste:function(){this.fromPaste=true},_getClipboardData:function(a){return(a&&a.clipboardData)||fabric.window.clipboardData},_getWidthBeforeCursor:function(d,c){var b=this._getLineLeftOffset(d),a;if(c>0){a=this.__charBounds[d][c-1];b+=a.left+a.width}return b},getDownCursorOffset:function(f,i){var d=this._getSelectionForOffset(f,i),g=this.get2DCursorLocation(d),j=g.lineIndex;if(j===this._textLines.length-1||f.metaKey||f.keyCode===34){return this._text.length-d}var a=g.charIndex,c=this._getWidthBeforeCursor(j,a),b=this._getIndexOnLine(j+1,c),h=this._textLines[j].slice(a);return h.length+b+1+this.missingNewlineOffset(j)},_getSelectionForOffset:function(b,a){if(b.shiftKey&&this.selectionStart!==this.selectionEnd&&a){return this.selectionEnd}else{return this.selectionStart}},getUpCursorOffset:function(g,j){var f=this._getSelectionForOffset(g,j),h=this.get2DCursorLocation(f),k=h.lineIndex;if(k===0||g.metaKey||g.keyCode===33){return -f}var a=h.charIndex,c=this._getWidthBeforeCursor(k,a),b=this._getIndexOnLine(k-1,c),d=this._textLines[k].slice(0,a),i=this.missingNewlineOffset(k-1);return -this._textLines[k-1].length+b-d.length+(1-i)},_getIndexOnLine:function(n,b){var o=this._textLines[n],g=this._getLineLeftOffset(n),e=g,m=0,h,i;for(var d=0,l=o.length;d<l;d++){h=this.__charBounds[n][d].width;e+=h;if(e>b){i=true;var a=e-h,k=e,f=Math.abs(a-b),c=Math.abs(k-b);m=c<f?d:(d-1);break}}if(!i){m=o.length-1}return m},moveCursorDown:function(a){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return}this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(c,b){var a="get"+c+"CursorOffset",d=this[a](b,this._selectionDirection==="right");if(b.shiftKey){this.moveCursorWithShift(d)}else{this.moveCursorWithoutShift(d)}if(d!==0){this.setSelectionInBoundaries();this.abortCursorAnimation();this._currentCursorOpacity=1;this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea()}},moveCursorWithShift:function(b){var a=this._selectionDirection==="left"?this.selectionStart+b:this.selectionEnd+b;this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a);return b!==0},moveCursorWithoutShift:function(a){if(a<0){this.selectionStart+=a;this.selectionEnd=this.selectionStart}else{this.selectionEnd+=a;this.selectionStart=this.selectionEnd}return a!==0},moveCursorLeft:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this._moveCursorLeftOrRight("Left",a)},_move:function(c,d,b){var a;if(c.altKey){a=this["findWordBoundary"+b](this[d])}else{if(c.metaKey||c.keyCode===35||c.keyCode===36){a=this["findLineBoundary"+b](this[d])}else{this[d]+=b==="Left"?-1:1;return true}}if(typeof a!==undefined&&this[d]!==a){this[d]=a;return true}},_moveLeft:function(a,b){return this._move(a,b,"Left")},_moveRight:function(a,b){return this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){var b=true;this._selectionDirection="left";if(this.selectionEnd===this.selectionStart&&this.selectionStart!==0){b=this._moveLeft(a,"selectionStart")}this.selectionEnd=this.selectionStart;return b},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd){return this._moveLeft(a,"selectionEnd")}else{if(this.selectionStart!==0){this._selectionDirection="left";return this._moveLeft(a,"selectionStart")}}},moveCursorRight:function(a){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return}this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(c,b){var a="moveCursor"+c+"With";this._currentCursorOpacity=1;if(b.shiftKey){a+="Shift"}else{a+="outShift"}if(this[a](b)){this.abortCursorAnimation();this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea()}},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){return this._moveRight(a,"selectionStart")}else{if(this.selectionEnd!==this._text.length){this._selectionDirection="right";return this._moveRight(a,"selectionEnd")}}},moveCursorRightWithoutShift:function(a){var b=true;this._selectionDirection="right";if(this.selectionStart===this.selectionEnd){b=this._moveRight(a,"selectionStart");this.selectionEnd=this.selectionStart}else{this.selectionStart=this.selectionEnd}return b},removeChars:function(b,a){if(typeof a==="undefined"){a=b+1}this.removeStyleFromTo(b,a);this._text.splice(b,a-b);this.text=this._text.join("");this.set("dirty",true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}this._removeExtraneousStyles()},insertChars:function(d,c,e,b){if(typeof b==="undefined"){b=e}if(b>e){this.removeStyleFromTo(e,b)}var a=fabric.util.string.graphemeSplit(d);this.insertNewStyleBlock(a,e,c);this._text=[].concat(this._text.slice(0,e),a,this._text.slice(b));this.text=this._text.join("");this.set("dirty",true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords()}this._removeExtraneousStyles()},});(function(){var a=fabric.util.toFixed,b=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var d=this._getSVGLeftTopOffsets(),c=this._getSVGTextAndBg(d.textTop,d.textLeft);return this._wrapSVGTextAndBg(c)},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(),{reviver:c,noStyle:true,withShadow:true})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(c){var d=true,e=this.getSvgTextDecoration(this);return[c.textBgRects.join(""),'\t\t<text xml:space="preserve" ',(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(e?'text-decoration="'+e+'" ':""),'style="',this.getSvgStyles(d),'"',this.addPaintOrder()," >",c.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,f){var k=[],j=[],d=e,g;this._setSVGBg(j);for(var h=0,c=this._textLines.length;h<c;h++){g=this._getLineLeftOffset(h);if(this.textBackgroundColor||this.styleHas("textBackgroundColor",h)){this._setSVGTextLineBg(j,h,f+g,d)}this._setSVGTextLineText(k,h,f+g,d);d+=this.getHeightOfLine(h)}return{textSpans:k,textBgRects:j}},_createTextCharSpan:function(g,j,c,f){var i=g!==g.trim()||g.match(b),h=this.getSvgSpanStyles(j,i),e=h?'style="'+h+'"':"",k=j.deltaY,d="",l=fabric.Object.NUM_FRACTION_DIGITS;if(k){d=' dy="'+a(k,l)+'" '}return['<tspan x="',a(c,l),'" y="',a(f,l),'" ',d,e,">",fabric.util.string.escapeXml(g),"</tspan>"].join("")},_setSVGTextLineText:function(e,p,g,m){var o=this.getHeightOfLine(p),n=this.textAlign.indexOf("justify")!==-1,c,s,k="",r,d,j=0,q=this._textLines[p],f;m+=o*(1-this._fontSizeFraction)/this.lineHeight;for(var h=0,l=q.length-1;h<=l;h++){f=h===l||this.charSpacing;k+=q[h];r=this.__charBounds[p][h];if(j===0){g+=r.kernedWidth-r.width;j+=r.width}else{j+=r.kernedWidth}if(n&&!f){if(this._reSpaceAndTab.test(q[h])){f=true}}if(!f){c=c||this.getCompleteStyleDeclaration(p,h);s=this.getCompleteStyleDeclaration(p,h+1);f=this._hasStyleChangedForSvg(c,s)}if(f){d=this._getStyleDeclaration(p,h)||{};e.push(this._createTextCharSpan(k,d,g,m));k="";c=s;g+=j;j=0}}},_pushTextBgRect:function(g,d,i,h,f,c){var e=fabric.Object.NUM_FRACTION_DIGITS;g.push("\t\t<rect ",this._getFillAttributes(d),' x="',a(i,e),'" y="',a(h,e),'" width="',a(f,e),'" height="',a(c,e),'"></rect>\n')},_setSVGTextLineBg:function(f,k,c,n){var q=this._textLines[k],d=this.getHeightOfLine(k)/this.lineHeight,l=0,m=0,p,h,e=this.getValueOfPropertyAt(k,0,"textBackgroundColor");for(var g=0,o=q.length;g<o;g++){p=this.__charBounds[k][g];h=this.getValueOfPropertyAt(k,g,"textBackgroundColor");if(h!==e){e&&this._pushTextBgRect(f,e,c+m,n,l,d);m=p.left;l=p.width;e=h}else{l+=p.kernedWidth}}h&&this._pushTextBgRect(f,h,c+m,n,l,d)},_getFillAttributes:function(c){var d=(c&&typeof c==="string")?new fabric.Color(c):"";if(!d||!d.getSource()||d.getAlpha()===1){return'fill="'+c+'"'}return'opacity="'+d.getAlpha()+'" fill="'+d.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(f){var e=0,d=0;for(var c=0;c<f;c++){e+=this.getHeightOfLine(c)}d=this.getHeightOfLine(c);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(d){var c=fabric.Object.prototype.getSvgStyles.call(this,d);return c+" white-space: pre;"},})})();(function(a){var b=a.fabric||(a.fabric={});b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:true,noScaleCache:false,_dimensionAffectingProps:b.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:false,initDimensions:function(){if(this.__skipDimension){return}this.isEditing&&this.initDelayedCursor();this.clearContextTop();this._clearCache();this.dynamicMinWidth=0;this._styleMap=this._generateStyleMap(this._splitText());if(this.dynamicMinWidth>this.width){this._set("width",this.dynamicMinWidth)}if(this.textAlign.indexOf("justify")!==-1){this.enlargeSpaces()}this.height=this.calcTextHeight();this.saveState({propertySet:"_dimensionAffectingProps"})},_generateStyleMap:function(c){var h=0,g=0,d=0,f={};for(var e=0;e<c.graphemeLines.length;e++){if(c.graphemeText[d]==="\n"&&e>0){g=0;d++;h++}else{if(!this.splitByGrapheme&&this._reSpaceAndTab.test(c.graphemeText[d])&&e>0){g++;d++}}f[e]={line:h,offset:g};d+=c.graphemeLines[e].length;g+=c.graphemeLines[e].length}return f},styleHas:function(c,e){if(this._styleMap&&!this.isWrapping){var d=this._styleMap[e];if(d){e=d.line}}return b.Text.prototype.styleHas.call(this,c,e)},isEmptyStyles:function(l){if(!this.styles){return true}var d=0,f=l+1,j,e,m=false,c=this._styleMap[l],g=this._styleMap[l+1];if(c){l=c.line;d=c.offset}if(g){f=g.line;m=f===l;j=g.offset}e=typeof l==="undefined"?this.styles:{line:this.styles[l]};for(var k in e){for(var i in e[k]){if(i>=d&&(!m||i<j)){for(var h in e[k][i]){return false}}}}return true},_getStyleDeclaration:function(e,d){if(this._styleMap&&!this.isWrapping){var c=this._styleMap[e];if(!c){return null}e=c.line;d=c.offset+d}return this.callSuper("_getStyleDeclaration",e,d)},_setStyleDeclaration:function(f,e,c){var d=this._styleMap[f];f=d.line;e=d.offset+e;this.styles[f][e]=c},_deleteStyleDeclaration:function(e,d){var c=this._styleMap[e];e=c.line;d=c.offset+d;delete this.styles[e][d]},_getLineStyle:function(d){var c=this._styleMap[d];return !!this.styles[c.line]},_setLineStyle:function(d){var c=this._styleMap[d];this.styles[c.line]={}},_wrapText:function(c,e){var d=[],f;this.isWrapping=true;for(f=0;f<c.length;f++){d=d.concat(this._wrapLine(c[f],f,e))}this.isWrapping=false;return d},_measureWord:function(c,l,k){var d=0,f,e=true;k=k||0;for(var g=0,j=c.length;g<j;g++){var h=this._getGraphemeBox(c[g],l,g+k,f,e);d+=h.kernedWidth;f=c[g]}return d},_wrapLine:function(d,m,p,j){var c=0,t=this.splitByGrapheme,g=[],h=[],l=t?b.util.string.graphemeSplit(d):d.split(this._wordJoiners),s="",f=0,r=t?"":" ",u=0,n=0,k=0,e=true,o=t?0:this._getWidthOfCharSpacing(),j=j||0;if(l.length===0){l.push([])}p-=j;for(var q=0;q<l.length;q++){s=t?l[q]:b.util.string.graphemeSplit(l[q]);u=this._measureWord(s,m,f);f+=s.length;c+=n+u-o;if(c>=p&&!e){g.push(h);h=[];c=u;e=true}else{c+=o}if(!e&&!t){h.push(r)}h=h.concat(s);n=this._measureWord([r],m,f);f++;e=false;if(u>k){k=u}}q&&g.push(h);if(k+j>this.dynamicMinWidth){this.dynamicMinWidth=k-o+j}return g},isEndOfWrapping:function(c){if(!this._styleMap[c+1]){return true}if(this._styleMap[c+1].line!==this._styleMap[c].line){return true}return false},missingNewlineOffset:function(c){if(this.splitByGrapheme){return this.isEndOfWrapping(c)?1:0}return 1},_splitTextIntoLines:function(g){var f=b.Text.prototype._splitTextIntoLines.call(this,g),d=this._wrapText(f.lines,this.width),c=new Array(d.length);for(var e=0;e<d.length;e++){c[e]=d[e].join("")}f.lines=c;f.graphemeLines=d;return f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var c={};for(var d in this._styleMap){if(this._textLines[d]){c[this._styleMap[d].line]=1}}for(var d in this.styles){if(!c[d]){delete this.styles[d]}}},toObject:function(c){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(c))}});b.Textbox.fromObject=function(c,d){return b.Object._fromObject("Textbox",c,d,"text")}})(typeof exports!=="undefined"?exports:this);