jQuery(document).ready(function(a){a("#admin2020-date-range").daterangepicker({autoApply:true,maxSpan:{days:60},locale:{format:"DD/MM/YYYY"},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},alwaysShowCalendars:true,startDate:moment().subtract(1,"month"),endDate:moment(),opens:"left"},function(d,b,c){Chart.helpers.each(Chart.instances,function(e){if(e.chart.canvas.id!="commentstracker"){e.destroy()}});admin_2020_build_charts()})});function admin2020_start_analytics(){if(getCookie("googleauth")){var a="https://www.googleapis.com/auth/analytics.readonly";gapi.load("client:auth2",function(){gapi.client.load("https://analyticsreporting.googleapis.com/$discovery/rest","v4").then(function(c){var b=jQuery("#admin2020Cid").text();gapi.auth.authorize({client_id:b,scope:a,immediate:true},reAuthed,failedauth)})})}else{jQuery("#noauthsignin").show()}}function failedauth(a){jQuery("#noauthsignin").show()}function reAuthed(a){token=a.access_token;gapi.auth.setToken({access_token:token});admin_2020_build_charts()}function admin_2020_build_charts(){jQuery("#gverror").hide();admin_2020_analytics_get_users();admin_2020_analytics_get_sessions();admin_2020_analytics_get_countries();admin_2020_analytics_get_devices();admin_2020_analytics_get_sessions_by_page();admin_2020_analytics_session_duration()}function admin2020_reauthorize(a){token=a.getAuthResponse().id_token;accesstoken=a.getAuthResponse(true).access_token;scope=a.getAuthResponse(true).scope;setCookie("googleauth","true",30);admin_2020_build_charts();jQuery("#noauthsignin").hide()}function displayResults(g){var e=g.result.reports;var h=e[0].data.rows;datesArray=[];valueArray=[];totalvisits=0;for(i=0;i<h.length;i++){date=h[i].dimensions[0];value=h[i].metrics[0].values[0];totalvisits=Number(value)+totalvisits;bits=date.split("");year=bits[0]+bits[1]+bits[2]+bits[3];month=bits[4]+bits[5];day=bits[6]+bits[7];datesArray.push(day+"/"+month+"/"+year);valueArray.push(value)}senddata=[];var f={label:"Users",data:valueArray,backgroundColor:"rgba(30, 135, 240, 0.2)",borderColor:"rgb(30, 135, 240)",pointBorderWidth:0,borderWidth:2,pointBackgroundColor:"rgba(30, 135, 240, 0.2)",pointBorderColor:"rgb(30, 135, 240)",clip:100,lineTension:0.3,spanGaps:true,pointRadius:5,pointHoverRadius:7};senddata.push(f);startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");var c=moment(startdate);var d=moment(enddate);days=d.diff(c,"days");jQuery("#total-vists").text(totalvisits+" in the last "+days+" days");newchart("traffic_visits","line",datesArray,senddata)}function admin_2020_buildGraphFromPhp(e,f,b,d,c){senddata=[];var a={label:c,data:e,backgroundColor:"rgb("+b+")",borderColor:"rgb("+b+")",pointBorderWidth:0,borderWidth:2,clip:100,lineTension:0.3,spanGaps:true,pointRadius:5,pointHoverRadius:7};senddata.push(a);newchart(d,"bar",f,senddata)}function admin_2020_analytics_get_users(){viewid=jQuery("#admin2020trackingid").text();startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",headers:{Authorization:"Bearer "+gapi.auth.getToken().access_token},body:{reportRequests:[{viewId:viewid,dateRanges:[{startDate:startdate,endDate:enddate}],metrics:[{expression:"ga:users",}],dimensions:[{name:"ga:date"}]}]}}).then(displayResults,function(a){errormessage=a.result.error.message;jQuery("#gverror").text("Analytics: "+errormessage).show();jQuery("#noauthsignin").show()})}function admin_2020_analytics_get_sessions(){viewid=jQuery("#admin2020trackingid").text();startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",headers:{Authorization:"Bearer "+gapi.auth.getToken().access_token},body:{reportRequests:[{viewId:viewid,dateRanges:[{startDate:startdate,endDate:enddate}],metrics:[{expression:"ga:pageviews",}],dimensions:[{name:"ga:date"}]}]}}).then(displayResultsSessions,function(a){errormessage=a.result.error.message;jQuery("#gverror").text("Analytics: "+errormessage).show();jQuery("#noauthsignin").show()})}function displayResultsSessions(g){var e=g.result.reports;var h=e[0].data.rows;datesArray=[];valueArray=[];totalvisits=0;for(i=0;i<h.length;i++){date=h[i].dimensions[0];value=h[i].metrics[0].values[0];totalvisits=Number(value)+totalvisits;bits=date.split("");year=bits[0]+bits[1]+bits[2]+bits[3];month=bits[4]+bits[5];day=bits[6]+bits[7];datesArray.push(day+"/"+month+"/"+year);valueArray.push(value)}senddata=[];var f={label:"Page Views",data:valueArray,backgroundColor:"rgba(255, 102, 236, 0.2)",borderColor:"rgb(255, 102, 236)",pointBorderWidth:0,borderWidth:2,pointBackgroundColor:"rgba(255, 102, 236, 0.2)",pointBorderColor:"rgb(255, 102, 236)",clip:100,lineTension:0.3,spanGaps:true,pointRadius:5,pointHoverRadius:7};senddata.push(f);startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");var c=moment(startdate);var d=moment(enddate);days=d.diff(c,"days");jQuery("#totalsessions_text").text("In the last "+days+" days");jQuery("#admin2020_total_sessions").text(totalvisits);jQuery("#total-sessions").text(totalvisits+" page views in the last "+days+" days");newchart("session_visits","line",datesArray,senddata)}function admin_2020_analytics_get_countries(){viewid=jQuery("#admin2020trackingid").text();startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",headers:{Authorization:"Bearer "+gapi.auth.getToken().access_token},body:{reportRequests:[{viewId:viewid,pageSize:10,dateRanges:[{startDate:startdate,endDate:enddate}],metrics:[{expression:"ga:sessions",}],dimensions:[{name:"ga:country"}],orderBys:[{fieldName:"ga:sessions",sortOrder:"DESCENDING"}]}]}}).then(displayResultscountries,function(a){errormessage=a.result.error.message;jQuery("#gverror").text("Analytics: "+errormessage).show();jQuery("#noauthsignin").show()})}function displayResultscountries(b){var a=b.result.reports;var c=a[0].data.rows;table=jQuery("#total-sessions-counntry tbody");jQuery(table).html("");for(i=0;i<c.length;i++){data=c[i];country=data.dimensions[0];value=data.metrics[0].values[0];jQuery(table).append("<tr><td>"+country+'</td><td class="uk-text-right">'+value+"</td></tr>")}}function admin_2020_analytics_session_duration(){viewid=jQuery("#admin2020trackingid").text();startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",headers:{Authorization:"Bearer "+gapi.auth.getToken().access_token},body:{reportRequests:[{viewId:viewid,pageSize:10,dateRanges:[{startDate:startdate,endDate:enddate}],metrics:[{expression:"ga:avgSessionDuration",}]}]}}).then(displayResultsSessionDuration,function(a){errormessage=a.result.error.message;jQuery("#gverror").text("Analytics: "+errormessage).show();jQuery("#noauthsignin").show()})}function displayResultsSessionDuration(f){var e=f.result.reports;var h=e[0].data.rows;var g=h[0].metrics[0].values[0];g=Number(g);minutes=parseInt((g/60)).toFixed(0);seconds=(g-(minutes*60)).toFixed(2);startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");var c=moment(startdate);var d=moment(enddate);days=d.diff(c,"days");jQuery("#total_session_duration_text").text("In the last "+days+" days");jQuery("#admin2020_average_session_duration").text(minutes+"m "+seconds+"s")}function admin_2020_analytics_get_sessions_by_page(){viewid=jQuery("#admin2020trackingid").text();startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",headers:{Authorization:"Bearer "+gapi.auth.getToken().access_token},body:{reportRequests:[{viewId:viewid,pageSize:10,dateRanges:[{startDate:startdate,endDate:enddate}],metrics:[{expression:"ga:pageviews",}],dimensions:[{name:"ga:pagePath"}],orderBys:[{fieldName:"ga:pageviews",sortOrder:"DESCENDING"}]}]}}).then(displayResultsViewsByPage,function(a){errormessage=a.result.error.message;jQuery("#gverror").text("Analytics: "+errormessage).show();jQuery("#noauthsignin").show()})}function displayResultsViewsByPage(b){var a=b.result.reports;var c=a[0].data.rows;table=jQuery("#total-sessions-page tbody");jQuery(table).html("");for(i=0;i<c.length;i++){data=c[i];country=data.dimensions[0];value=data.metrics[0].values[0];jQuery(table).append("<tr><td>"+country+'</td><td class="uk-text-right">'+value+"</td></tr>")}}function admin_2020_analytics_get_devices(){viewid=jQuery("#admin2020trackingid").text();startdate=jQuery("#admin2020-date-range").data("daterangepicker").startDate.format("YYYY-MM-DD");enddate=jQuery("#admin2020-date-range").data("daterangepicker").endDate.format("YYYY-MM-DD");gapi.client.request({path:"/v4/reports:batchGet",root:"https://analyticsreporting.googleapis.com/",method:"POST",headers:{Authorization:"Bearer "+gapi.auth.getToken().access_token},body:{reportRequests:[{viewId:viewid,pageSize:10,dateRanges:[{startDate:startdate,endDate:enddate}],metrics:[{expression:"ga:sessions",}],dimensions:[{name:"ga:deviceCategory"}],orderBys:[{fieldName:"ga:sessions",sortOrder:"DESCENDING"}]}]}}).then(displayResultsDevices,function(a){errormessage=a.result.error.message;jQuery("#gverror").text("Analytics: "+errormessage).show();jQuery("#noauthsignin").show()})}function displayResultsDevices(c){var a=c.result.reports;var d=a[0].data.rows;devices=[];values=[];for(i=0;i<d.length;i++){data=d[i];device=data.dimensions[0];value=data.metrics[0].values[0];devices.push(device);values.push(value)}senddata=[];var b={label:"Devices",data:values,backgroundColor:["rgba(30, 135, 240,0.2)","rgba(255, 159, 243,0.2)","rgba(29, 209, 161, 0.2)"],borderColor:["rgb(30, 135, 240)","rgb(255, 159, 243)"],pointBorderWidth:0,borderWidth:2,pointBackgroundColor:"rgba(255, 102, 236, 0.2)",pointBorderColor:"rgb(95, 39, 205)",clip:100,lineTension:0.3,spanGaps:true,pointRadius:5,pointHoverRadius:7};senddata.push(b);newchart("device_visits","doughnut",devices,senddata)}function displayResultscountries(b){var a=b.result.reports;var c=a[0].data.rows;table=jQuery("#total-sessions-counntry tbody");jQuery(table).html("");for(i=0;i<c.length;i++){data=c[i];country=data.dimensions[0];value=data.metrics[0].values[0];jQuery(table).append("<tr><td>"+country+'</td><td class="uk-text-right">'+value+"</td></tr>")}}function setCookie(c,d,e){var a="";if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));a="; expires="+b.toUTCString()}if(document.domain==="localhost"){window.localStorage.setItem(c,d)}else{document.cookie=encodeURI(c)+"="+encodeURI(d)+";domain=."+document.domain+";path=/;"}}function getCookie(b){if(document.domain==="localhost"){return window.localStorage.getItem(b)}var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length)}if(f.indexOf(e)==0){return f.substring(e.length,f.length)}}return null}function admin_2020_date_convert(e){var b=new Date(e*1000);var a=b.getHours();var d="0"+b.getMinutes();var f="0"+b.getSeconds();var c=a+":"+d.substr(-2)+":"+f.substr(-2);return c}function newchart(e,c,f,d){var a=document.getElementById(e).getContext("2d");var b=new Chart(a,{type:c,data:{labels:f,datasets:senddata,},options:{cutoutPercentage:80,elements:{arc:{borderWidth:12}},legend:{display:false,labels:{align:"start",boxWidth:5,fontColor:"#999",usePointStyle:true,padding:0}},plugins:{datalabels:{display:false,backgroundColor:["#8300ad"]}},maintainAspectRatio:true,scales:{yAxes:[{stacked:true,ticks:{display:false,padding:20,fontColor:"#999",autoSkip:true,maxTicksLimit:5,beginAtZero:true},gridLines:{display:false,drawBorder:false,tickMarkLength:0}}],xAxes:[{stacked:true,gridLines:{display:false,drawBorder:false,},ticks:{display:false,padding:0,fontColor:"#999",beginAtZero:true}}]}}})}Chart.elements.Rectangle.prototype.draw=function(){var t=this._chart.ctx;var w=this._view;var g,z,p,m,d,c,r,f;var A=w.borderWidth;var a=4;if(!w.horizontal){g=w.x-w.width/2;z=w.x+w.width/2;p=w.y;m=w.base;d=1;c=m>p?1:-1;r=w.borderSkipped||"bottom"}else{g=w.base;z=w.x;p=w.y-w.height/2;m=w.y+w.height/2;d=z>g?1:-1;c=1;r=w.borderSkipped||"left"}if(A){var u=Math.min(Math.abs(g-z),Math.abs(p-m));A=A>u?u:A;var l=A/2;var b=g+(r!=="left"?l*d:0);var e=z+(r!=="right"?-l*d:0);var q=p+(r!=="top"?l*c:0);var j=m+(r!=="bottom"?-l*c:0);if(b!==e){p=q;m=j}if(q!==j){g=b;z=e}}t.beginPath();t.fillStyle=w.backgroundColor;t.strokeStyle=w.borderColor;t.lineWidth=A;var s=[[g,m],[g,p],[z,p],[z,m]];var h=["bottom","left","top","right"];var n=h.indexOf(r,0);if(n===-1){n=0}function o(B){return s[(n+B)%4]}var k=o(0);t.moveTo(k[0],k[1]);for(var v=1;v<4;v++){k=o(v);nextCornerId=v+1;if(nextCornerId==4){nextCornerId=0}nextCorner=o(nextCornerId);width=s[2][0]-s[1][0];height=s[0][1]-s[1][1];x=s[1][0];y=s[1][1];var f=a;if(f>height/2){f=height/2}if(f>width/2){f=width/2}t.moveTo(x+f,y);t.lineTo(x+width-f,y);t.quadraticCurveTo(x+width,y,x+width,y+f);t.lineTo(x+width,y+height-f);t.quadraticCurveTo(x+width,y+height,x+width-f,y+height);t.lineTo(x+f,y+height);t.quadraticCurveTo(x,y+height,x,y+height-f);t.lineTo(x,y+f);t.quadraticCurveTo(x,y,x+f,y)}t.fill();if(A){t.stroke()}};